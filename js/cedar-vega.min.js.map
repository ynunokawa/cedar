{"version":3,"file":"cedar-vega.min.js","sources":["../../bower_components/vega/vega.js","../../src/cedar.js"],"names":["factory","define","amd","tj","topojson","vg","d3","vg_escape_str","x","replace","escape_str_re","vg_truncateOnWord","s","len","rev","cnt","tok","split","vg_truncate_word_re","reverse","filter","w","length","join","trim","slice","vg_write","msg","config","isNode","process","stderr","write","console","log","vg_make_tree","d","__vgtree__","nodes","vg_tree_nodes","this","root","i","c","values","n","push","vg_data_duplicate","isArray","isObject","vg_load_hasProtocol","url","vg_load_protocolRE","test","vg_load_isFile","indexOf","vg_load_fileProtocol","vg_load_xhr","callback","vg_url_check","xhr","err","resp","responseText","error","domainWhiteList","a","document","createElement","href","domain","hostname","toLowerCase","window","location","some","ind","lastIndexOf","vg_load_file","file","idx","require","readFile","vg_load_http","req","request","res","pos","data","Buffer","parseInt","headers","on","copy","end","vg_axisSubdivide","scale","ticks","m","subticks","j","v","extent","vg_axisScaleExtent","start","stop","vg_axisScaleRange","rangeExtent","range","vg_axisLabelExtend","orient","labels","oldScale","newScale","size","pad","Math","max","extend","properties","enter","y","value","update","align","baseline","vg_axisBaseline","vg_axisAlign","vg_axisTicksExtend","sign","Infinity","group","mult","y2","exit","x2","vg_axisTitleExtend","title","offset","mid","angle","vg_axisDomainExtend","path","vg_axisUpdate","item","trans","o","mark","def","width","height","ofx","ofy","scales","interpolate","vg_axisTicks","type","interactive","key","stroke","axis","tickColor","strokeWidth","tickWidth","opacity","vg_axisTickLabels","fill","tickLabelColor","font","tickLabelFont","fontSize","tickLabelFontSize","text","field","vg_axisTitle","titleFont","titleFontSize","fontWeight","titleFontWeight","titleColor","vg_axisDomain","axisColor","axisWidth","vg_legendUpdate","gx","padding","lw","bounds","lh","delta","x1","vg_legendSymbolExtend","shape","e","u","scaleName","vg_legendTitle","cfg","legend","vg_legendSymbols","symbolShape","symbolSize","symbolColor","symbolStrokeWidth","vg_vLegendLabels","labelColor","labelFont","labelFontSize","labelAlign","labelBaseline","vg_legendGradient","gradientWidth","gradientHeight","gradientStrokeColor","gradientStrokeWidth","vg_hLegendLabels","dy","version","toString","Object","prototype","obj","isFunction","call","isString","Array","isNumber","isBoolean","isTree","tree","children","number","identity","name","arguments","duplicate","JSON","parse","stringify","f","map","reduce","b","shift","apply","accessor","mutator","comparator","sort","undefined","array","cmp","numcmp","str","keys","unique","results","minIndex","min","maxIndex","truncate","word","ellipsis","l","l1","ceil","l2","floor","alert","exports","safeMode","baseURL","svgNamespace","autopadInset","time","utc","render","lineWidth","lineCap","gridColor","tickSize","titleOffset","labelOffset","color","rgb","lab","hcl","hsl","category10","category20","shapes","Bounds","clear","union","Number","MAX_VALUE","y1","set","add","expand","round","translate","dx","rotate","cos","sin","cx","cy","encloses","intersects","contains","Gradient","gradient","id","vg_gradient_id","stops","canvas","currentPath","chunks","parsed","result","re","chunksParsed","charAt","jlen","parseFloat","isNaN","command","commandLength","cmdLength","k","klen","concat","drawArc","g","coords","t","rx","ry","rot","large","sweep","ex","ey","segs","arcToSegments","bez","segmentToBezier","bezierCurveTo","boundArc","rotateX","ox","oy","argsStr","arcToSegmentsCache","th","PI","sin_th","cos_th","abs","px","py","pl","sqrt","a00","a01","a10","a11","x0","y0","sfactor_sq","sfactor","xc","yc","th0","atan2","th1","th_arc","segments","th2","th3","segmentToBezierCache","cos_th0","sin_th0","cos_th1","sin_th1","th_half","sin_th_h2","x3","y3","current","tempX","tempY","tempControlX","tempControlY","previous","controlX","controlY","beginPath","lineTo","moveTo","quadraticCurveTo","match","closePath","area","items","svg","tension","line","h","q","marks","arcPath","ir","innerRadius","or","outerRadius","sa","startAngle","ea","endAngle","arc","areaPath","p","pathCache","parsePath","renderPath","linePath","pathPath","symbolPath","r","tan30","rect","sqrt3","lineStroke","lc","strokeCap","ruleStroke","drawPathOne","opac","globalAlpha","fillOpacity","fillStyle","strokeOpacity","strokeStyle","vgLineDash","strokeDash","vgLineDashOffset","strokeDashOffset","drawPathAll","scene","drawRect","fillRect","strokeRect","drawRule","drawImage","renderer","image","loadImage","loaded","drawText","fontString","textAlign","textBaseline","radius","theta","save","fillText","strokeText","restore","drawAll","pathFunc","drawOne","drawGroup","axes","legends","gy","axisItems","legendItems","clip","layer","draw","grad","createLinearGradient","addColorStop","pickGroup","subscene","hit","handler","pick","pickAll","hitTests","_ratio","pickArea","pickLine","textHit","tmpBounds","tan","rule","isPointInStroke","isPointInPath","symbol","Renderer","scaleCanvas","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","ratio","setAttribute","style","initializeLineDash","NODASH","setLineDash","dash","off","lineDashOffset","webkitLineDash","webkitLineDashOffset","mozDash","translatedBounds","getBounds","setBounds","bbox","_ctx","_el","_imgload","initialize","el","select","selectAll","append","attr","remove","resize","_width","_height","_padding","left","right","top","bottom","node","getContext","setTransform","context","element","pendingImages","bb2","bb","_scene","clearRect","marktype","renderAsync","_async_id","clearTimeout","setTimeout","uri","load","src","Image","onload","Handler","eventName","model","_active","_handlers","_canvas","_obj","that","events","forEach","addEventListener","evt","_model","handlers","fire","mousemove","target","getBoundingClientRect","clientX","clientY","mouseout","DOMMouseScroll","splice","picker","xw","yh","prop","styleProps","styles","setProperty","removeProperty","_cur","_defs","arc_path","area_path_h","area_path_v","line_path","symbol_path","setAttributeNS","fontStyle","fontVariant","base","removeAttribute","textContent","clip_id","clipping","group_bg","cssClass","cls","tag","nest","index","drawMark","prefix","evts","grps","childNodes","notG","mark_id","each","_svg","__data__","sel","center","nested","updateDefs","all","dgrad","dclip","defs","empty","insert","grd","cr","renderItems","svgHandler","dom","removeEventListener","ingestAll","ingestTree","ingest","datum","mapper","func","get","read","format","formats","parseValues","types","cols","col","parsers","vg_parseArray","clen","boolean","date","Date","json","property","csv","tsv","feature","objects","features","mesh","treejson","aggregate","fkey","op","cell","gaccess","cells","new_cell","groupby","count","fields","OPS","init","input","output","ops","faccess","sum","avg","xf","list","fieldList","bin","compare","NaN","bisectLeft","lo","hi","bins","opt","precision","eps","maxb","maxbins","div","mins","minstep","logb","level","span","step","pow","nbins","steps","unit","setter","from","as","cross","data2","other","nodiag","diagonal","facet","klist","kstr","kv","vals","String","by","expr","flatten","flat","fold","accessors","force","db","layout","links","iterations","tick","linkDistance","linkStrength","charge","params","dataSetName","sz","iter","dependencies","formula","geo","projection","lat","lon","ll","xy","geopath","mercator","geojson","proj","link","source","curve","ix","iy","diagonalX","diagonalY","val","pie","midAngle","one","stack","out_y0","out_y1","out_cy","series","stacks","out","points","point","z","stats","mean","M2","median","variance","stdev","assign","bool","treemap","position","wordBreak","limit","wordbreak","win","curr","runs","wordcloud","cloud","finish","tags","words","random","alternate","zip","zdata","zlen","withKey","defaultValue","spec","ORIENT","grid","tickValues","tickFormat","tickSubdivide","subdivide","tickPadding","ts","tickSizeMajor","tickSizeMinor","tickSizeEnd","majorTickProperties","majorTicks","minorTickProperties","minorTicks","tickLabelProperties","titleProperties","gridLineProperties","domainProperties","visit","deps","order","flow","sorted","transform","dataflow","dep","names","pop","tx","df","transforms","tdef","CONSTANT","E","LN2","LN10","LOG2E","LOG10E","SQRT1_2","SQRT2","FUNCTION","acos","asin","atan","exp","lexer","sq","dq","tokens","Function","labelProperties","legendProperties","symbolProperties","symbols","gradientProperties","props","delay","parentData","compile","ref","code","vars","valueRef","hasPath","isColor","colorRef","grp","GROUP_VARS","band","xx","yy","zz","mark.group.width","mark.group.height","prev","instance","ORDINAL","ordinal","quantitative","rng","LINEAR","ctor","refs","dataDrivenRange","outer","outerPadding","extract","domainValues","bandWidth","bw","space","rangePoints","rangeRoundBands","rangeBands","interval","QUANTILE","domainMinMax","rangeRound","exponent","POWER","clamp","nice","TIME","dat","domainMin","domainMax","LOG","zero","GROUP_PROPERTY","rangeMin","rangeMax","viewFactory","viewport","viewConstructor","ViewFactory","GROUP","ENTER","UPDATE","EXIT","DEFAULT_DATA","sentinel","DEFAULT","Item","hasPropertySet","cousin","iidx","midx","sibling","touch","sets","build","reentrant","buildNode","buildItems","buildTrans","buildGroup","keyf","keyFunction","next","status","mlen","groups","duration","ease","gfx","pathBounds","boundPath","halfpi","xmin","xmax","ymin","ymax","angles","noRotate","measureText","includeLegends","itemBounds","methods","bounds_prev","pb","markBounds","encode","main","encodeItems","encodeGroup","encodeLegend","parent","axisDef","leg","legItems","legDef","_data","EMPTY","Transition","updates","elapsed","skip","interp","isFinite","timer","transition","dur","reset","axis_def","rangeBand","gridLines","tickLabels","tickMajorSize","tickMinorSize","tickEndSize","gridLineStyle","majorTickStyle","minorTickStyle","tickLabelStyle","domainStyle","titleStyle","tickFormatString","tickArguments","major","minor","fmt","label","tdata","vg_axisOrients","legendDef","discrete","ordinalDef","fs","o_legend_def","spacing","labelStyle","titles","symbolStyle","legendStyle","quantDef","q_legend_def","gradientStyle","unshift","gp","gh","hh","tp","formatString","vg_legendOrients","Model","_reset","sources","View","view","_build","__width","__height","_autopad","_viewport","_renderer","_handler","_io","parentNode","_strict","autopad","inset","prevHandler","hover","Spec","done","headless","vp","_type","canvasAsync","wait","innerHTML","initSVG","initCanvas","Canvas","tw","Factory","chart","module","Cedar","options","self","opts","_events","_definition","_defaultDefinition","_view","_methodQueue","_pendingXhr","definition","Error","getJson","_purgeMethodQueue","override","specification","dataset","query","_mixin","_defaultQuery","defineProperty","canDraw","drawable","errs","show","_addToMethodQueue","elementId","_elementId","token","_token","chk","issues","emit","_remove","compiledMappings","_applyDefaultsToMappings","mappings","inputs","queryFromSpec","_supplant","template","_mergeRecursive","_renderSpec","_createFeatureServiceRequest","cb","dir","chartCtor","_attach","attributes","clearSelection","_validateMappings","missingInputs","required","_validateData","firstRow","fld","_getMappingFieldName","hasOwnProperty","mappingName","fieldName","defn","defaultQuery","where","returnGeometry","returnDistinctValues","returnIdsOnly","returnCountOnly","outFields","evtName","registeredHandler","args","method","action","message","entries","mergedQuery","geometry","bboxArr","inSR","groupByFieldsForStatistics","outStatistics","orderByFields","statisticType","onStatisticField","outStatisticFieldName","_serializeQueryParams","tmpl","_getTokenValue","obj1","obj2","constructor","tokenName","tmpTokens","tokenNameParts","encodeURIComponent","queryString"],"mappings":"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","sourcesContent":["// Define module using Universal Module Definition pattern\n// https://github.com/umdjs/umd/blob/master/amdWeb.js\n\n(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    // Support AMD. Register as an anonymous module.\n    // NOTE: List all dependencies in AMD style\n    define(['d3', 'topojson'], factory);\n  } else {\n    // No AMD. Set module as a global variable\n    // NOTE: Pass dependencies to factory function\n    // (assume that both d3 and topojson are also global.)\n    var tj = (typeof topojson === 'undefined') ? null : topojson;\n    vg = factory(d3, tj);\n  }\n}(\n//NOTE: The dependencies are passed to this function\nfunction (d3, topojson) {\n//---------------------------------------------------\n// BEGIN code for this module\n//---------------------------------------------------\n\n  var vg = {\n    version:  \"1.4.3\", // semantic versioning\n    d3:       d3,      // stash d3 for use in property functions\n    topojson: topojson // stash topojson similarly\n  };\n// type checking functions\nvar toString = Object.prototype.toString;\n\nvg.isObject = function(obj) {\n  return obj === Object(obj);\n};\n\nvg.isFunction = function(obj) {\n  return toString.call(obj) == '[object Function]';\n};\n\nvg.isString = function(obj) {\n  return toString.call(obj) == '[object String]';\n};\n  \nvg.isArray = Array.isArray || function(obj) {\n  return toString.call(obj) == '[object Array]';\n};\n\nvg.isNumber = function(obj) {\n  return toString.call(obj) == '[object Number]';\n};\n\nvg.isBoolean = function(obj) {\n  return toString.call(obj) == '[object Boolean]';\n};\n\nvg.isTree = function(obj) {\n  return obj && obj.__vgtree__;\n};\n\nvg.tree = function(obj, children) {\n  var d = [obj];\n  d.__vgtree__ = true;\n  d.children = children || \"children\";\n  return d;\n};\n\nvg.number = function(s) { return +s; };\n\nvg.boolean = function(s) { return !!s; };\n\n// utility functions\n\nvg.identity = function(x) { return x; };\n\nvg.true = function() { return true; };\n\nvg.extend = function(obj) {\n  for (var x, name, i=1, len=arguments.length; i<len; ++i) {\n    x = arguments[i];\n    for (name in x) { obj[name] = x[name]; }\n  }\n  return obj;\n};\n\nvg.duplicate = function(obj) {\n  return JSON.parse(JSON.stringify(obj));\n};\n\nvg.field = function(f) {\n  return f.split(\"\\\\.\")\n    .map(function(d) { return d.split(\".\"); })\n    .reduce(function(a, b) {\n      if (a.length) { a[a.length-1] += \".\" + b.shift(); }\n      a.push.apply(a, b);\n      return a;\n    }, []);\n};\n\nvg.accessor = function(f) {\n  var s;\n  return (vg.isFunction(f) || f==null)\n    ? f : vg.isString(f) && (s=vg.field(f)).length > 1\n    ? function(x) { return s.reduce(function(x,f) {\n          return x[f];\n        }, x);\n      }\n    : function(x) { return x[f]; };\n};\n\nvg.mutator = function(f) {\n  var s;\n  return vg.isString(f) && (s=vg.field(f)).length > 1\n    ? function(x, v) {\n        for (var i=0; i<s.length-1; ++i) x = x[s[i]];\n        x[s[i]] = v;\n      }\n    : function(x, v) { x[f] = v; };\n};\n\nvg.comparator = function(sort) {\n  var sign = [];\n  if (sort === undefined) sort = [];\n  sort = vg.array(sort).map(function(f) {\n    var s = 1;\n    if      (f[0] === \"-\") { s = -1; f = f.slice(1); }\n    else if (f[0] === \"+\") { s = +1; f = f.slice(1); }\n    sign.push(s);\n    return vg.accessor(f);\n  });\n  return function(a,b) {\n    var i, n, f, x, y;\n    for (i=0, n=sort.length; i<n; ++i) {\n      f = sort[i]; x = f(a); y = f(b);\n      if (x < y) return -1 * sign[i];\n      if (x > y) return sign[i];\n    }\n    return 0;\n  };\n};\n\nvg.cmp = function(a, b) { return a<b ? -1 : a>b ? 1 : 0; };\n\nvg.numcmp = function(a, b) { return a - b; };\n\nvg.array = function(x) {\n  return x != null ? (vg.isArray(x) ? x : [x]) : [];\n};\n\nvg.values = function(x) {\n  return (vg.isObject(x) && !vg.isArray(x) && x.values) ? x.values : x;\n};\n\nvg.str = function(x) {\n  return vg.isArray(x) ? \"[\" + x.map(vg.str) + \"]\"\n    : vg.isObject(x) ? JSON.stringify(x)\n    : vg.isString(x) ? (\"'\"+vg_escape_str(x)+\"'\") : x;\n};\n\nvar escape_str_re = /(^|[^\\\\])'/g;\n\nfunction vg_escape_str(x) {\n  return x.replace(escape_str_re, \"$1\\\\'\");\n}\n\nvg.keys = function(x) {\n  var keys = [];\n  for (var key in x) keys.push(key);\n  return keys;\n};\n\nvg.unique = function(data, f, results) {\n  if (!vg.isArray(data) || data.length==0) return [];\n  f = f || vg.identity;\n  results = results || [];\n  for (var v, i=0, n=data.length; i<n; ++i) {\n    v = f(data[i]);\n    if (results.indexOf(v) < 0) results.push(v);\n  }\n  return results;\n};\n\nvg.minIndex = function(data, f) {\n  if (!vg.isArray(data) || data.length==0) return -1;\n  f = f || vg.identity;\n  var idx = 0, min = f(data[0]), v = min;\n  for (var i=1, n=data.length; i<n; ++i) {\n    v = f(data[i]);\n    if (v < min) { min = v; idx = i; }\n  }\n  return idx;\n};\n\nvg.maxIndex = function(data, f) {\n  if (!vg.isArray(data) || data.length==0) return -1;\n  f = f || vg.identity;\n  var idx = 0, max = f(data[0]), v = max;\n  for (var i=1, n=data.length; i<n; ++i) {\n    v = f(data[i]);\n    if (v > max) { max = v; idx = i; }\n  }\n  return idx;\n};\n\nvg.truncate = function(s, length, pos, word, ellipsis) {\n  var len = s.length;\n  if (len <= length) return s;\n  ellipsis = ellipsis || \"...\";\n  var l = Math.max(0, length - ellipsis.length);\n\n  switch (pos) {\n    case \"left\":\n      return ellipsis + (word ? vg_truncateOnWord(s,l,1) : s.slice(len-l));\n    case \"middle\":\n    case \"center\":\n      var l1 = Math.ceil(l/2), l2 = Math.floor(l/2);\n      return (word ? vg_truncateOnWord(s,l1) : s.slice(0,l1)) + ellipsis\n        + (word ? vg_truncateOnWord(s,l2,1) : s.slice(len-l2));\n    default:\n      return (word ? vg_truncateOnWord(s,l) : s.slice(0,l)) + ellipsis;\n  }\n}\n\nfunction vg_truncateOnWord(s, len, rev) {\n  var cnt = 0, tok = s.split(vg_truncate_word_re);\n  if (rev) {\n    s = (tok = tok.reverse())\n      .filter(function(w) { cnt += w.length; return cnt <= len; })\n      .reverse();\n  } else {\n    s = tok.filter(function(w) { cnt += w.length; return cnt <= len; });\n  }\n  return s.length ? s.join(\"\").trim() : tok[0].slice(0, len);\n}\n\nvar vg_truncate_word_re = /([\\u0009\\u000A\\u000B\\u000C\\u000D\\u0020\\u00A0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u2028\\u2029\\u3000\\uFEFF])/;\n\n// Logging\n\nfunction vg_write(msg) {\n  vg.config.isNode\n    ? process.stderr.write(msg + \"\\n\")\n    : console.log(msg);\n}\n\nvg.log = function(msg) {\n  vg_write(\"[Vega Log] \" + msg);\n};\n\nvg.error = function(msg) {\n  msg = \"[Vega Err] \" + msg;\n  vg_write(msg);\n  if (typeof alert !== \"undefined\") alert(msg);\n};vg.config = {};\n\n// are we running in node.js?\n// via timetler.com/2012/10/13/environment-detection-in-javascript/\nvg.config.isNode = typeof exports !== 'undefined' && this.exports !== exports;\n\n// Allows domain restriction when using data loading via XHR.\n// To enable, set it to a list of allowed domains\n// e.g., ['wikipedia.org', 'eff.org']\nvg.config.domainWhiteList = false;\n\n// If true, disable potentially unsafe transforms (filter, formula)\n// involving possible JavaScript injection attacks.\nvg.config.safeMode = false;\n\n// base url for loading external data files\n// used only for server-side operation\nvg.config.baseURL = \"\";\n\n// version and namepsaces for exported svg\nvg.config.svgNamespace =\n  'version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" ' +\n  'xmlns:xlink=\"http://www.w3.org/1999/xlink\"';\n\n// inset padding for automatic padding calculation\nvg.config.autopadInset = 5;\n\n// extensible scale lookup table\n// all d3.scale.* instances also supported\nvg.config.scale = {\n  time: d3.time.scale,\n  utc:  d3.time.scale.utc\n};\n\n// default rendering settings\nvg.config.render = {\n  lineWidth: 1,\n  lineCap:   \"butt\",\n  font:      \"sans-serif\",\n  fontSize:  11\n};\n\n// default axis properties\nvg.config.axis = {\n  orient: \"bottom\",\n  ticks: 10,\n  padding: 3,\n  axisColor: \"#000\",\n  gridColor: \"#d8d8d8\",\n  tickColor: \"#000\",\n  tickLabelColor: \"#000\",\n  axisWidth: 1,\n  tickWidth: 1,\n  tickSize: 6,\n  tickLabelFontSize: 11,\n  tickLabelFont: \"sans-serif\",\n  titleColor: \"#000\",\n  titleFont: \"sans-serif\",\n  titleFontSize: 11,\n  titleFontWeight: \"bold\",\n  titleOffset: 35\n};\n\n// default legend properties\nvg.config.legend = {\n  orient: \"right\",\n  offset: 10,\n  padding: 3,\n  gradientStrokeColor: \"#888\",\n  gradientStrokeWidth: 1,\n  gradientHeight: 16,\n  gradientWidth: 100,\n  labelColor: \"#000\",\n  labelFontSize: 10,\n  labelFont: \"sans-serif\",\n  labelAlign: \"left\",\n  labelBaseline: \"middle\",\n  labelOffset: 8,\n  symbolShape: \"circle\",\n  symbolSize: 50,\n  symbolColor: \"#888\",\n  symbolStrokeWidth: 1,\n  titleColor: \"#000\",\n  titleFont: \"sans-serif\",\n  titleFontSize: 11,\n  titleFontWeight: \"bold\"\n};\n\n// default color values\nvg.config.color = {\n  rgb: [128, 128, 128],\n  lab: [50, 0, 0],\n  hcl: [0, 0, 50],\n  hsl: [0, 0, 0.5]\n};\n\n// default scale ranges\nvg.config.range = {\n  category10: [\n    \"#1f77b4\",\n    \"#ff7f0e\",\n    \"#2ca02c\",\n    \"#d62728\",\n    \"#9467bd\",\n    \"#8c564b\",\n    \"#e377c2\",\n    \"#7f7f7f\",\n    \"#bcbd22\",\n    \"#17becf\"\n  ],\n  category20: [\n    \"#1f77b4\",\n    \"#aec7e8\",\n    \"#ff7f0e\",\n    \"#ffbb78\",\n    \"#2ca02c\",\n    \"#98df8a\",\n    \"#d62728\",\n    \"#ff9896\",\n    \"#9467bd\",\n    \"#c5b0d5\",\n    \"#8c564b\",\n    \"#c49c94\",\n    \"#e377c2\",\n    \"#f7b6d2\",\n    \"#7f7f7f\",\n    \"#c7c7c7\",\n    \"#bcbd22\",\n    \"#dbdb8d\",\n    \"#17becf\",\n    \"#9edae5\"\n  ],\n  shapes: [\n    \"circle\",\n    \"cross\",\n    \"diamond\",\n    \"square\",\n    \"triangle-down\",\n    \"triangle-up\"\n  ]\n};vg.Bounds = (function() {\n  var bounds = function(b) {\n    this.clear();\n    if (b) this.union(b);\n  };\n  \n  var prototype = bounds.prototype;\n  \n  prototype.clear = function() {\n    this.x1 = +Number.MAX_VALUE;\n    this.y1 = +Number.MAX_VALUE;\n    this.x2 = -Number.MAX_VALUE;\n    this.y2 = -Number.MAX_VALUE;\n    return this;\n  };\n  \n  prototype.set = function(x1, y1, x2, y2) {\n    this.x1 = x1;\n    this.y1 = y1;\n    this.x2 = x2;\n    this.y2 = y2;\n    return this;\n  };\n\n  prototype.add = function(x, y) {\n    if (x < this.x1) this.x1 = x;\n    if (y < this.y1) this.y1 = y;\n    if (x > this.x2) this.x2 = x;\n    if (y > this.y2) this.y2 = y;\n    return this;\n  };\n\n  prototype.expand = function(d) {\n    this.x1 -= d;\n    this.y1 -= d;\n    this.x2 += d;\n    this.y2 += d;\n    return this;\n  };\n  \n  prototype.round = function() {\n    this.x1 = Math.floor(this.x1);\n    this.y1 = Math.floor(this.y1);\n    this.x2 = Math.ceil(this.x2);\n    this.y2 = Math.ceil(this.y2);\n    return this;\n  };\n\n  prototype.translate = function(dx, dy) {\n    this.x1 += dx;\n    this.x2 += dx;\n    this.y1 += dy;\n    this.y2 += dy;\n    return this;\n  };\n  \n  prototype.rotate = function(angle, x, y) {\n    var cos = Math.cos(angle),\n        sin = Math.sin(angle),\n        cx = x - x*cos + y*sin,\n        cy = y - x*sin - y*cos,\n        x1 = this.x1, x2 = this.x2,\n        y1 = this.y1, y2 = this.y2;\n\n    return this.clear()\n      .add(cos*x1 - sin*y1 + cx,  sin*x1 + cos*y1 + cy)\n      .add(cos*x1 - sin*y2 + cx,  sin*x1 + cos*y2 + cy)\n      .add(cos*x2 - sin*y1 + cx,  sin*x2 + cos*y1 + cy)\n      .add(cos*x2 - sin*y2 + cx,  sin*x2 + cos*y2 + cy);\n  }\n\n  prototype.union = function(b) {\n    if (b.x1 < this.x1) this.x1 = b.x1;\n    if (b.y1 < this.y1) this.y1 = b.y1;\n    if (b.x2 > this.x2) this.x2 = b.x2;\n    if (b.y2 > this.y2) this.y2 = b.y2;\n    return this;\n  };\n\n  prototype.encloses = function(b) {\n    return b && (\n      this.x1 <= b.x1 &&\n      this.x2 >= b.x2 &&\n      this.y1 <= b.y1 &&\n      this.y2 >= b.y2\n    );\n  };\n\n  prototype.intersects = function(b) {\n    return b && !(\n      this.x2 < b.x1 ||\n      this.x1 > b.x2 ||\n      this.y2 < b.y1 ||\n      this.y1 > b.y2\n    );\n  };\n\n  prototype.contains = function(x, y) {\n    return !(\n      x < this.x1 ||\n      x > this.x2 ||\n      y < this.y1 ||\n      y > this.y2\n    );\n  };\n\n  prototype.width = function() {\n    return this.x2 - this.x1;\n  };\n\n  prototype.height = function() {\n    return this.y2 - this.y1;\n  };\n\n  return bounds;\n})();vg.Gradient = (function() {\n\n  function gradient(type) {\n    this.id = \"grad_\" + (vg_gradient_id++);\n    this.type = type || \"linear\";\n    this.stops = [];\n    this.x1 = 0;\n    this.x2 = 1;\n    this.y1 = 0;\n    this.y2 = 0;\n  };\n\n  var prototype = gradient.prototype;\n\n  prototype.stop = function(offset, color) {\n    this.stops.push({\n      offset: offset,\n      color: color\n    });\n    return this;\n  };\n  \n  return gradient;\n})();\n\nvar vg_gradient_id = 0;vg.canvas = {};vg.canvas.path = (function() {\n\n  // Path parsing and rendering code taken from fabric.js -- Thanks!\n  var cmdLength = { m:2, l:2, h:1, v:1, c:6, s:4, q:4, t:2, a:7 },\n      re = [/([MLHVCSQTAZmlhvcsqtaz])/g, /###/, /(\\d)-/g, /\\s|,|###/];\n\n  function parse(path) {\n    var result = [],\n        currentPath,\n        chunks,\n        parsed;\n\n    // First, break path into command sequence\n    path = path.slice().replace(re[0], '###$1').split(re[1]).slice(1);\n\n    // Next, parse each command in turn\n    for (var i=0, j, chunksParsed, len=path.length; i<len; i++) {\n      currentPath = path[i];\n      chunks = currentPath.slice(1).trim().replace(re[2],'$1###-').split(re[3]);\n      chunksParsed = [currentPath.charAt(0)];\n\n      for (var j = 0, jlen = chunks.length; j < jlen; j++) {\n        parsed = parseFloat(chunks[j]);\n        if (!isNaN(parsed)) {\n          chunksParsed.push(parsed);\n        }\n      }\n\n      var command = chunksParsed[0].toLowerCase(),\n          commandLength = cmdLength[command];\n\n      if (chunksParsed.length - 1 > commandLength) {\n        for (var k = 1, klen = chunksParsed.length; k < klen; k += commandLength) {\n          result.push([ chunksParsed[0] ].concat(chunksParsed.slice(k, k + commandLength)));\n        }\n      }\n      else {\n        result.push(chunksParsed);\n      }\n    }\n\n    return result;\n  }\n\n  function drawArc(g, x, y, coords, bounds, l, t) {\n    var rx = coords[0];\n    var ry = coords[1];\n    var rot = coords[2];\n    var large = coords[3];\n    var sweep = coords[4];\n    var ex = coords[5];\n    var ey = coords[6];\n    var segs = arcToSegments(ex, ey, rx, ry, large, sweep, rot, x, y);\n    for (var i=0; i<segs.length; i++) {\n      var bez = segmentToBezier.apply(null, segs[i]);\n      g.bezierCurveTo.apply(g, bez);\n      bounds.add(bez[0]-l, bez[1]-t);\n      bounds.add(bez[2]-l, bez[3]-t);\n      bounds.add(bez[4]-l, bez[5]-t);\n    }\n  }\n\n  function boundArc(x, y, coords, bounds) {\n    var rx = coords[0];\n    var ry = coords[1];\n    var rot = coords[2];\n    var large = coords[3];\n    var sweep = coords[4];\n    var ex = coords[5];\n    var ey = coords[6];\n    var segs = arcToSegments(ex, ey, rx, ry, large, sweep, rot, x, y);\n    for (var i=0; i<segs.length; i++) {\n      var bez = segmentToBezier.apply(null, segs[i]);\n      bounds.add(bez[0], bez[1]);\n      bounds.add(bez[2], bez[3]);\n      bounds.add(bez[4], bez[5]);\n    }\n  }\n\n  var arcToSegmentsCache = { },\n      segmentToBezierCache = { },\n      join = Array.prototype.join,\n      argsStr;\n\n  // Copied from Inkscape svgtopdf, thanks!\n  function arcToSegments(x, y, rx, ry, large, sweep, rotateX, ox, oy) {\n    argsStr = join.call(arguments);\n    if (arcToSegmentsCache[argsStr]) {\n      return arcToSegmentsCache[argsStr];\n    }\n\n    var th = rotateX * (Math.PI/180);\n    var sin_th = Math.sin(th);\n    var cos_th = Math.cos(th);\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n    var px = cos_th * (ox - x) * 0.5 + sin_th * (oy - y) * 0.5;\n    var py = cos_th * (oy - y) * 0.5 - sin_th * (ox - x) * 0.5;\n    var pl = (px*px) / (rx*rx) + (py*py) / (ry*ry);\n    if (pl > 1) {\n      pl = Math.sqrt(pl);\n      rx *= pl;\n      ry *= pl;\n    }\n\n    var a00 = cos_th / rx;\n    var a01 = sin_th / rx;\n    var a10 = (-sin_th) / ry;\n    var a11 = (cos_th) / ry;\n    var x0 = a00 * ox + a01 * oy;\n    var y0 = a10 * ox + a11 * oy;\n    var x1 = a00 * x + a01 * y;\n    var y1 = a10 * x + a11 * y;\n\n    var d = (x1-x0) * (x1-x0) + (y1-y0) * (y1-y0);\n    var sfactor_sq = 1 / d - 0.25;\n    if (sfactor_sq < 0) sfactor_sq = 0;\n    var sfactor = Math.sqrt(sfactor_sq);\n    if (sweep == large) sfactor = -sfactor;\n    var xc = 0.5 * (x0 + x1) - sfactor * (y1-y0);\n    var yc = 0.5 * (y0 + y1) + sfactor * (x1-x0);\n\n    var th0 = Math.atan2(y0-yc, x0-xc);\n    var th1 = Math.atan2(y1-yc, x1-xc);\n\n    var th_arc = th1-th0;\n    if (th_arc < 0 && sweep == 1){\n      th_arc += 2*Math.PI;\n    } else if (th_arc > 0 && sweep == 0) {\n      th_arc -= 2 * Math.PI;\n    }\n\n    var segments = Math.ceil(Math.abs(th_arc / (Math.PI * 0.5 + 0.001)));\n    var result = [];\n    for (var i=0; i<segments; i++) {\n      var th2 = th0 + i * th_arc / segments;\n      var th3 = th0 + (i+1) * th_arc / segments;\n      result[i] = [xc, yc, th2, th3, rx, ry, sin_th, cos_th];\n    }\n\n    return (arcToSegmentsCache[argsStr] = result);\n  }\n\n  function segmentToBezier(cx, cy, th0, th1, rx, ry, sin_th, cos_th) {\n    argsStr = join.call(arguments);\n    if (segmentToBezierCache[argsStr]) {\n      return segmentToBezierCache[argsStr];\n    }\n\n    var a00 = cos_th * rx;\n    var a01 = -sin_th * ry;\n    var a10 = sin_th * rx;\n    var a11 = cos_th * ry;\n\n    var cos_th0 = Math.cos(th0);\n    var sin_th0 = Math.sin(th0);\n    var cos_th1 = Math.cos(th1);\n    var sin_th1 = Math.sin(th1);\n\n    var th_half = 0.5 * (th1 - th0);\n    var sin_th_h2 = Math.sin(th_half * 0.5);\n    var t = (8/3) * sin_th_h2 * sin_th_h2 / Math.sin(th_half);\n    var x1 = cx + cos_th0 - t * sin_th0;\n    var y1 = cy + sin_th0 + t * cos_th0;\n    var x3 = cx + cos_th1;\n    var y3 = cy + sin_th1;\n    var x2 = x3 + t * sin_th1;\n    var y2 = y3 - t * cos_th1;\n\n    return (segmentToBezierCache[argsStr] = [\n      a00 * x1 + a01 * y1,  a10 * x1 + a11 * y1,\n      a00 * x2 + a01 * y2,  a10 * x2 + a11 * y2,\n      a00 * x3 + a01 * y3,  a10 * x3 + a11 * y3\n    ]);\n  }\n\n  function render(g, path, l, t) {\n    var current, // current instruction\n        previous = null,\n        x = 0, // current x\n        y = 0, // current y\n        controlX = 0, // current control point x\n        controlY = 0, // current control point y\n        tempX,\n        tempY,\n        tempControlX,\n        tempControlY,\n        bounds = new vg.Bounds();\n    if (l == undefined) l = 0;\n    if (t == undefined) t = 0;\n\n    g.beginPath();\n  \n    for (var i=0, len=path.length; i<len; ++i) {\n      current = path[i];\n\n      switch (current[0]) { // first letter\n\n        case 'l': // lineto, relative\n          x += current[1];\n          y += current[2];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'L': // lineto, absolute\n          x = current[1];\n          y = current[2];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'h': // horizontal lineto, relative\n          x += current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'H': // horizontal lineto, absolute\n          x = current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'v': // vertical lineto, relative\n          y += current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'V': // verical lineto, absolute\n          y = current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'm': // moveTo, relative\n          x += current[1];\n          y += current[2];\n          g.moveTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'M': // moveTo, absolute\n          x = current[1];\n          y = current[2];\n          g.moveTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'c': // bezierCurveTo, relative\n          tempX = x + current[5];\n          tempY = y + current[6];\n          controlX = x + current[3];\n          controlY = y + current[4];\n          g.bezierCurveTo(\n            x + current[1] + l, // x1\n            y + current[2] + t, // y1\n            controlX + l, // x2\n            controlY + t, // y2\n            tempX + l,\n            tempY + t\n          );\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'C': // bezierCurveTo, absolute\n          x = current[5];\n          y = current[6];\n          controlX = current[3];\n          controlY = current[4];\n          g.bezierCurveTo(\n            current[1] + l,\n            current[2] + t,\n            controlX + l,\n            controlY + t,\n            x + l,\n            y + t\n          );\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(x, y);\n          break;\n\n        case 's': // shorthand cubic bezierCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n          g.bezierCurveTo(\n            controlX + l,\n            controlY + t,\n            x + current[1] + l,\n            y + current[2] + t,\n            tempX + l,\n            tempY + t\n          );\n          bounds.add(controlX, controlY);\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(tempX, tempY);\n\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'S': // shorthand cubic bezierCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n          // calculate reflection of previous control points\n          controlX = 2*x - controlX;\n          controlY = 2*y - controlY;\n          g.bezierCurveTo(\n            controlX + l,\n            controlY + t,\n            current[1] + l,\n            current[2] + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = current[1];\n          controlY = current[2];\n\n          break;\n\n        case 'q': // quadraticCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          g.quadraticCurveTo(\n            controlX + l,\n            controlY + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'Q': // quadraticCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n\n          g.quadraticCurveTo(\n            current[1] + l,\n            current[2] + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          controlX = current[1];\n          controlY = current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 't': // shorthand quadraticCurveTo, relative\n\n          // transform to absolute x,y\n          tempX = x + current[1];\n          tempY = y + current[2];\n\n          if (previous[0].match(/[QqTt]/) === null) {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          else if (previous[0] === 't') {\n            // calculate reflection of previous control points for t\n            controlX = 2 * x - tempControlX;\n            controlY = 2 * y - tempControlY;\n          }\n          else if (previous[0] === 'q') {\n            // calculate reflection of previous control points for q\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n\n          tempControlX = controlX;\n          tempControlY = controlY;\n\n          g.quadraticCurveTo(\n            controlX + l,\n            controlY + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          controlX = x + current[1];\n          controlY = y + current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'T':\n          tempX = current[1];\n          tempY = current[2];\n\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n          g.quadraticCurveTo(\n            controlX + l,\n            controlY + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'a':\n          drawArc(g, x + l, y + t, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6] + x + l,\n            current[7] + y + t\n          ], bounds, l, t);\n          x += current[6];\n          y += current[7];\n          break;\n\n        case 'A':\n          drawArc(g, x + l, y + t, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6] + l,\n            current[7] + t\n          ], bounds, l, t);\n          x = current[6];\n          y = current[7];\n          break;\n\n        case 'z':\n        case 'Z':\n          g.closePath();\n          break;\n      }\n      previous = current;\n    }\n    return bounds.translate(l, t);\n  }\n\n  function bounds(path, bounds) {\n    var current, // current instruction\n        previous = null,\n        x = 0, // current x\n        y = 0, // current y\n        controlX = 0, // current control point x\n        controlY = 0, // current control point y\n        tempX,\n        tempY,\n        tempControlX,\n        tempControlY;\n\n    for (var i=0, len=path.length; i<len; ++i) {\n      current = path[i];\n\n      switch (current[0]) { // first letter\n\n        case 'l': // lineto, relative\n          x += current[1];\n          y += current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'L': // lineto, absolute\n          x = current[1];\n          y = current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'h': // horizontal lineto, relative\n          x += current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'H': // horizontal lineto, absolute\n          x = current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'v': // vertical lineto, relative\n          y += current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'V': // verical lineto, absolute\n          y = current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'm': // moveTo, relative\n          x += current[1];\n          y += current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'M': // moveTo, absolute\n          x = current[1];\n          y = current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'c': // bezierCurveTo, relative\n          tempX = x + current[5];\n          tempY = y + current[6];\n          controlX = x + current[3];\n          controlY = y + current[4];\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'C': // bezierCurveTo, absolute\n          x = current[5];\n          y = current[6];\n          controlX = current[3];\n          controlY = current[4];\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(x, y);\n          break;\n\n        case 's': // shorthand cubic bezierCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n          bounds.add(controlX, controlY);\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(tempX, tempY);\n\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'S': // shorthand cubic bezierCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n          // calculate reflection of previous control points\n          controlX = 2*x - controlX;\n          controlY = 2*y - controlY;\n          x = tempX;\n          y = tempY;\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = current[1];\n          controlY = current[2];\n\n          break;\n\n        case 'q': // quadraticCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'Q': // quadraticCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n\n          x = tempX;\n          y = tempY;\n          controlX = current[1];\n          controlY = current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 't': // shorthand quadraticCurveTo, relative\n\n          // transform to absolute x,y\n          tempX = x + current[1];\n          tempY = y + current[2];\n\n          if (previous[0].match(/[QqTt]/) === null) {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          else if (previous[0] === 't') {\n            // calculate reflection of previous control points for t\n            controlX = 2 * x - tempControlX;\n            controlY = 2 * y - tempControlY;\n          }\n          else if (previous[0] === 'q') {\n            // calculate reflection of previous control points for q\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n\n          tempControlX = controlX;\n          tempControlY = controlY;\n\n          x = tempX;\n          y = tempY;\n          controlX = x + current[1];\n          controlY = y + current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'T':\n          tempX = current[1];\n          tempY = current[2];\n\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'a':\n          boundArc(x, y, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6] + x,\n            current[7] + y\n          ], bounds);\n          x += current[6];\n          y += current[7];\n          break;\n\n        case 'A':\n          boundArc(x, y, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6],\n            current[7]\n          ], bounds);\n          x = current[6];\n          y = current[7];\n          break;\n\n        case 'z':\n        case 'Z':\n          break;\n      }\n      previous = current;\n    }\n    return bounds;\n  }\n  \n  function area(items) {\n    var o = items[0];\n    var area;\n    \n    if (o.orient === \"horizontal\") {\n      area = d3.svg.area()\n        .y(function(d) { return d.y; })\n        .x0(function(d) { return d.x; })\n        .x1(function(d) { return d.x + d.width; });\n    } else {\n      area = d3.svg.area()\n        .x(function(d) { return d.x; })\n        .y1(function(d) { return d.y; })\n        .y0(function(d) { return d.y + d.height; });\n    }\n\n    if (o.interpolate) area.interpolate(o.interpolate);\n    if (o.tension != null) area.tension(o.tension);\n    return area(items);\n  }\n\n  function line(items) {\n    var o = items[0];\n    var line = d3.svg.line()\n     .x(function(d) { return d.x; })\n     .y(function(d) { return d.y; });\n    if (o.interpolate) line.interpolate(o.interpolate);\n    if (o.tension != null) line.tension(o.tension);\n    return line(items);\n  }\n  \n  return {\n    parse:  parse,\n    render: render,\n    bounds: bounds,\n    area:   area,\n    line:   line\n  };\n  \n})();vg.canvas.marks = (function() {\n\n  var parsePath = vg.canvas.path.parse,\n      renderPath = vg.canvas.path.render,\n      halfpi = Math.PI / 2,\n      sqrt3 = Math.sqrt(3),\n      tan30 = Math.tan(30 * Math.PI / 180),\n      tmpBounds = new vg.Bounds();\n\n  // path generators\n\n  function arcPath(g, o) {\n    var x = o.x || 0,\n        y = o.y || 0,\n        ir = o.innerRadius || 0,\n        or = o.outerRadius || 0,\n        sa = (o.startAngle || 0) - Math.PI/2,\n        ea = (o.endAngle || 0) - Math.PI/2;\n    g.beginPath();\n    if (ir === 0) g.moveTo(x, y);\n    else g.arc(x, y, ir, sa, ea, 0);\n    g.arc(x, y, or, ea, sa, 1);\n    g.closePath();\n  }\n\n  function areaPath(g, items) {\n    var o = items[0],\n        m = o.mark,\n        p = m.pathCache || (m.pathCache = parsePath(vg.canvas.path.area(items)));\n    renderPath(g, p);\n  }\n\n  function linePath(g, items) {\n    var o = items[0],\n        m = o.mark,\n        p = m.pathCache || (m.pathCache = parsePath(vg.canvas.path.line(items)));\n    renderPath(g, p);\n  }\n\n  function pathPath(g, o) {\n    if (o.path == null) return;\n    var p = o.pathCache || (o.pathCache = parsePath(o.path));\n    return renderPath(g, p, o.x, o.y);\n  }\n\n  function symbolPath(g, o) {\n    g.beginPath();\n    var size = o.size != null ? o.size : 100,\n        x = o.x, y = o.y, r, t, rx, ry;\n\n    if (o.shape == null || o.shape === \"circle\") {\n      r = Math.sqrt(size/Math.PI);\n      g.arc(x, y, r, 0, 2*Math.PI, 0);\n      g.closePath();\n      return;\n    }\n\n    switch (o.shape) {\n      case \"cross\":\n        r = Math.sqrt(size / 5) / 2;\n        t = 3*r;\n        g.moveTo(x-t, y-r);\n        g.lineTo(x-r, y-r);\n        g.lineTo(x-r, y-t);\n        g.lineTo(x+r, y-t);\n        g.lineTo(x+r, y-r);\n        g.lineTo(x+t, y-r);\n        g.lineTo(x+t, y+r);\n        g.lineTo(x+r, y+r);\n        g.lineTo(x+r, y+t);\n        g.lineTo(x-r, y+t);\n        g.lineTo(x-r, y+r);\n        g.lineTo(x-t, y+r);\n        break;\n\n      case \"diamond\":\n        ry = Math.sqrt(size / (2 * tan30));\n        rx = ry * tan30;\n        g.moveTo(x, y-ry);\n        g.lineTo(x+rx, y);\n        g.lineTo(x, y+ry);\n        g.lineTo(x-rx, y);\n        break;\n\n      case \"square\":\n        t = Math.sqrt(size);\n        r = t / 2;\n        g.rect(x-r, y-r, t, t);\n        break;\n\n      case \"triangle-down\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        g.moveTo(x, y+ry);\n        g.lineTo(x+rx, y-ry);\n        g.lineTo(x-rx, y-ry);\n        break;\n\n      case \"triangle-up\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        g.moveTo(x, y-ry);\n        g.lineTo(x+rx, y+ry);\n        g.lineTo(x-rx, y+ry);\n    }\n    g.closePath();\n  }\n\n  function lineStroke(g, items) {\n    var o = items[0],\n        lw = o.strokeWidth,\n        lc = o.strokeCap;\n    g.lineWidth = lw != null ? lw : vg.config.render.lineWidth;\n    g.lineCap   = lc != null ? lc : vg.config.render.lineCap;\n    linePath(g, items);\n  }\n\n  function ruleStroke(g, o) {\n    var x1 = o.x || 0,\n        y1 = o.y || 0,\n        x2 = o.x2 != null ? o.x2 : x1,\n        y2 = o.y2 != null ? o.y2 : y1,\n        lw = o.strokeWidth,\n        lc = o.strokeCap;\n\n    g.lineWidth = lw != null ? lw : vg.config.render.lineWidth;\n    g.lineCap   = lc != null ? lc : vg.config.render.lineCap;\n    g.beginPath();\n    g.moveTo(x1, y1);\n    g.lineTo(x2, y2);\n  }\n\n  // drawing functions\n\n  function drawPathOne(path, g, o, items) {\n    var fill = o.fill, stroke = o.stroke, opac, lc, lw;\n\n    path(g, items);\n\n    opac = o.opacity == null ? 1 : o.opacity;\n    if (opac == 0 || !fill && !stroke) return;\n\n    if (fill) {\n      g.globalAlpha = opac * (o.fillOpacity==null ? 1 : o.fillOpacity);\n      g.fillStyle = color(g, o, fill);\n      g.fill();\n    }\n\n    if (stroke) {\n      lw = (lw = o.strokeWidth) != null ? lw : vg.config.render.lineWidth;\n      if (lw > 0) {\n        g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n        g.strokeStyle = color(g, o, stroke);\n        g.lineWidth = lw;\n        g.lineCap = (lc = o.strokeCap) != null ? lc : vg.config.render.lineCap;\n        g.vgLineDash(o.strokeDash || null);\n        g.vgLineDashOffset(o.strokeDashOffset || 0);\n        g.stroke();\n      }\n    }\n  }\n\n  function drawPathAll(path, g, scene, bounds) {\n    var i, len, item;\n    for (i=0, len=scene.items.length; i<len; ++i) {\n      item = scene.items[i];\n      if (bounds && !bounds.intersects(item.bounds))\n        continue; // bounds check\n      drawPathOne(path, g, item, item);\n    }\n  }\n\n  function drawRect(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items,\n        o, fill, stroke, opac, lc, lw, x, y, w, h;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      x = o.x || 0;\n      y = o.y || 0;\n      w = o.width || 0;\n      h = o.height || 0;\n\n      opac = o.opacity == null ? 1 : o.opacity;\n      if (opac == 0) continue;\n\n      if (fill = o.fill) {\n        g.globalAlpha = opac * (o.fillOpacity==null ? 1 : o.fillOpacity);\n        g.fillStyle = color(g, o, fill);\n        g.fillRect(x, y, w, h);\n      }\n\n      if (stroke = o.stroke) {\n        lw = (lw = o.strokeWidth) != null ? lw : vg.config.render.lineWidth;\n        if (lw > 0) {\n          g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n          g.strokeStyle = color(g, o, stroke);\n          g.lineWidth = lw;\n          g.lineCap = (lc = o.strokeCap) != null ? lc : vg.config.render.lineCap;\n          g.vgLineDash(o.strokeDash || null);\n          g.vgLineDashOffset(o.strokeDashOffset || 0);\n          g.strokeRect(x, y, w, h);\n        }\n      }\n    }\n  }\n\n  function drawRule(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items,\n        o, stroke, opac, lc, lw, x1, y1, x2, y2;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      x1 = o.x || 0;\n      y1 = o.y || 0;\n      x2 = o.x2 != null ? o.x2 : x1;\n      y2 = o.y2 != null ? o.y2 : y1;\n\n      opac = o.opacity == null ? 1 : o.opacity;\n      if (opac == 0) continue;\n      \n      if (stroke = o.stroke) {\n        lw = (lw = o.strokeWidth) != null ? lw : vg.config.render.lineWidth;\n        if (lw > 0) {\n          g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n          g.strokeStyle = color(g, o, stroke);\n          g.lineWidth = lw;\n          g.lineCap = (lc = o.strokeCap) != null ? lc : vg.config.render.lineCap;\n          g.vgLineDash(o.strokeDash || null);\n          g.vgLineDashOffset(o.strokeDashOffset || 0);\n          g.beginPath();\n          g.moveTo(x1, y1);\n          g.lineTo(x2, y2);\n          g.stroke();\n        }\n      }\n    }\n  }\n\n  function drawImage(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var renderer = this,\n        items = scene.items, o;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      if (!(o.image && o.image.url === o.url)) {\n        o.image = renderer.loadImage(o.url);\n        o.image.url = o.url;\n      }\n\n      var x, y, w, h, opac;\n      w = o.width || (o.image && o.image.width) || 0;\n      h = o.height || (o.image && o.image.height) || 0;\n      x = (o.x||0) - (o.align === \"center\"\n        ? w/2 : (o.align === \"right\" ? w : 0));\n      y = (o.y||0) - (o.baseline === \"middle\"\n        ? h/2 : (o.baseline === \"bottom\" ? h : 0));\n\n      if (o.image.loaded) {\n        g.globalAlpha = (opac = o.opacity) != null ? opac : 1;\n        g.drawImage(o.image, x, y, w, h);\n      }\n    }\n  }\n\n  function drawText(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items,\n        o, fill, stroke, opac, lw, x, y, r, t;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      g.font = vg.scene.fontString(o);\n      g.textAlign = o.align || \"left\";\n      g.textBaseline = o.baseline || \"alphabetic\";\n\n      opac = o.opacity == null ? 1 : o.opacity;\n      if (opac == 0) continue;\n\n      x = o.x || 0;\n      y = o.y || 0;\n      if (r = o.radius) {\n        t = (o.theta || 0) - Math.PI/2;\n        x += r * Math.cos(t);\n        y += r * Math.sin(t);\n      }\n\n      if (o.angle) {\n        g.save();\n        g.translate(x, y);\n        g.rotate(o.angle * Math.PI/180);\n        x = o.dx || 0;\n        y = o.dy || 0;\n      } else {\n        x += (o.dx || 0);\n        y += (o.dy || 0);\n      }\n\n      if (fill = o.fill) {\n        g.globalAlpha = opac * (o.fillOpacity==null ? 1 : o.fillOpacity);\n        g.fillStyle = color(g, o, fill);\n        g.fillText(o.text, x, y);\n      }\n\n      if (stroke = o.stroke) {\n        lw = (lw = o.strokeWidth) != null ? lw : 1;\n        if (lw > 0) {\n          g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n          g.strokeStyle = color(o, stroke);\n          g.lineWidth = lw;\n          g.strokeText(o.text, x, y);\n        }\n      }\n\n      if (o.angle) g.restore();\n    }\n  }\n\n  function drawAll(pathFunc) {\n    return function(g, scene, bounds) {\n      drawPathAll(pathFunc, g, scene, bounds);\n    }\n  }\n\n  function drawOne(pathFunc) {\n    return function(g, scene, bounds) {\n      if (!scene.items.length) return;\n      if (bounds && !bounds.intersects(scene.items[0].bounds))\n        return; // bounds check\n      drawPathOne(pathFunc, g, scene.items[0], scene.items);\n    }\n  }\n\n  function drawGroup(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items, group, axes, legends,\n        renderer = this, gx, gy, gb, i, n, j, m;\n\n    drawRect(g, scene, bounds);\n\n    for (i=0, n=items.length; i<n; ++i) {\n      group = items[i];\n      axes = group.axisItems || [];\n      legends = group.legendItems || [];\n      gx = group.x || 0;\n      gy = group.y || 0;\n\n      // render group contents\n      g.save();\n      g.translate(gx, gy);\n      if (group.clip) {\n        g.beginPath();\n        g.rect(0, 0, group.width || 0, group.height || 0);\n        g.clip();\n      }\n      \n      if (bounds) bounds.translate(-gx, -gy);\n      \n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer === \"back\") {\n          renderer.draw(g, axes[j], bounds);\n        }\n      }\n      for (j=0, m=group.items.length; j<m; ++j) {\n        renderer.draw(g, group.items[j], bounds);\n      }\n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer !== \"back\") {\n          renderer.draw(g, axes[j], bounds);\n        }\n      }\n      for (j=0, m=legends.length; j<m; ++j) {\n        renderer.draw(g, legends[j], bounds);\n      }\n      \n      if (bounds) bounds.translate(gx, gy);\n      g.restore();\n    }    \n  }\n\n  function color(g, o, value) {\n    return (value.id)\n      ? gradient(g, value, o.bounds)\n      : value;\n  }\n\n  function gradient(g, p, b) {\n    var w = b.width(),\n        h = b.height(),\n        x1 = b.x1 + p.x1 * w,\n        y1 = b.y1 + p.y1 * h,\n        x2 = b.x1 + p.x2 * w,\n        y2 = b.y1 + p.y2 * h,\n        grad = g.createLinearGradient(x1, y1, x2, y2),\n        stop = p.stops,\n        i, n;\n\n    for (i=0, n=stop.length; i<n; ++i) {\n      grad.addColorStop(stop[i].offset, stop[i].color);\n    }\n    return grad;\n  }\n\n  // hit testing\n\n  function pickGroup(g, scene, x, y, gx, gy) {\n    if (scene.items.length === 0 ||\n        scene.bounds && !scene.bounds.contains(gx, gy)) {\n      return false;\n    }\n    var items = scene.items, subscene, group, hit, dx, dy,\n        handler = this, i, j;\n\n    for (i=items.length; --i>=0;) {\n      group = items[i];\n      dx = group.x || 0;\n      dy = group.y || 0;\n\n      g.save();\n      g.translate(dx, dy);\n      for (j=group.items.length; --j >= 0;) {\n        subscene = group.items[j];\n        if (subscene.interactive === false) continue;\n        hit = handler.pick(subscene, x, y, gx-dx, gy-dy);\n        if (hit) {\n          g.restore();\n          return hit;\n        }\n      }\n      g.restore();\n    }\n\n    return scene.interactive\n      ? pickAll(hitTests.group, g, scene, x, y, gx, gy)\n      : false;\n  }\n\n  function pickAll(test, g, scene, x, y, gx, gy) {\n    if (!scene.items.length) return false;\n    var o, b, i;\n\n    if (g._ratio !== 1) {\n      x *= g._ratio;\n      y *= g._ratio;\n    }\n\n    for (i=scene.items.length; --i >= 0;) {\n      o = scene.items[i]; b = o.bounds;\n      // first hit test against bounding box\n      if ((b && !b.contains(gx, gy)) || !b) continue;\n      // if in bounding box, perform more careful test\n      if (test(g, o, x, y, gx, gy)) return o;\n    }\n    return false;\n  }\n\n  function pickArea(g, scene, x, y, gx, gy) {\n    if (!scene.items.length) return false;\n    var items = scene.items,\n        o, b, i, di, dd, od, dx, dy;\n\n    b = items[0].bounds;\n    if (b && !b.contains(gx, gy)) return false;\n    if (g._ratio !== 1) {\n      x *= g._ratio;\n      y *= g._ratio;\n    }\n    if (!hitTests.area(g, items, x, y)) return false;\n    return items[0];\n  }\n\n  function pickLine(g, scene, x, y, gx, gy) {\n    if (!scene.items.length) return false;\n    var items = scene.items,\n        o, b, i, di, dd, od, dx, dy;\n\n    b = items[0].bounds;\n    if (b && !b.contains(gx, gy)) return false;\n    if (g._ratio !== 1) {\n      x *= g._ratio;\n      y *= g._ratio;\n    }\n    if (!hitTests.line(g, items, x, y)) return false;\n    return items[0];\n  }\n\n  function pick(test) {\n    return function (g, scene, x, y, gx, gy) {\n      return pickAll(test, g, scene, x, y, gx, gy);\n    };\n  }\n\n  function textHit(g, o, x, y, gx, gy) {\n    if (!o.fontSize) return false;\n    if (!o.angle) return true; // bounds sufficient if no rotation\n\n    var b = vg.scene.bounds.text(o, tmpBounds, true),\n        a = -o.angle * Math.PI / 180,\n        cos = Math.cos(a),\n        sin = Math.sin(a),\n        x = o.x,\n        y = o.y,\n        px = cos*gx - sin*gy + (x - x*cos + y*sin),\n        py = sin*gx + cos*gy + (y - x*sin - y*cos);\n\n    return b.contains(px, py);\n  }\n\n  var hitTests = {\n    text:   textHit,\n    rect:   function(g,o,x,y) { return true; }, // bounds test is sufficient\n    image:  function(g,o,x,y) { return true; }, // bounds test is sufficient\n    group:  function(g,o,x,y) { return o.fill || o.stroke; },\n    rule:   function(g,o,x,y) {\n              if (!g.isPointInStroke) return false;\n              ruleStroke(g,o); return g.isPointInStroke(x,y);\n            },\n    line:   function(g,s,x,y) {\n              if (!g.isPointInStroke) return false;\n              lineStroke(g,s); return g.isPointInStroke(x,y);\n            },\n    arc:    function(g,o,x,y) { arcPath(g,o);  return g.isPointInPath(x,y); },\n    area:   function(g,s,x,y) { areaPath(g,s); return g.isPointInPath(x,y); },\n    path:   function(g,o,x,y) { pathPath(g,o); return g.isPointInPath(x,y); },\n    symbol: function(g,o,x,y) { symbolPath(g,o); return g.isPointInPath(x,y); }\n  };\n\n  return {\n    draw: {\n      group:   drawGroup,\n      area:    drawOne(areaPath),\n      line:    drawOne(linePath),\n      arc:     drawAll(arcPath),\n      path:    drawAll(pathPath),\n      symbol:  drawAll(symbolPath),\n      rect:    drawRect,\n      rule:    drawRule,\n      text:    drawText,\n      image:   drawImage,\n      drawOne: drawOne, // expose for extensibility\n      drawAll: drawAll  // expose for extensibility\n    },\n    pick: {\n      group:   pickGroup,\n      area:    pickArea,\n      line:    pickLine,\n      arc:     pick(hitTests.arc),\n      path:    pick(hitTests.path),\n      symbol:  pick(hitTests.symbol),\n      rect:    pick(hitTests.rect),\n      rule:    pick(hitTests.rule),\n      text:    pick(hitTests.text),\n      image:   pick(hitTests.image),\n      pickAll: pickAll  // expose for extensibility\n    }\n  };\n\n})();vg.canvas.Renderer = (function() {\n  var renderer = function() {\n    this._ctx = null;\n    this._el = null;\n    this._imgload = 0;\n  };\n\n  var prototype = renderer.prototype;\n\n  prototype.initialize = function(el, width, height, pad) {\n    this._el = el;\n  \n    if (!el) return this; // early exit if no DOM element\n\n    // select canvas element\n    var canvas = d3.select(el)\n      .selectAll(\"canvas.marks\")\n      .data([1]);\n\n    // create new canvas element if needed\n    canvas.enter()\n      .append(\"canvas\")\n      .attr(\"class\", \"marks\");\n\n    // remove extraneous canvas if needed\n    canvas.exit().remove();\n\n    return this.resize(width, height, pad);\n  };\n\n  prototype.resize = function(width, height, pad) {\n    this._width = width;\n    this._height = height;\n    this._padding = pad;\n\n    if (this._el) {\n      var canvas = d3.select(this._el).select(\"canvas.marks\");\n\n      // initialize canvas attributes\n      canvas\n        .attr(\"width\", width + pad.left + pad.right)\n        .attr(\"height\", height + pad.top + pad.bottom);\n\n      // get the canvas graphics context\n      var s;\n      this._ctx = canvas.node().getContext(\"2d\");\n      this._ctx._ratio = (s = scaleCanvas(canvas.node(), this._ctx) || 1);\n      this._ctx.setTransform(s, 0, 0, s, s*pad.left, s*pad.top);\n    }\n\n    initializeLineDash(this._ctx);\n    return this;\n  };\n\n  function scaleCanvas(canvas, ctx) {\n    // get canvas pixel data\n    var devicePixelRatio = window.devicePixelRatio || 1,\n        backingStoreRatio = (\n          ctx.webkitBackingStorePixelRatio ||\n          ctx.mozBackingStorePixelRatio ||\n          ctx.msBackingStorePixelRatio ||\n          ctx.oBackingStorePixelRatio ||\n          ctx.backingStorePixelRatio) || 1,\n        ratio = devicePixelRatio / backingStoreRatio;\n\n    if (devicePixelRatio !== backingStoreRatio) {\n      var w = canvas.width, h = canvas.height;\n      // set actual and visible canvas size\n      canvas.setAttribute(\"width\", w * ratio);\n      canvas.setAttribute(\"height\", h * ratio);\n      canvas.style.width = w + 'px';\n      canvas.style.height = h + 'px';\n    }\n    return ratio;\n  }\n\n  function initializeLineDash(ctx) {\n    if (ctx.vgLineDash) return; // already set\n\n    var NODASH = [];\n    if (ctx.setLineDash) {\n      ctx.vgLineDash = function(dash) { this.setLineDash(dash || NODASH); };\n      ctx.vgLineDashOffset = function(off) { this.lineDashOffset = off; };\n    } else if (ctx.webkitLineDash !== undefined) {\n    \tctx.vgLineDash = function(dash) { this.webkitLineDash = dash || NODASH; };\n      ctx.vgLineDashOffset = function(off) { this.webkitLineDashOffset = off; };\n    } else if (ctx.mozDash !== undefined) {\n      ctx.vgLineDash = function(dash) { this.mozDash = dash; };\n      ctx.vgLineDashOffset = function(off) { /* unsupported */ };\n    } else {\n      ctx.vgLineDash = function(dash) { /* unsupported */ };\n      ctx.vgLineDashOffset = function(off) { /* unsupported */ };\n    }\n  }\n\n  prototype.context = function(ctx) {\n    if (ctx) { this._ctx = ctx; return this; }\n    else return this._ctx;\n  };\n\n  prototype.element = function() {\n    return this._el;\n  };\n\n  prototype.pendingImages = function() {\n    return this._imgload;\n  };\n\n  function translatedBounds(item, bounds) {\n    var b = new vg.Bounds(bounds);\n    while ((item = item.mark.group) != null) {\n      b.translate(item.x || 0, item.y || 0);\n    }\n    return b;\n  }\n\n  function getBounds(items) {\n    return !items ? null :\n      vg.array(items).reduce(function(b, item) {\n        return b.union(translatedBounds(item, item.bounds))\n                .union(translatedBounds(item, item['bounds:prev']));\n      }, new vg.Bounds());\n  }\n\n  function setBounds(g, bounds) {\n    var bbox = null;\n    if (bounds) {\n      bbox = (new vg.Bounds(bounds)).round();\n      g.beginPath();\n      g.rect(bbox.x1, bbox.y1, bbox.width(), bbox.height());\n      g.clip();\n    }\n    return bbox;\n  }\n\n  prototype.render = function(scene, items) {\n    var g = this._ctx,\n        pad = this._padding,\n        w = this._width + pad.left + pad.right,\n        h = this._height + pad.top + pad.bottom,\n        bb = null, bb2;\n\n    // setup\n    this._scene = scene;\n    g.save();\n    bb = setBounds(g, getBounds(items));\n    g.clearRect(-pad.left, -pad.top, w, h);\n\n    // render\n    this.draw(g, scene, bb);\n\n    // render again to handle possible bounds change\n    if (items) {\n      g.restore();\n      g.save();\n      bb2 = setBounds(g, getBounds(items));\n      if (!bb.encloses(bb2)) {\n        g.clearRect(-pad.left, -pad.top, w, h);\n        this.draw(g, scene, bb2);\n      }\n    }\n\n    // takedown\n    g.restore();\n    this._scene = null;\n  };\n\n  prototype.draw = function(ctx, scene, bounds) {\n    var marktype = scene.marktype,\n        renderer = vg.canvas.marks.draw[marktype];\n    renderer.call(this, ctx, scene, bounds);\n  };\n\n  prototype.renderAsync = function(scene) {\n    // TODO make safe for multiple scene rendering?\n    var renderer = this;\n    if (renderer._async_id) {\n      clearTimeout(renderer._async_id);\n    }\n    renderer._async_id = setTimeout(function() {\n      renderer.render(scene);\n      delete renderer._async_id;\n    }, 50);\n  };\n\n  prototype.loadImage = function(uri) {\n    var renderer = this,\n        scene = renderer._scene,\n        image = null, url;\n\n    renderer._imgload += 1;\n    if (vg.config.isNode) {\n      image = new (require(\"canvas\").Image)();\n      vg.data.load(uri, function(err, data) {\n        if (err) { vg.error(err); return; }\n        image.src = data;\n        image.loaded = true;\n        renderer._imgload -= 1;\n      });\n    } else {\n      image = new Image();\n      url = vg.config.baseURL + uri;\n      image.onload = function() {\n        vg.log(\"LOAD IMAGE: \"+url);\n        image.loaded = true;\n        renderer._imgload -= 1;\n        renderer.renderAsync(scene);\n      };\n      image.src = url;\n    }\n\n    return image;\n  };\n\n  return renderer;\n})();vg.canvas.Handler = (function() {\n  var handler = function(el, model) {\n    this._active = null;\n    this._handlers = {};\n    if (el) this.initialize(el);\n    if (model) this.model(model);\n  };\n  \n  var prototype = handler.prototype;\n\n  prototype.initialize = function(el, pad, obj) {\n    this._el = d3.select(el).node();\n    this._canvas = d3.select(el).select(\"canvas.marks\").node();\n    this._padding = pad;\n    this._obj = obj || null;\n    \n    // add event listeners\n    var canvas = this._canvas, that = this;\n    events.forEach(function(type) {\n      canvas.addEventListener(type, function(evt) {\n        prototype[type].call(that, evt);\n      });\n    });\n    \n    return this;\n  };\n  \n  prototype.padding = function(pad) {\n    this._padding = pad;\n    return this;\n  };\n  \n  prototype.model = function(model) {\n    if (!arguments.length) return this._model;\n    this._model = model;\n    return this;\n  };\n\n  prototype.handlers = function() {\n    var h = this._handlers;\n    return vg.keys(h).reduce(function(a, k) {\n      return h[k].reduce(function(a, x) { return (a.push(x), a); }, a);\n    }, []);\n  };\n\n  // setup events\n  var events = [\n    \"mousedown\",\n    \"mouseup\",\n    \"click\",\n    \"dblclick\",\n    \"wheel\",\n    \"keydown\",\n    \"keypress\",\n    \"keyup\",\n    \"mousewheel\"\n  ];\n  events.forEach(function(type) {\n    prototype[type] = function(evt) {\n      this.fire(type, evt);\n    };\n  });\n  events.push(\"mousemove\");\n  events.push(\"mouseout\");\n\n  function eventName(name) {\n    var i = name.indexOf(\".\");\n    return i < 0 ? name : name.slice(0,i);\n  }\n\n  prototype.mousemove = function(evt) {\n    var pad = this._padding,\n        b = evt.target.getBoundingClientRect(),\n        x = evt.clientX - b.left,\n        y = evt.clientY - b.top,\n        a = this._active,\n        p = this.pick(this._model.scene(), x, y, x-pad.left, y-pad.top);\n\n    if (p === a) {\n      this.fire(\"mousemove\", evt);\n      return;\n    } else if (a) {\n      this.fire(\"mouseout\", evt);\n    }\n    this._active = p;\n    if (p) {\n      this.fire(\"mouseover\", evt);\n    }\n  };\n  \n  prototype.mouseout = function(evt) {\n    if (this._active) {\n      this.fire(\"mouseout\", evt);\n    }\n    this._active = null;\n  };\n\n  // to keep firefox happy\n  prototype.DOMMouseScroll = function(evt) {\n    this.fire(\"mousewheel\", evt);\n  };\n\n  // fire an event\n  prototype.fire = function(type, evt) {\n    var a = this._active,\n        h = this._handlers[type];\n    if (a && h) {\n      for (var i=0, len=h.length; i<len; ++i) {\n        h[i].handler.call(this._obj, evt, a);\n      }\n    }\n  };\n\n  // add an event handler\n  prototype.on = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers;\n    h = h[name] || (h[name] = []);\n    h.push({\n      type: type,\n      handler: handler\n    });\n    return this;\n  };\n\n  // remove an event handler\n  prototype.off = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers[name];\n    if (!h) return;\n    for (var i=h.length; --i>=0;) {\n      if (h[i].type !== type) continue;\n      if (!handler || h[i].handler === handler) h.splice(i, 1);\n    }\n    return this;\n  };\n  \n  // retrieve the current canvas context\n  prototype.context = function() {\n    return this._canvas.getContext(\"2d\");\n  };\n  \n  // find the scenegraph item at the current mouse position\n  // x, y -- the absolute x, y mouse coordinates on the canvas element\n  // gx, gy -- the relative coordinates within the current group\n  prototype.pick = function(scene, x, y, gx, gy) {\n    var g = this.context(),\n        marktype = scene.marktype,\n        picker = vg.canvas.marks.pick[marktype];\n    return picker.call(this, g, scene, x, y, gx, gy);\n  };\n\n  return handler;\n})();vg.svg = {};vg.svg.marks = (function() {\n\n  function x(o)     { return o.x || 0; }\n  function y(o)     { return o.y || 0; }\n  function xw(o)    { return o.x + o.width || 0; }\n  function yh(o)    { return o.y + o.height || 0; }\n  function key(o)   { return o.key; }\n  function size(o)  { return o.size==null ? 100 : o.size; }\n  function shape(o) { return o.shape || \"circle\"; }\n      \n  var arc_path    = d3.svg.arc(),\n      area_path_v = d3.svg.area().x(x).y1(y).y0(yh),\n      area_path_h = d3.svg.area().y(y).x0(xw).x1(x),\n      line_path   = d3.svg.line().x(x).y(y),\n      symbol_path = d3.svg.symbol().type(shape).size(size);\n  \n  var mark_id = 0,\n      clip_id = 0;\n  \n  var textAlign = {\n    \"left\":   \"start\",\n    \"center\": \"middle\",\n    \"right\":  \"end\"\n  };\n  \n  var styles = {\n    \"fill\":             \"fill\",\n    \"fillOpacity\":      \"fill-opacity\",\n    \"stroke\":           \"stroke\",\n    \"strokeWidth\":      \"stroke-width\",\n    \"strokeOpacity\":    \"stroke-opacity\",\n    \"strokeCap\":        \"stroke-linecap\",\n    \"strokeDash\":       \"stroke-dasharray\",\n    \"strokeDashOffset\": \"stroke-dashoffset\",\n    \"opacity\":          \"opacity\"\n  };\n  var styleProps = vg.keys(styles);\n\n  function style(d) {\n    var i, n, prop, name, value,\n        o = d.mark ? d : d.length ? d[0] : null;\n    if (o === null) return;\n\n    for (i=0, n=styleProps.length; i<n; ++i) {\n      prop = styleProps[i];\n      name = styles[prop];\n      value = o[prop];\n\n      if (value == null) {\n        if (name === \"fill\") this.style.setProperty(name, \"none\", null);\n        else this.style.removeProperty(name);\n      } else {\n        if (value.id) {\n          // ensure definition is included\n          vg.svg._cur._defs.gradient[value.id] = value;\n          value = \"url(\" + window.location.href + \"#\" + value.id + \")\";\n        }\n        this.style.setProperty(name, value+\"\", null);\n      }\n    }\n  }\n  \n  function arc(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n    this.setAttribute(\"d\", arc_path(o));\n  }\n  \n  function area(items) {\n    if (!items.length) return;\n    var o = items[0],\n        path = o.orient === \"horizontal\" ? area_path_h : area_path_v;\n    path\n      .interpolate(o.interpolate || \"linear\")\n      .tension(o.tension == null ? 0.7 : o.tension);\n    this.setAttribute(\"d\", path(items));\n  }\n  \n  function line(items) {\n    if (!items.length) return;\n    var o = items[0];\n    line_path\n      .interpolate(o.interpolate || \"linear\")\n      .tension(o.tension == null ? 0.7 : o.tension);\n    this.setAttribute(\"d\", line_path(items));\n  }\n  \n  function path(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n    if (o.path != null) this.setAttribute(\"d\", o.path);\n  }\n\n  function rect(o) {\n    this.setAttribute(\"x\", o.x || 0);\n    this.setAttribute(\"y\", o.y || 0);\n    this.setAttribute(\"width\", o.width || 0);\n    this.setAttribute(\"height\", o.height || 0);\n  }\n\n  function rule(o) {\n    var x1 = o.x || 0,\n        y1 = o.y || 0;\n    this.setAttribute(\"x1\", x1);\n    this.setAttribute(\"y1\", y1);\n    this.setAttribute(\"x2\", o.x2 != null ? o.x2 : x1);\n    this.setAttribute(\"y2\", o.y2 != null ? o.y2 : y1);\n  }\n  \n  function symbol(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n    this.setAttribute(\"d\", symbol_path(o));\n  }\n  \n  function image(o) {\n    var w = o.width || (o.image && o.image.width) || 0,\n        h = o.height || (o.image && o.image.height) || 0,\n        x = o.x - (o.align === \"center\"\n          ? w/2 : (o.align === \"right\" ? w : 0)),\n        y = o.y - (o.baseline === \"middle\"\n          ? h/2 : (o.baseline === \"bottom\" ? h : 0)),\n        url = vg.config.baseURL + o.url;\n    \n    this.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", url);\n    this.setAttribute(\"x\", x);\n    this.setAttribute(\"y\", y);\n    this.setAttribute(\"width\", w);\n    this.setAttribute(\"height\", h);\n  }\n    \n  function fontString(o) {\n    return (o.fontStyle ? o.fontStyle + \" \" : \"\")\n      + (o.fontVariant ? o.fontVariant + \" \" : \"\")\n      + (o.fontWeight ? o.fontWeight + \" \" : \"\")\n      + (o.fontSize != null ? o.fontSize : vg.config.render.fontSize) + \"px \"\n      + (o.font || vg.config.render.font);\n  }\n  \n  function text(o) {\n    var x = o.x || 0,\n        y = o.y || 0,\n        dx = o.dx || 0,\n        dy = o.dy || 0,\n        a = o.angle || 0,\n        r = o.radius || 0,\n        align = textAlign[o.align || \"left\"],\n        base = o.baseline===\"top\" ? \".9em\"\n             : o.baseline===\"middle\" ? \".35em\" : 0;\n\n    if (r) {\n      var t = (o.theta || 0) - Math.PI/2;\n      x += r * Math.cos(t);\n      y += r * Math.sin(t);\n    }\n\n    this.setAttribute(\"x\", x + dx);\n    this.setAttribute(\"y\", y + dy);\n    this.setAttribute(\"text-anchor\", align);\n    \n    if (a) this.setAttribute(\"transform\", \"rotate(\"+a+\" \"+x+\",\"+y+\")\");\n    else this.removeAttribute(\"transform\");\n    \n    if (base) this.setAttribute(\"dy\", base);\n    else this.removeAttribute(\"dy\");\n    \n    this.textContent = o.text;\n    this.style.setProperty(\"font\", fontString(o), null);\n  }\n  \n  function group(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n\n    if (o.clip) {\n      var c = {width: o.width || 0, height: o.height || 0},\n          id = o.clip_id || (o.clip_id = \"clip\" + clip_id++);\n      vg.svg._cur._defs.clipping[id] = c;\n      this.setAttribute(\"clip-path\", \"url(#\"+id+\")\");\n    }\n  }\n\n  function group_bg(o) {\n    var w = o.width || 0,\n        h = o.height || 0;\n    this.setAttribute(\"width\", w);\n    this.setAttribute(\"height\", h);\n  }\n\n  function cssClass(def) {\n    var cls = \"type-\" + def.type;\n    if (def.name) cls += \" \" + def.name;\n    return cls;\n  }\n\n  function draw(tag, attr, nest) {\n    return function(g, scene, index) {\n      drawMark(g, scene, index, \"mark_\", tag, attr, nest);\n    };\n  }\n  \n  function drawMark(g, scene, index, prefix, tag, attr, nest) {\n    var data = nest ? [scene.items] : scene.items,\n        evts = scene.interactive===false ? \"none\" : null,\n        grps = g.node().childNodes,\n        notG = (tag !== \"g\"),\n        p = (p = grps[index+1]) // +1 to skip group background rect\n          ? d3.select(p)\n          : g.append(\"g\")\n             .attr(\"id\", \"g\"+(++mark_id))\n             .attr(\"class\", cssClass(scene.def));\n\n    var id = p.attr(\"id\"),\n        s = \"#\" + id + \" > \" + tag,\n        m = p.selectAll(s).data(data),\n        e = m.enter().append(tag);\n\n    if (notG) {\n      p.style(\"pointer-events\", evts);\n      e.each(function(d) {\n        if (d.mark) d._svg = this;\n        else if (d.length) d[0]._svg = this;\n      });\n    } else {\n      e.append(\"rect\").attr(\"class\",\"background\").style(\"pointer-events\",evts);\n    }\n    \n    m.exit().remove();\n    m.each(attr);\n    if (notG) m.each(style);\n    else p.selectAll(s+\" > rect.background\").each(group_bg).each(style);\n    \n    return p;\n  }\n\n  function drawGroup(g, scene, index, prefix) {\n    var p = drawMark(g, scene, index, prefix || \"group_\", \"g\", group),\n        c = p.node().childNodes, n = c.length, i, j, m;\n    \n    for (i=0; i<n; ++i) {\n      var items = c[i].__data__.items,\n          legends = c[i].__data__.legendItems || [],\n          axes = c[i].__data__.axisItems || [],\n          sel = d3.select(c[i]),\n          idx = 0;\n\n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer === \"back\") {\n          drawGroup.call(this, sel, axes[j], idx++, \"axis_\");\n        }\n      }\n      for (j=0, m=items.length; j<m; ++j) {\n        this.draw(sel, items[j], idx++);\n      }\n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer !== \"back\") {\n          drawGroup.call(this, sel, axes[j], idx++, \"axis_\");\n        }\n      }\n      for (j=0, m=legends.length; j<m; ++j) {\n        drawGroup.call(this, sel, legends[j], idx++, \"legend_\");\n      }\n    }\n  }\n\n  return {\n    update: {\n      group:   rect,\n      area:    area,\n      line:    line,\n      arc:     arc,\n      path:    path,\n      symbol:  symbol,\n      rect:    rect,\n      rule:    rule,\n      text:    text,\n      image:   image\n    },\n    nested: {\n      \"area\": true,\n      \"line\": true\n    },\n    style: style,\n    draw: {\n      group:   drawGroup,\n      area:    draw(\"path\", area, true),\n      line:    draw(\"path\", line, true),\n      arc:     draw(\"path\", arc),\n      path:    draw(\"path\", path),\n      symbol:  draw(\"path\", symbol),\n      rect:    draw(\"rect\", rect),\n      rule:    draw(\"line\", rule),\n      text:    draw(\"text\", text),\n      image:   draw(\"image\", image),\n      draw:    draw // expose for extensibility\n    }\n  };\n  \n})();vg.svg.Renderer = (function() {\n  var renderer = function() {\n    this._svg = null;\n    this._ctx = null;\n    this._el = null;\n    this._defs = {\n      gradient: {},\n      clipping: {}\n    };\n  };\n  \n  var prototype = renderer.prototype;\n  \n  prototype.initialize = function(el, width, height, pad) {\n    this._el = el;\n\n    // remove any existing svg element\n    d3.select(el).select(\"svg.marks\").remove();\n\n    // create svg element and initialize attributes\n    this._svg = d3.select(el)\n      .append(\"svg\")\n      .attr(\"class\", \"marks\");\n    \n    // set the svg root group\n    this._ctx = this._svg.append(\"g\");\n    \n    return this.resize(width, height, pad);\n  };\n  \n  prototype.resize = function(width, height, pad) {\n    this._width = width;\n    this._height = height;\n    this._padding = pad;\n    \n    this._svg\n      .attr(\"width\", width + pad.left + pad.right)\n      .attr(\"height\", height + pad.top + pad.bottom);\n      \n    this._ctx\n      .attr(\"transform\", \"translate(\"+pad.left+\",\"+pad.top+\")\");\n\n    return this;\n  };\n  \n  prototype.context = function() {\n    return this._ctx;\n  };\n  \n  prototype.element = function() {\n    return this._el;\n  };\n\n  prototype.updateDefs = function() {\n    var svg = this._svg,\n        all = this._defs,\n        dgrad = vg.keys(all.gradient),\n        dclip = vg.keys(all.clipping),\n        defs = svg.select(\"defs\"), grad, clip;\n  \n    // get or create svg defs block\n    if (dgrad.length===0 && dclip.length==0) { defs.remove(); return; }\n    if (defs.empty()) defs = svg.insert(\"defs\", \":first-child\");\n    \n    grad = defs.selectAll(\"linearGradient\").data(dgrad, vg.identity);\n    grad.enter().append(\"linearGradient\").attr(\"id\", vg.identity);\n    grad.exit().remove();\n    grad.each(function(id) {\n      var def = all.gradient[id],\n          grd = d3.select(this);\n  \n      // set gradient coordinates\n      grd.attr({x1: def.x1, x2: def.x2, y1: def.y1, y2: def.y2});\n  \n      // set gradient stops\n      stop = grd.selectAll(\"stop\").data(def.stops);\n      stop.enter().append(\"stop\");\n      stop.exit().remove();\n      stop.attr(\"offset\", function(d) { return d.offset; })\n          .attr(\"stop-color\", function(d) { return d.color; });\n    });\n    \n    clip = defs.selectAll(\"clipPath\").data(dclip, vg.identity);\n    clip.enter().append(\"clipPath\").attr(\"id\", vg.identity);\n    clip.exit().remove();\n    clip.each(function(id) {\n      var def = all.clipping[id],\n          cr = d3.select(this).selectAll(\"rect\").data([1]);\n      cr.enter().append(\"rect\");\n      cr.attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"width\", def.width)\n        .attr(\"height\", def.height);\n    });\n  };\n  \n  prototype.render = function(scene, items) {\n    vg.svg._cur = this;\n\n    if (items) {\n      this.renderItems(vg.array(items));\n    } else {\n      this.draw(this._ctx, scene, -1);\n    }\n    this.updateDefs();\n\n   delete vg.svg._cur;\n  };\n  \n  prototype.renderItems = function(items) {\n    var item, node, type, nest, i, n,\n        marks = vg.svg.marks;\n\n    for (i=0, n=items.length; i<n; ++i) {\n      item = items[i];\n      node = item._svg;\n      type = item.mark.marktype;\n\n      item = marks.nested[type] ? item.mark.items : item;\n      marks.update[type].call(node, item);\n      marks.style.call(node, item);\n    }\n  }\n  \n  prototype.draw = function(ctx, scene, index) {\n    var marktype = scene.marktype,\n        renderer = vg.svg.marks.draw[marktype];\n    renderer.call(this, ctx, scene, index);\n  };\n  \n  return renderer;\n})();vg.svg.Handler = (function() {\n  var handler = function(el, model) {\n    this._active = null;\n    this._handlers = {};\n    if (el) this.initialize(el);\n    if (model) this.model(model);\n  };\n  \n  function svgHandler(handler) {\n    var that = this;\n    return function(evt) {\n      var target = evt.target,\n          item = target.__data__;\n      if (item) {\n        item = item.mark ? item : item[0];\n        handler.call(that._obj, evt, item);\n      }\n    };\n  }\n  \n  function eventName(name) {\n    var i = name.indexOf(\".\");\n    return i < 0 ? name : name.slice(0,i);\n  }\n  \n  var prototype = handler.prototype;\n\n  prototype.initialize = function(el, pad, obj) {\n    this._el = d3.select(el).node();\n    this._svg = d3.select(el).select(\"svg.marks\").node();\n    this._padding = pad;\n    this._obj = obj || null;\n    return this;\n  };\n  \n  prototype.padding = function(pad) {\n    this._padding = pad;\n    return this;\n  };\n  \n  prototype.model = function(model) {\n    if (!arguments.length) return this._model;\n    this._model = model;\n    return this;\n  };\n  \n  prototype.handlers = function() {\n    var h = this._handlers;\n    return vg.keys(h).reduce(function(a, k) {\n      return h[k].reduce(function(a, x) { return (a.push(x), a); }, a);\n    }, []);\n  };\n\n  // add an event handler\n  prototype.on = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers,\n        dom = d3.select(this._svg).node();\n        \n    var x = {\n      type: type,\n      handler: handler,\n      svg: svgHandler.call(this, handler)\n    };\n    h = h[name] || (h[name] = []);\n    h.push(x);\n\n    dom.addEventListener(name, x.svg);\n    return this;\n  };\n\n  // remove an event handler\n  prototype.off = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers[name],\n        dom = d3.select(this._svg).node();\n    if (!h) return;\n    for (var i=h.length; --i>=0;) {\n      if (h[i].type !== type) continue;\n      if (!handler || h[i].handler === handler) {\n        dom.removeEventListener(name, h[i].svg);\n        h.splice(i, 1);\n      }\n    }\n    return this;\n  };\n\n  return handler;\n})();vg.data = {};\n\nvg.data.ingestAll = function(data) {\n  return vg.isTree(data)\n    ? vg_make_tree(vg.data.ingestTree(data[0], data.children))\n    : data.map(vg.data.ingest);\n};\n\nvg.data.ingest = function(datum, index) {\n  return {\n    data: datum,\n    index: index\n  };\n};\n\nvg.data.ingestTree = function(node, children, index) {\n  var d = vg.data.ingest(node, index || 0),\n      c = node[children], n, i;\n  if (c && (n = c.length)) {\n    d.values = Array(n);\n    for (i=0; i<n; ++i) {\n      d.values[i] = vg.data.ingestTree(c[i], children, i);\n    }\n  }\n  return d;\n};\n\nfunction vg_make_tree(d) {\n  d.__vgtree__ = true;\n  d.nodes = function() { return vg_tree_nodes(this, []); };\n  return d;\n}\n\nfunction vg_tree_nodes(root, nodes) {\n  var c = root.values,\n      n = c ? c.length : 0, i;\n  nodes.push(root);\n  for (i=0; i<n; ++i) { vg_tree_nodes(c[i], nodes); }\n  return nodes;\n}\n\nfunction vg_data_duplicate(d) {\n  var x=d, i, n;\n  if (vg.isArray(d)) {\n    x = [];\n    for (i=0, n=d.length; i<n; ++i) {\n      x.push(vg_data_duplicate(d[i]));\n    }\n  } else if (vg.isObject(d)) {\n    x = {};\n    for (i in d) {\n      x[i] = vg_data_duplicate(d[i]);\n    }\n  }\n  return x;\n}\n\nvg.data.mapper = function(func) {\n  return function(data) {\n    data.forEach(func);\n    return data;\n  }\n};\n\nvg.data.size = function(size, group) {\n  size = vg.isArray(size) ? size : [0, size];\n  size = size.map(function(d) {\n    return (typeof d === 'string') ? group[d] : d;\n  });\n  return size;\n};vg.data.load = function(uri, callback) {\n  var url = vg_load_hasProtocol(uri) ? uri : vg.config.baseURL + uri;\n  if (vg.config.isNode) {\n    // in node.js, consult url and select file or http\n    var get = vg_load_isFile(url) ? vg_load_file : vg_load_http;\n    get(url, callback);\n  } else {\n    // in browser, use xhr\n    vg_load_xhr(url, callback);\n  }  \n};\n\nvar vg_load_protocolRE = /^[A-Za-z]+\\:\\/\\//;\nvar vg_load_fileProtocol = \"file://\";\n\nfunction vg_load_hasProtocol(url) {\n  return vg_load_protocolRE.test(url);\n}\n\nfunction vg_load_isFile(url) {\n  return url.indexOf(vg_load_fileProtocol) === 0;\n}\n\nfunction vg_load_xhr(url, callback) {\n  vg.log(\"LOAD: \" + url);\n  if (!vg_url_check(url)) {\n    vg.error(\"URL is not whitelisted: \" + url);\n    return;\n  }\n  d3.xhr(url, function(err, resp) {\n    if (resp) resp = resp.responseText;\n    callback(err, resp);\n  });\n}\n\nfunction vg_url_check(url) {\n  // If vg.config.domainWhiteList is set, only allows url, whose hostname\n  // * Is the same as the origin (window.location.hostname)\n  // * Equals one of the values in the whitelist\n  // * Is a proper subdomain of one of the values in the whitelist\n  if (!vg.config.domainWhiteList)\n    return true;\n\n  var a = document.createElement(\"a\");\n  a.href = url;\n  var domain = a.hostname.toLowerCase();\n\n  return window.location.hostname === domain ||\n    vg.config.domainWhiteList.some(function(d) {\n      var ind = domain.length - d.length;\n      return d === domain ||\n        (ind > 1 && domain[ind-1] === '.' && domain.lastIndexOf(d) === ind);\n    });\n}\n\nfunction vg_load_file(file, callback) {\n  vg.log(\"LOAD FILE: \" + file);\n  var idx = file.indexOf(vg_load_fileProtocol);\n  if (idx >= 0) file = file.slice(vg_load_fileProtocol.length);\n  require(\"fs\").readFile(file, callback);\n}\n\nfunction vg_load_http(url, callback) {\n  vg.log(\"LOAD HTTP: \" + url);\n\tvar req = require(\"http\").request(url, function(res) {\n    var pos=0, data = new Buffer(parseInt(res.headers['content-length'],10));\n\t\tres.on(\"error\", function(err) { callback(err, null); });\n\t\tres.on(\"data\", function(x) { x.copy(data, pos); pos += x.length; });\n\t\tres.on(\"end\", function() { callback(null, data); });\n\t});\n\treq.on(\"error\", function(err) { callback(err); });\n\treq.end();\n}vg.data.read = (function() {\n  var formats = {},\n      parsers = {\n        \"number\": vg.number,\n        \"boolean\": vg.boolean,\n        \"date\": Date.parse\n      };\n\n  function read(data, format) {\n    var type = (format && format.type) || \"json\";\n    data = formats[type](data, format);\n    if (format && format.parse) parseValues(data, format.parse);\n    return data;\n  }\n\n  formats.json = function(data, format) {\n    var d = vg.isObject(data) ? data : JSON.parse(data);\n    if (format && format.property) {\n      d = vg.accessor(format.property)(d);\n    }\n    return d;\n  };\n\n  formats.csv = function(data, format) {\n    var d = d3.csv.parse(data);\n    return d;\n  };\n\n  formats.tsv = function(data, format) {\n    var d = d3.tsv.parse(data);\n    return d;\n  };\n  \n  formats.topojson = function(data, format) {\n    if (topojson == null) {\n      vg.error(\"TopoJSON library not loaded.\");\n      return [];\n    }    \n    var t = vg.isObject(data) ? data : JSON.parse(data),\n        obj = [];\n\n    if (format && format.feature) {\n      obj = (obj = t.objects[format.feature])\n        ? topojson.feature(t, obj).features\n        : (vg.error(\"Invalid TopoJSON object: \"+format.feature), []);\n    } else if (format && format.mesh) {\n      obj = (obj = t.objects[format.mesh])\n        ? [topojson.mesh(t, t.objects[format.mesh])]\n        : (vg.error(\"Invalid TopoJSON object: \" + format.mesh), []);\n    }\n    else { vg.error(\"Missing TopoJSON feature or mesh parameter.\"); }\n\n    return obj;\n  };\n  \n  formats.treejson = function(data, format) {\n    data = vg.isObject(data) ? data : JSON.parse(data);\n    return vg.tree(data, format.children);\n  };\n  \n  function parseValues(data, types) {\n    var cols = vg.keys(types),\n        p = cols.map(function(col) { return parsers[types[col]]; }),\n        tree = vg.isTree(data);\n    vg_parseArray(tree ? [data] : data, cols, p, tree);\n  }\n  \n  function vg_parseArray(data, cols, p, tree) {\n    var d, i, j, len, clen;\n    for (i=0, len=data.length; i<len; ++i) {\n      d = data[i];\n      for (j=0, clen=cols.length; j<clen; ++j) {\n        d[cols[j]] = p[j](d[cols[j]]);\n      }\n      if (tree && d.values) parseValues(d, cols, p, true);\n    }\n  }\n\n  read.formats = formats;\n  read.parse = parseValues;\n  return read;\n})();vg.data.aggregate = function() {\n  var groupby = [],\n      fields = [],\n      gaccess,\n      faccess;\n\n  var OPS = {\n    \"count\": function() {},\n\t\t\"sum\": function(c, s, x) { return s + x; },\n\t\t\"avg\": function(c, s, x) { return s + (x-s)/c.count; },\n\t\t\"min\": function(c, s, x) { return x < s ? x : s; },\n\t\t\"max\": function(c, s, x) { return x > s ? x : s; }\n\t};\n\tOPS.min.init = function() { return +Infinity; }\n\tOPS.max.init = function() { return -Infinity; }\n\n\tfunction fkey(x) {\n\t\treturn x.op + \"_\" + x.field;\n\t}\n\n\tvar cells = {};\n\n  function cell(x) {\n    // consider other key constructions...\n    var k = gaccess.reduce(function(v,f) {\n      return (v.push(f(x)), v);\n    }, []).join(\"|\");\n    return cells[k] || (cells[k] = new_cell(x));\n  }\n\n  function new_cell(x) {\n    var o = {};\n    // dimensions\n    for (var i=0, f; i<groupby.length; ++i) {\n      o[groupby[i]] = gaccess[i](x);\n    }\n    // measures\n    o.count = 0;\n\t\tfor (i=0; i<fields.length; ++i) {\n\t\t  if (fields[i].op === \"count\") continue;\n\t\t  var op = OPS[fields[i].op];\n\t\t\to[fkey(fields[i])] = op.init ? op.init() : 0;\n\t\t}\n    return o;\n  }\n\n  function aggregate(input) {\n    var output = [], k;\n\t\tvar keys = fields.map(fkey);\n\t\tvar ops = fields.map(function(x) { return OPS[x.op]; });\n\n    // compute aggregates\n    input.forEach(function(x) {\n      var c = cell(x);\n\n\t\t\t// compute aggregates...\n      c.count += 1;\n\t\t\tfor (var i=0; i<fields.length; ++i) {\n\t\t\t\tc[keys[i]] = ops[i](c, c[keys[i]], faccess[i](x));\n\t\t\t}\n    });\n    // collect output tuples\n    var index = 0;\n    for (k in cells) {\n      output.push({index:index++, data:cells[k]});\n    }\n    cells = {}; // clear internal state\n    return output;\n  };\n\n  aggregate.fields = function(f) {\n    fields = vg.array(f);\n    faccess = fields.map(function(x,i) {\n      var xf = x.field;\n      if (xf.indexOf(\"data.\") === 0) {\n        fields[i] = {op:x.op, field:xf.slice(5)};\n      }\n      return vg.accessor(xf);\n    });\n    return aggregate;\n  };\n\n  aggregate.groupby = function(f) {\n    groupby = vg.array(f);\n    gaccess = groupby.map(function(x,i) {\n      if (x.indexOf(\"data.\") === 0) {\n        groupby[i] = x.slice(5);\n      }\n      return vg.accessor(x);\n    });\n    return aggregate;\n  };\n\n  return aggregate;\n};vg.data.array = function() {\n  var fields = [];\n   \n  function array(data) {\n    return data.map(function(d) {      \n      var list = [];\n      for (var i=0, len=fields.length; i<len; ++i) {\n        list.push(fields[i](d));\n      }\n      return list;\n    });\n  }\n  \n  array.fields = function(fieldList) {\n    fields = vg.array(fieldList).map(vg.accessor);\n    return array;\n  };\n  \n  return array;\n};vg.data.bin = function() {\n\n  var field,\n      accessor,\n      setter,\n      min = undefined,\n      max = undefined,\n      step = undefined,\n      maxbins = 20,\n      output = \"bin\";\n\n  function compare(a, b) {\n    return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n  }\n\n  function bisectLeft(a, x, lo, hi) {\n    if (arguments.length < 3) { lo = 0; }\n    if (arguments.length < 4) { hi = a.length; }\n    while (lo < hi) {\n      var mid = lo + hi >>> 1;\n      if (compare(a[mid], x) < 0) { lo = mid + 1; }\n      else { hi = mid; }\n    }\n    return lo;\n  }\n\n  function bins(opt) {\n    opt = opt || {};\n\n    // determine range\n    var maxb = opt.maxbins || 1024,\n        base = opt.base || 10,\n        div = opt.div || [5, 2],\n        mins = opt.minstep || 0,\n        logb = Math.log(base),\n        level = Math.ceil(Math.log(maxb) / logb),\n        min = opt.min,\n        max = opt.max,\n        span = max - min,\n        step = Math.max(mins, Math.pow(base, Math.round(Math.log(span) / logb) - level)),\n        nbins = Math.ceil(span / step),\n        precision, v, i, eps;\n\n    if (opt.step != null) {\n      step = opt.step;\n    } else if (opt.steps) {\n      // if provided, limit choice to acceptable step sizes\n      step = opt.steps[Math.min(\n          opt.steps.length - 1,\n          bisectLeft(opt.steps, span / maxb)\n      )];\n    } else {\n      // increase step size if too many bins\n      do {\n        step *= base;\n        nbins = Math.ceil(span / step);\n      } while (nbins > maxb);\n\n      // decrease step size if allowed\n      for (i = 0; i < div.length; ++i) {\n        v = step / div[i];\n        if (v >= mins && span / v <= maxb) {\n          step = v;\n          nbins = Math.ceil(span / step);\n        }\n      }\n    }\n\n    // update precision, min and max\n    v = Math.log(step);\n    precision = v >= 0 ? 0 : ~~(-v / logb) + 1;\n    eps = Math.pow(base, -precision - 1);\n\n    // outer Math.min to remove some rounding errors:\n    min = Math.min(min, Math.floor(min / step + eps) * step);\n    max = Math.ceil(max / step) * step;\n\n    return {\n      start: min,\n      stop: max,\n      step: step,\n      unit: precision\n    };\n  }\n\n  function bin(input) {\n    var opt = {\n      min: min != null ? min : +Infinity,\n      max: max != null ? max : -Infinity,\n      step: step != null ? step : null,\n      maxbins: maxbins\n    };\n    if (min == null || max == null) {\n      input.forEach(function(d) {\n        var v = accessor(d);\n        if (min == null && v > opt.max) opt.max = v;\n        if (max == null && v < opt.min) opt.min = v;\n      });\n    }\n    var b = bins(opt);\n    input.forEach(function(d) {\n      var v = accessor(d);\n      setter(d, b.start + b.step * ~~((v - b.start) / b.step));\n    });\n    return input;\n  }\n\n  bin.min = function(x) {\n    min = x;\n    return bin;\n  };\n\n  bin.max = function(x) {\n    max = x;\n    return bin;\n  };\n\n  bin.step = function(x) {\n    step = x;\n    return bin;\n  };\n\n  bin.maxbins = function(x) {\n    maxbins = x;\n    return bin;\n  };\n\n  bin.field = function(f) {\n    field = f;\n    accessor = vg.accessor(f);\n    return bin;\n  };\n\n  bin.output = function(f) {\n    output = f;\n    setter = vg.mutator(f);\n    return bin;\n  };\n\n  return bin;\n};vg.data.copy = function() {\n  var from = vg.accessor(\"data\"),\n      fields = [],\n      as = null;\n  \n  var copy = vg.data.mapper(function(d) {\n    var src = from(d), i, len,\n        source = fields,\n        target = as || fields;\n    for (i=0, len=fields.length; i<len; ++i) {\n      d[target[i]] = src[fields[i]];\n    }\n    return d;\n  });\n\n  copy.from = function(field) {\n    from = vg.accessor(field);\n    return copy;\n  };\n  \n  copy.fields = function(fieldList) {\n    fields = vg.array(fieldList);\n    return copy;\n  };\n  \n  copy.as = function(fieldList) {\n    as = vg.array(fieldList);\n    return copy;\n  };\n\n  return copy;\n};vg.data.cross = function() {\n  var other = null,\n      nodiag = false,\n      output = {left:\"a\", right:\"b\"};\n\n  function cross(data) {\n    var result = [],\n        data2 = other || data,\n        o, i, j, n = data.length;\n\n    for (i=0; i<n; ++i) {\n      for (j=0; j<n; ++j) {\n        if (nodiag && i===j) continue;\n        o = {};\n        o[output.left] = data[i];\n        o[output.right] = data2[j];\n        result.push(o);\n      }\n    }\n    return result;\n  }\n\n  cross[\"with\"] = function(d) {\n    other = d;\n    return cross;\n  };\n  \n  cross.diagonal = function(x) {\n    nodiag = !x;\n    return cross;\n  };\n\n  cross.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) { output[k] = map[k]; }\n    });\n    return cross;\n  };\n\n  return cross;\n};\nvg.data.facet = function() {\n\n  var keys = [],\n      sort = null;\n\n  function facet(data) {\n    var result = {\n          key: \"\",\n          keys: [],\n          values: []\n        },\n        map = {},\n        vals = result.values,\n        obj, klist, kstr, len, i, j, k, kv, cmp;\n\n    if (keys.length === 0) {\n      // if no keys, skip collation step\n      vals.push(obj = {\n        key: \"\", keys: [], index: 0,\n        values: sort ? data.slice() : data\n      });\n      if (sort) sort(obj.values);\n      return result;\n    }\n\n    for (i=0, len=data.length; i<len; ++i) {\n      for (k=0, klist=[], kstr=\"\"; k<keys.length; ++k) {\n        kv = keys[k](data[i]);\n        klist.push(kv);\n        kstr += (k>0 ? \"|\" : \"\") + String(kv);\n      }\n      obj = map[kstr];\n      if (obj === undefined) {\n        vals.push(obj = map[kstr] = {\n          key: kstr,\n          keys: klist,\n          index: vals.length,\n          values: []\n        });\n      }\n      obj.values.push(data[i]);\n    }\n\n    if (sort) {\n      for (i=0, len=vals.length; i<len; ++i) {\n        sort(vals[i].values);\n      }\n    }\n\n    return result;\n  }\n\n  facet.keys = function(k) {\n    keys = vg.array(k).map(vg.accessor);\n    return facet;\n  };\n\n  facet.sort = function(s) {\n    sort = vg.data.sort().by(s);\n    return facet;\n  };\n\n  return facet;\n};vg.data.filter = function() {\n\n  var test = null;\n\n  function filter(data) {\n    return test ? data.filter(test) : data;\n  }\n  \n  filter.test = function(func) {\n    test = vg.isFunction(func) ? func : vg.parse.expr(func);\n    return filter;\n  };\n\n  return filter;\n};vg.data.flatten = function() {\n    \n  function flatten(data) {\n    return flat(data, []);\n  }\n  \n  function flat(data, list) {\n    if (data.values) {\n      for (var i=0, n=data.values.length; i<n; ++i) {\n        flat(data.values[i], list);\n      }\n    } else {\n      list.push(data);\n    }\n    return list;\n  }\n  \n  return flatten;\n};vg.data.fold = function() {\n  var fields = [],\n      accessors = [],\n      output = {\n        key: \"key\",\n        value: \"value\"\n      };\n\n  function fold(data) {\n    var values = [],\n        item, i, j, n, m = fields.length;\n\n    for (i=0, n=data.length; i<n; ++i) {\n      item = data[i];\n      for (j=0; j<m; ++j) {\n        var o = {\n          index: values.length,\n          data: item.data\n        };\n        o[output.key] = fields[j];\n        o[output.value] = accessors[j](item);\n        values.push(o);\n      }\n    }\n\n    return values;\n  }  \n\n  fold.fields = function(f) {\n    fields = vg.array(f);\n    accessors = fields.map(vg.accessor);\n    return fold;\n  };\n\n  fold.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return fold;\n  };\n\n  return fold;\n};vg.data.force = function() {\n  var layout = d3.layout.force(),\n      links = null,\n      linkDistance = 20,\n      linkStrength = 1,\n      charge = -30,\n      iterations = 500,\n      size = [\"width\", \"height\"],\n      params = [\n        \"friction\",\n        \"theta\",\n        \"gravity\",\n        \"alpha\"\n      ];\n\n  function force(data, db, group) {\n    layout\n      .size(vg.data.size(size, group))\n      .nodes(data);\n\n    if (links && db[links]) {\n      layout.links(db[links]);\n    }\n\n    layout.start();\n    for (var i=0; i<iterations; ++i) {\n      layout.tick();\n    }\n    layout.stop();\n  \n    return data;\n  }\n\n  force.links = function(dataSetName) {\n    links = dataSetName;\n    return force;\n  };\n\n  force.size = function(sz) {\n    size = sz;\n    return force;\n  };\n\n  force.linkDistance = function(field) {\n    linkDistance = typeof field === 'number'\n      ? field\n      : vg.accessor(field);\n    layout.linkDistance(linkDistance);\n    return force;\n  };\n\n  force.linkStrength = function(field) {\n    linkStrength = typeof field === 'number'\n      ? field\n      : vg.accessor(field);\n    layout.linkStrength(linkStrength);\n    return force;\n  };\n\n  force.charge = function(field) {\n    charge = typeof field === 'number'\n      ? field\n      : vg.accessor(field);\n    layout.charge(charge);\n    return force;\n  };\n\n  force.iterations = function(iter) {\n    iterations = iter;\n    return force;\n  };\n\n  params.forEach(function(name) {\n    force[name] = function(x) {\n      layout[name](x);\n      return force;\n    }\n  });\n\n  return force;\n};\n\nvg.data.force.dependencies = [\"links\"];vg.data.formula = (function() {\n  \n  return function() {\n    var field = null,\n        expr = vg.identity;\n  \n    var formula = vg.data.mapper(function(d, i, list) {\n      if (field) d[field] = expr.call(null, d, i, list);\n      return d;\n    });\n\n    formula.field = function(name) {\n      field = name;\n      return formula;\n    };\n  \n    formula.expr = function(func) {\n      expr = vg.isFunction(func) ? func : vg.parse.expr(func);\n      return formula;\n    };\n\n    return formula;\n  };\n})();vg.data.geo = (function() {\n  var params = [\n    \"center\",\n    \"scale\",\n    \"translate\",\n    \"rotate\",\n    \"precision\",\n    \"clipAngle\"\n  ];\n\n  function geo() {\n    var opt = {},\n        projection = \"mercator\",\n        func = d3.geo[projection](),\n        lat = vg.identity,\n        lon = vg.identity,\n        output = {\n          \"x\": \"x\",\n          \"y\": \"y\"\n        };\n    \n    var map = vg.data.mapper(function(d) {\n      var ll = [lon(d), lat(d)],\n          xy = func(ll);\n      d[output.x] = xy[0];\n      d[output.y] = xy[1];\n      return d;\n    });\n\n    map.func = function() {\n      return func;\n    };\n        \n    map.projection = function(p) {\n      if (projection !== p) {\n        projection = p;\n        func = d3.geo[projection]();\n        for (var name in opt) {\n          func[name](opt[name]);\n        }\n      }\n      return map;\n    };\n\n    params.forEach(function(name) {\n      map[name] = function(x) {\n        opt[name] = x;\n        func[name](x);\n        return map;\n      }\n    });\n    \n    map.lon = function(field) {\n      lon = vg.accessor(field);\n      return map;\n    };\n\n    map.lat = function(field) {\n      lat = vg.accessor(field);\n      return map;\n    };\n    \n    map.output = function(map) {\n      vg.keys(output).forEach(function(k) {\n        if (map[k] !== undefined) {\n          output[k] = map[k];\n        }\n      });\n      return map;\n    };\n    \n    \n    return map;\n  };\n  \n  geo.params = params;\n  return geo;\n})();vg.data.geopath = function() {\n  var geopath = d3.geo.path().projection(d3.geo.mercator()),\n      projection = \"mercator\",\n      geojson = vg.identity,\n      opt = {},\n      output = {\"path\": \"path\"};\n\n  var map = vg.data.mapper(function(d) {\n    d[output.path] = geopath(geojson(d));\n    return d;\n  });\n  \n  map.projection = function(proj) {\n    if (projection !== proj) {\n      projection = proj;\n      var p = d3.geo[projection]();\n      for (var name in opt) {\n        p[name](opt[name]);\n      }\n      geopath.projection(p);\n    }\n    return map;\n  };\n  \n  vg.data.geo.params.forEach(function(name) {\n    map[name] = function(x) {\n      opt[name] = x;\n      (geopath.projection())[name](x);\n      return map;\n    }\n  });\n   \n  map.value = function(field) {\n    geojson = vg.accessor(field);\n    return map;\n  };\n\n  map.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return map;\n  };\n\n  return map;\n};vg.data.link = function() {\n  var shape = \"line\",\n      source = vg.accessor(\"source\"),\n      target = vg.accessor(\"target\"),\n      tension = 0.2,\n      output = {\"path\": \"path\"};\n  \n  function line(d) {\n    var s = source(d),\n        t = target(d);\n    return \"M\" + s.x + \",\" + s.y \n         + \"L\" + t.x + \",\" + t.y;\n  }\n\n  function curve(d) {\n    var s = source(d),\n        t = target(d),\n        dx = t.x - s.x,\n        dy = t.y - s.y,\n        ix = tension * (dx + dy),\n        iy = tension * (dy - dx);\n    return \"M\" + s.x + \",\" + s.y\n         + \"C\" + (s.x+ix) + \",\" + (s.y+iy)\n         + \" \" + (t.x+iy) + \",\" + (t.y-ix)\n         + \" \" + t.x + \",\" + t.y;\n  }\n  \n  function diagonalX(d) {\n    var s = source(d),\n        t = target(d),\n        m = (s.x + t.x) / 2;\n    return \"M\" + s.x + \",\" + s.y\n         + \"C\" + m   + \",\" + s.y\n         + \" \" + m   + \",\" + t.y\n         + \" \" + t.x + \",\" + t.y;\n  }\n\n  function diagonalY(d) {\n    var s = source(d),\n        t = target(d),\n        m = (s.y + t.y) / 2;\n    return \"M\" + s.x + \",\" + s.y\n         + \"C\" + s.x + \",\" + m\n         + \" \" + t.x + \",\" + m\n         + \" \" + t.x + \",\" + t.y;\n  }\n\n  var shapes = {\n    line:      line,\n    curve:     curve,\n    diagonal:  diagonalX,\n    diagonalX: diagonalX,\n    diagonalY: diagonalY\n  };\n  \n  function link(data) {\n    var path = shapes[shape];\n        \n    data.forEach(function(d) {\n      d[output.path] = path(d);\n    });\n    \n    return data;\n  }\n\n  link.shape = function(val) {\n    shape = val;\n    return link;\n  };\n\n  link.tension = function(val) {\n    tension = val;\n    return link;\n  };\n  \n  link.source = function(field) {\n    source = vg.accessor(field);\n    return link;\n  };\n  \n  link.target = function(field) {\n    target = vg.accessor(field);\n    return link;\n  };\n  \n  link.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return link;\n  };\n  \n  return link;\n};vg.data.pie = function() {\n  var one = function() { return 1; },\n      value = one,\n      start = 0,\n      end = 2 * Math.PI,\n      sort = false,\n      output = {\n        \"startAngle\": \"startAngle\",\n        \"endAngle\": \"endAngle\",\n        \"midAngle\": \"midAngle\"\n      };\n\n  function pie(data) {\n    var values = data.map(function(d, i) { return +value(d); }),\n        a = start,\n        k = (end - start) / d3.sum(values),\n        index = d3.range(data.length);\n    \n    if (sort) {\n      index.sort(function(a, b) {\n        return values[a] - values[b];\n      });\n    }\n    \n    index.forEach(function(i) {\n      var d;\n      data[i].value = (d = values[i]);\n      data[i][output.startAngle] = a;\n      data[i][output.midAngle] = (a + 0.5 * d * k);\n      data[i][output.endAngle] = (a += d * k);\n    });\n    \n    return data;\n  }\n\n  pie.sort = function(b) {\n    sort = b;\n    return pie;\n  };\n       \n  pie.value = function(field) {\n    value = field ? vg.accessor(field) : one;\n    return pie;\n  };\n  \n  pie.startAngle = function(startAngle) {\n    start = Math.PI * startAngle / 180;\n    return pie;\n  };\n  \n  pie.endAngle = function(endAngle) {\n    end = Math.PI * endAngle / 180;\n    return pie;\n  };\n\n  pie.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return pie;\n  };\n\n  return pie;\n};vg.data.slice = function() {\n  var by = null,\n      field = vg.accessor(\"data\");\n\n  function slice(data) {\n    data = vg.values(data);\n    \n    if (by === \"min\") {\n      data = [data[vg.minIndex(data, field)]];\n    } else if (by === \"max\") {\n      data = [data[vg.maxIndex(data, field)]];\n    } else if (by === \"median\") {\n      var list = data.slice().sort(function(a,b) {\n        a = field(a); b = field(b);\n        return a < b ? -1 : a > b ? 1 : 0;\n      });\n      data = [data[~~(list.length/2)]];\n    } else {\n      var idx = vg.array(by);\n      data = data.slice(idx[0], idx[1]);\n    }\n    return data;\n  }\n  \n  slice.by = function(x) {\n    by = x;\n    return slice;\n  };\n  \n  slice.field = function(f) {\n    field = vg.accessor(f);\n    return slice;\n  };\n\n  return slice;\n};vg.data.sort = function() {\n  var by = null;\n\n  function sort(data) {\n    data = (vg.isArray(data) ? data : data.values || []);\n    data.sort(by);\n    for (var i=0, n=data.length; i<n; ++i) data[i].index = i; // re-index\n    return data;\n  }\n  \n  sort.by = function(s) {\n    by = vg.comparator(s);\n    return sort;\n  };\n\n  return sort;\n};vg.data.stack = function() {\n  var layout = d3.layout.stack(),\n      point = vg.accessor(\"index\"),\n      height = vg.accessor(\"data\"),\n      params = [\"offset\", \"order\"],\n      output = {\n        \"y0\": \"y2\",\n        \"y1\": \"y\",\n        \"cy\": \"cy\"\n      };\n\n  function stack(data) {\n    var out_y0 = output[\"y0\"],\n        out_y1 = output[\"y1\"],\n        out_cy = output[\"cy\"];\n    \n    var series = stacks(data);\n    if (series.length === 0) return data;\n    \n    layout.out(function(d, y0, y) {\n      if (d.datum) {\n        d.datum[out_y0] = y0;\n        d.datum[out_y1] = y + y0;\n        d.datum[out_cy] = y0 + y/2;\n      }\n    })(series);\n    \n    return data;\n  }\n  \n  function stacks(data) {\n    var values = vg.values(data),\n        points = [], series = [],\n        a, i, n, j, m, k, p, v, x;\n\n    // exit early if no data\n    if (values.length === 0) return series;\n\n    // collect and sort data points\n    for (i=0, n=values.length; i<n; ++i) {\n      a = vg.values(values[i]);\n      for (j=0, m=a.length; j<m; ++j) {\n        points.push({x:point(a[j]), y:height(a[j]), z:i, datum:a[j]});\n      }\n      series.push([]);\n    }\n    points.sort(function(a,b) {\n      return a.x<b.x ? -1 : a.x>b.x ? 1 : (a.z<b.z ? -1 : a.z>b.z ? 1 : 0);\n    });\n\n    // emit data series for stack layout\n    for (x=points[0].x, i=0, j=0, k=0, n=points.length; k<n; ++k) {\n      p = points[k];    \n      if (p.x !== x) {\n        while (i < series.length) series[i++].push({x:j, y:0});\n        x = p.x; i = 0; j += 1;\n      }\n      while (p.z > i) series[i++].push({x:j, y:0});\n      p.x = j;\n      series[i++].push(p);\n    }\n    while (i < series.length) series[i++].push({x:j, y:0});\n\n    return series;\n  }\n       \n  stack.point = function(field) {\n    point = vg.accessor(field);\n    return stack;\n  };\n  \n  stack.height = function(field) {\n    height = vg.accessor(field);\n    return stack;\n  };\n\n  params.forEach(function(name) {\n    stack[name] = function(x) {\n      layout[name](x);\n      return stack;\n    }\n  });\n\n  stack.output = function(map) {\n    d3.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return stack;\n  };\n\n  return stack;\n};vg.data.stats = function() {\n  var value = vg.accessor(\"data\"),\n      assign = false,\n      median = false,\n      output = {\n        \"count\":    \"count\",\n        \"min\":      \"min\",\n        \"max\":      \"max\",\n        \"sum\":      \"sum\",\n        \"mean\":     \"mean\",\n        \"variance\": \"variance\",\n        \"stdev\":    \"stdev\",\n        \"median\":   \"median\"\n      };\n\n  function reduce(data) {\n    var min = +Infinity,\n        max = -Infinity,\n        sum = 0,\n        mean = 0,\n        M2 = 0,\n        i, len, v, delta;\n\n    var list = (vg.isArray(data) ? data : data.values || []).map(value);\n\n    // compute aggregates\n    for (i=0, len=list.length; i<len; ++i) {\n      v = list[i];\n      if (v < min) min = v;\n      if (v > max) max = v;\n      sum += v;\n      delta = v - mean;\n      mean = mean + delta / (i+1);\n      M2 = M2 + delta * (v - mean);\n    }\n    M2 = M2 / (len - 1);\n\n    var o = vg.isArray(data) ? {} : data;\n    if (median) {\n      list.sort(vg.numcmp);\n      i = list.length >> 1;\n      o[output.median] = list.length % 2\n        ? list[i]\n        : (list[i-1] + list[i])/2;\n    }\n    o[output.count] = len;\n    o[output.min] = min;\n    o[output.max] = max;\n    o[output.sum] = sum;\n    o[output.mean] = mean;\n    o[output.variance] = M2;\n    o[output.stdev] = Math.sqrt(M2);\n\n    if (assign) {\n      list = (vg.isArray(data) ? data : data.values);\n      v = {};\n      v[output.count] = len;\n      v[output.min] = min;\n      v[output.max] = max;\n      v[output.sum] = sum;\n      v[output.mean] = mean;\n      v[output.variance] = M2;\n      v[output.stdev] = Math.sqrt(M2);\n      if (median) v[output.median] = o[output.median];\n      for (i=0, len=list.length; i<len; ++i) {\n        list[i].stats = v;\n      }\n      if (vg.isArray(data)) o = list;\n    }\n\n    return o;\n  }\n\n  function stats(data) {\n    if (vg.isArray(data)) {\n      return reduce(data);\n    } else {\n      return (data.values || []).map(reduce);\n    }\n  }\n\n  stats.median = function(bool) {\n    median = bool || false;\n    return stats;\n  };\n\n  stats.value = function(field) {\n    value = vg.accessor(field);\n    return stats;\n  };\n\n  stats.assign = function(b) {\n    assign = b;\n    return stats;\n  };\n\n  stats.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return stats;\n  };\n\n  return stats;\n};vg.data.treemap = function() {\n  var layout = d3.layout.treemap()\n                 .children(function(d) { return d.values; }),\n      value = vg.accessor(\"data\"),\n      size = [\"width\", \"height\"],\n      params = [\"round\", \"sticky\", \"ratio\", \"padding\"],\n      output = {\n        \"x\": \"x\",\n        \"y\": \"y\",\n        \"dx\": \"width\",\n        \"dy\": \"height\"\n      };\n\n  function treemap(data, db, group) {\n    data = layout\n      .size(vg.data.size(size, group))\n      .value(value)\n      .nodes(vg.isTree(data) ? data : {values: data});\n    \n    var keys = vg.keys(output),\n        len = keys.length;\n    data.forEach(function(d) {\n      var key, val;\n      for (var i=0; i<len; ++i) {\n        key = keys[i];\n        if (key !== output[key]) {\n          val = d[key];\n          delete d[key];\n          d[output[key]] = val;\n        }\n      }\n    });\n    \n    return data;\n  }\n\n  treemap.size = function(sz) {\n    size = sz;\n    return treemap;\n  };\n\n  treemap.value = function(field) {\n    value = vg.accessor(field);\n    return treemap;\n  };\n\n  params.forEach(function(name) {\n    treemap[name] = function(x) {\n      layout[name](x);\n      return treemap;\n    }\n  });\n\n  treemap.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return treemap;\n  };\n\n  return treemap;\n};vg.data.truncate = function() {\n  var value = vg.accessor(\"data\"),\n      as = \"truncate\",\n      position = \"right\",\n      ellipsis = \"...\",\n      wordBreak = true,\n      limit = 100;\n  \n  var truncate = vg.data.mapper(function(d) {\n    var text = vg.truncate(value(d), limit, position, wordBreak, ellipsis);\n    return (d[as] = text, d);\n  });\n\n  truncate.value = function(field) {\n    value = vg.accessor(field);\n    return truncate;\n  };\n  \n  truncate.output = function(field) {\n    as = field;\n    return truncate;\n  };\n\n  truncate.limit = function(len) {\n    limit = +len;\n    return truncate;\n  };\n  \n  truncate.position = function(pos) {\n    position = pos;\n    return truncate;\n  };\n\n  truncate.ellipsis = function(str) {\n    ellipsis = str+\"\";\n    return truncate;\n  };\n\n  truncate.wordbreak = function(b) {\n    wordBreak = !!b;\n    return truncate;\n  };\n\n  return truncate;\n};vg.data.unique = function() {\n\n  var field = null,\n      as = \"field\";\n\n  function unique(data) {\n    return vg.unique(data, field)\n      .map(function(x) {\n        var o = {};\n        o[as] = x;\n        return o;\n      });\n  }\n  \n  unique.field = function(f) {\n    field = vg.accessor(f);\n    return unique;\n  };\n  \n  unique.as = function(x) {\n    as = x;\n    return unique;\n  };\n\n  return unique;\n};vg.data.window = function() {\n\n  var size = 2,\n      step = 1;\n  \n  function win(data) {\n    data = vg.isArray(data) ? data : data.values || [];\n    var runs = [], i, j, n=data.length-size, curr;\n    for (i=0; i<=n; i+=step) {\n      for (j=0, curr=[]; j<size; ++j) curr.push(data[i+j]);\n      runs.push({key: i, values: curr});\n    }\n    return {values: runs};\n  }\n  \n  win.size = function(n) {\n    size = n;\n    return win;\n  };\n  \n  win.step = function(n) {\n    step = n;\n    return win;\n  };\n\n  return win;\n};vg.data.wordcloud = function() {\n  var layout = d3.layout.cloud().size([900, 500]),\n      text = vg.accessor(\"data\"),\n      size = [\"width\", \"height\"],\n      fontSize = function() { return 14; },\n      rotate = function() { return 0; },\n      params = [\"font\", \"fontStyle\", \"fontWeight\", \"padding\"];\n  \n  var output = {\n    \"x\": \"x\",\n    \"y\": \"y\",\n    \"size\": \"fontSize\",\n    \"font\": \"font\",\n    \"rotate\": \"angle\"\n  };\n  \n  function cloud(data, db, group) {\n    function finish(tags, bounds) {\n      var size = layout.size(),\n          dx = size[0] / 2,\n          dy = size[1] / 2,\n          keys = vg.keys(output),\n          key, d, i, n, k, m = keys.length;\n\n      // sort data to match wordcloud order\n      data.sort(function(a,b) {\n        return fontSize(b) - fontSize(a);\n      });\n\n      for (i=0, n=tags.length; i<n; ++i) {\n        d = data[i];\n        for (k=0; k<m; ++k) {\n          key = keys[k];\n          d[output[key]] = tags[i][key];\n          if (key === \"x\") d[output.x] += dx;\n          if (key === \"y\") d[output.y] += dy;\n        }\n      }\n    }\n    \n    layout\n      .size(vg.data.size(size, group))\n      .text(text)\n      .fontSize(fontSize)\n      .rotate(rotate)\n      .words(data)\n      .on(\"end\", finish)\n      .start();\n    return data;\n  }\n\n  cloud.text = function(field) {\n    text = vg.accessor(field);\n    return cloud;\n  };\n  \n  cloud.size = function(sz) {\n    size = sz;\n    return cloud;\n  };\n         \n  cloud.fontSize = function(field) {\n    fontSize = vg.accessor(field);\n    return cloud;\n  };\n  \n  cloud.rotate = function(x) {\n    var v;\n    if (vg.isObject(x) && !Array.isArray(x)) {\n      if (x.random !== undefined) {\n        v = (v = x.random) ? vg.array(v) : [0];\n        rotate = function() {\n          return v[~~(Math.random()*v.length-0.00001)];\n        };\n      } else if (x.alternate !== undefined) {\n        v = (v = x.alternate) ? vg.array(v) : [0];\n        rotate = function(d, i) {\n          return v[i % v.length];\n        };\n      }\n    } else {\n      rotate = vg.accessor(field);\n    }\n    return cloud;\n  };\n\n  params.forEach(function(name) {\n    cloud[name] = function(x) {\n      layout[name](x);\n      return cloud;\n    }\n  });\n\n  cloud.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return cloud;\n  };\n  \n  return cloud;\n};vg.data.zip = function() {\n  var z = null,\n      as = \"zip\",\n      key = vg.accessor(\"data\"),\n      defaultValue = undefined,\n      withKey = null;\n\n  function zip(data, db) {\n    var zdata = db[z], zlen = zdata.length, v, d, i, len, map;\n    \n    if (withKey) {\n      map = {};\n      zdata.forEach(function(s) { map[withKey(s)] = s; });\n    }\n    \n    for (i=0, len=data.length; i<len; ++i) {\n      d = data[i];\n      d[as] = map\n        ? ((v=map[key(d)]) != null ? v : defaultValue)\n        : zdata[i % zlen];\n    }\n    \n    return data;\n  }\n\n  zip[\"with\"] = function(d) {\n    z = d;\n    return zip;\n  };\n  \n  zip[\"default\"] = function(d) {\n    defaultValue = d;\n    return zip;\n  };\n\n  zip.as = function(name) {\n    as = name;\n    return zip;\n  };\n\n  zip.key = function(k) {\n    key = vg.accessor(k);\n    return zip;\n  };\n\n  zip.withKey = function(k) {\n    withKey = vg.accessor(k);\n    return zip;\n  };\n\n  return zip;\n};\n\nvg.data.zip.dependencies = [\"with\"];vg.parse = {};vg.parse.axes = (function() {\n  var ORIENT = {\n    \"x\":      \"bottom\",\n    \"y\":      \"left\",\n    \"top\":    \"top\",\n    \"bottom\": \"bottom\",\n    \"left\":   \"left\",\n    \"right\":  \"right\"\n  };\n\n  function axes(spec, axes, scales) {\n    (spec || []).forEach(function(def, index) {\n      axes[index] = axes[index] || vg.scene.axis();\n      axis(def, index, axes[index], scales);\n    });\n  };\n\n  function axis(def, index, axis, scales) {\n    // axis scale\n    if (def.scale !== undefined) {\n      axis.scale(scales[def.scale]);\n    }\n\n    // axis orientation\n    axis.orient(def.orient || ORIENT[def.type]);\n    // axis offset\n    axis.offset(def.offset || 0);\n    // axis layer\n    axis.layer(def.layer || \"front\");\n    // axis grid lines\n    axis.grid(def.grid || false);\n    // axis title\n    axis.title(def.title || null);\n    // axis title offset\n    axis.titleOffset(def.titleOffset != null\n      ? def.titleOffset : vg.config.axis.titleOffset);\n    // axis values\n    axis.tickValues(def.values || null);\n    // axis label formatting\n    axis.tickFormat(def.format || null);\n    // axis tick subdivision\n    axis.tickSubdivide(def.subdivide || 0);\n    // axis tick padding\n    axis.tickPadding(def.tickPadding || vg.config.axis.padding);\n\n    // axis tick size(s)\n    var size = [];\n    if (def.tickSize !== undefined) {\n      for (var i=0; i<3; ++i) size.push(def.tickSize);\n    } else {\n      var ts = vg.config.axis.tickSize;\n      size = [ts, ts, ts];\n    }\n    if (def.tickSizeMajor != null) size[0] = def.tickSizeMajor;\n    if (def.tickSizeMinor != null) size[1] = def.tickSizeMinor;\n    if (def.tickSizeEnd   != null) size[2] = def.tickSizeEnd;\n    if (size.length) {\n      axis.tickSize.apply(axis, size);\n    }\n\n    // tick arguments\n    if (def.ticks != null) {\n      var ticks = vg.isArray(def.ticks) ? def.ticks : [def.ticks];\n      axis.ticks.apply(axis, ticks);\n    } else {\n      axis.ticks(vg.config.axis.ticks);\n    }\n\n    // style properties\n    var p = def.properties;\n    if (p && p.ticks) {\n      axis.majorTickProperties(p.majorTicks\n        ? vg.extend({}, p.ticks, p.majorTicks) : p.ticks);\n      axis.minorTickProperties(p.minorTicks\n        ? vg.extend({}, p.ticks, p.minorTicks) : p.ticks);\n    } else {\n      axis.majorTickProperties(p && p.majorTicks || {});\n      axis.minorTickProperties(p && p.minorTicks || {});\n    }\n    axis.tickLabelProperties(p && p.labels || {});\n    axis.titleProperties(p && p.title || {});\n    axis.gridLineProperties(p && p.grid || {});\n    axis.domainProperties(p && p.axis || {});\n  }\n\n  return axes;\n})();\nvg.parse.data = function(spec, callback) {\n  var model = {\n    defs: spec,\n    load: {},\n    flow: {},\n    deps: {},\n    source: {},\n    sorted: null\n  };\n\n  var count = 0;\n  \n  function load(d) {\n    return function(error, data) {\n      if (error) {\n        vg.error(\"LOADING FAILED: \" + d.url);\n      } else {\n        model.load[d.name] = vg.data.read(data.toString(), d.format);\n      }\n      if (--count === 0) callback();\n    }\n  }\n  \n  // process each data set definition\n  (spec || []).forEach(function(d) {\n    if (d.url) {\n      count += 1;\n      vg.data.load(d.url, load(d)); \n    } else if (d.values) {\n      model.load[d.name] = vg.data.read(d.values, d.format);\n    } else if (d.source) {\n      (model.source[d.source] || (model.source[d.source] = [])).push(d.name);\n    }\n    \n    if (d.transform) {\n      var flow = vg.parse.dataflow(d);\n      model.flow[d.name] = flow;\n      flow.dependencies.forEach(function(dep) {\n        (model.deps[dep] || (model.deps[dep] = [])).push(d.name);\n      });\n    }\n  });\n  \n  // topological sort by dependencies\n  var names = (spec || []).map(vg.accessor(\"name\")),\n      order = [], v = {}, n;\n  function visit(n) {\n    if (v[n] === 1) return; // not a DAG!\n    if (!v[n]) {\n      v[n] = 1;\n      (model.source[n] || []).forEach(visit);\n      (model.deps[n] || []).forEach(visit);\n      v[n] = 2;\n      order.push(n);\n    }\n  }\n  while (names.length) { if (v[n=names.pop()] !== 2) visit(n); }\n  model.sorted = order.reverse();\n  \n  if (count === 0) setTimeout(callback, 1);\n  return model;\n};vg.parse.dataflow = function(def) {\n  var tx = (def.transform || []).map(vg.parse.transform),\n      df = tx.length\n        ? function(data, db, group) {\n            return tx.reduce(function(d,t) { return t(d,db,group); }, data);\n          }\n        : vg.identity;\n  df.transforms = tx;\n  df.dependencies = vg.keys((def.transform || [])\n    .reduce(function(map, tdef) {\n      var deps = vg.data[tdef.type].dependencies;\n      if (deps) deps.forEach(function(d) {\n        if (tdef[d]) map[tdef[d]] = 1;\n      });\n      return map;\n    }, {}));\n  return df;\n};vg.parse.expr = (function() {\n\n  var CONSTANT = {\n  \t\"E\":       \"Math.E\",\n  \t\"LN2\":     \"Math.LN2\",\n  \t\"LN10\":    \"Math.LN10\",\n  \t\"LOG2E\":   \"Math.LOG2E\",\n  \t\"LOG10E\":  \"Math.LOG10E\",\n  \t\"PI\":      \"Math.PI\",\n  \t\"SQRT1_2\": \"Math.SQRT1_2\",\n  \t\"SQRT2\":   \"Math.SQRT2\"\n  };\n\n  var FUNCTION = {\n  \t\"abs\":    \"Math.abs\",\n  \t\"acos\":   \"Math.acos\",\n  \t\"asin\":   \"Math.asin\",\n  \t\"atan\":   \"Math.atan\",\n  \t\"atan2\":  \"Math.atan2\",\n  \t\"ceil\":   \"Math.ceil\",\n  \t\"cos\":    \"Math.cos\",\n  \t\"exp\":    \"Math.exp\",\n  \t\"floor\":  \"Math.floor\",\n  \t\"log\":    \"Math.log\",\n  \t\"max\":    \"Math.max\",\n  \t\"min\":    \"Math.min\",\n  \t\"pow\":    \"Math.pow\",\n  \t\"random\": \"Math.random\",\n  \t\"round\":  \"Math.round\",\n  \t\"sin\":    \"Math.sin\",\n  \t\"sqrt\":   \"Math.sqrt\",\n  \t\"tan\":    \"Math.tan\"\n  };\n\n  var lexer = /([\\\"\\']|[\\=\\<\\>\\~\\&\\|\\?\\:\\+\\-\\/\\*\\%\\!\\^\\,\\;\\[\\]\\{\\}\\(\\) ]+)/;\n\n  return function(x) {\n    if (vg.config.safeMode) {\n      vg.error(\"Safe mode: Expression parsing disabled.\");\n      return vg.true;\n    }\n\n    var tokens = x.split(lexer),\n        t, v, i, n, sq, dq;\n\n    for (sq=0, dq=0, i=0, n=tokens.length; i<n; ++i) {\n      var t = tokens[i];\n      if (t===\"'\") { if (!dq) sq = !sq; continue; }\n      if (t==='\"') { if (!sq) dq = !dq; continue; }\n      if (dq || sq) continue;\n      if (CONSTANT[t]) {\n        tokens[i] = CONSTANT[t];\n      }\n      if (FUNCTION[t] && (v=tokens[i+1]) && v[0]===\"(\") {\n        tokens[i] = FUNCTION[t];\n      }\n    }\n\n    return Function(\"d\", \"index\", \"data\", \"return (\"+tokens.join(\"\")+\");\");\n  };\n\n})();vg.parse.legends = (function() {\n\n  function legends(spec, legends, scales) {\n    (spec || []).forEach(function(def, index) {\n      legends[index] = legends[index] || vg.scene.legend();\n      legend(def, index, legends[index], scales);\n    });\n  };\n\n  function legend(def, index, legend, scales) {\n    // legend scales\n    legend.size  (def.size   ? scales[def.size]   : null);\n    legend.shape (def.shape  ? scales[def.shape]  : null);\n    legend.fill  (def.fill   ? scales[def.fill]   : null);\n    legend.stroke(def.stroke ? scales[def.stroke] : null);\n\n    // legend orientation\n    if (def.orient) legend.orient(def.orient);\n\n    // legend offset\n    if (def.offset != null) legend.offset(def.offset);\n\n    // legend title\n    legend.title(def.title || null);\n\n    // legend values\n    legend.values(def.values || null);\n\n    // legend label formatting\n    legend.format(def.format !== undefined ? def.format : null);\n\n    // style properties\n    var p = def.properties;\n    legend.titleProperties(p && p.title || {});\n    legend.labelProperties(p && p.labels || {});\n    legend.legendProperties(p && p.legend || {});\n    legend.symbolProperties(p && p.symbols || {});\n    legend.gradientProperties(p && p.gradient || {});\n  }\n  \n  return legends;\n})();vg.parse.mark = function(mark) {\n  var props = mark.properties,\n      group = mark.marks;\n\n  // parse mark property definitions\n  vg.keys(props).forEach(function(k) {\n    props[k] = vg.parse.properties(mark.type, props[k]);\n  });\n\n  // parse delay function\n  if (mark.delay) {\n    mark.delay = vg.parse.properties(mark.type, {delay: mark.delay});\n  }\n\n  // parse mark data definition\n  if (mark.from) {\n    var name = mark.from.data,\n        tx = vg.parse.dataflow(mark.from);\n    mark.from = function(db, group, parentData) {\n      var data = vg.scene.data(name ? db[name] : null, parentData);\n      return tx(data, db, group);\n    };\n  }\n\n  // recurse if group type\n  if (group) {\n    mark.marks = group.map(vg.parse.mark);\n  }\n    \n  return mark;\n};vg.parse.marks = function(spec, width, height) {\n  return {\n    type: \"group\",\n    width: width,\n    height: height,\n    scales: spec.scales || [],\n    axes: spec.axes || [],\n    legends: spec.legends || [],\n    marks: (spec.marks || []).map(vg.parse.mark)\n  };\n};vg.parse.padding = function(pad) {\n  if (pad == null) return \"auto\";\n  else if (vg.isString(pad)) return pad===\"strict\" ? \"strict\" : \"auto\";\n  else if (vg.isObject(pad)) return pad;\n  var p = vg.isNumber(pad) ? pad : 20;\n  return {top:p, left:p, right:p, bottom:p};\n};\nvg.parse.properties = (function() {\n  function compile(mark, spec) {\n    var code = \"\",\n        names = vg.keys(spec),\n        i, len, name, ref, vars = {};\n        \n    code += \"var o = trans ? {} : item;\\n\"\n    \n    for (i=0, len=names.length; i<len; ++i) {\n      ref = spec[name = names[i]];\n      code += (i > 0) ? \"\\n  \" : \"  \";\n      code += \"o.\"+name+\" = \"+valueRef(name, ref)+\";\";\n      vars[name] = true;\n    }\n    \n    if (vars.x2) {\n      if (vars.x) {\n        code += \"\\n  if (o.x > o.x2) { \"\n              + \"var t = o.x; o.x = o.x2; o.x2 = t; };\";\n        code += \"\\n  o.width = (o.x2 - o.x);\";\n      } else if (vars.width) {\n        code += \"\\n  o.x = (o.x2 - o.width);\";\n      } else {\n        code += \"\\n  o.x = o.x2;\"\n      }\n    }\n    if (vars.xc) {\n      if (vars.width) {\n        code += \"\\n  o.x = (o.xc - o.width/2);\";\n      } else {\n        code += \"\\n  o.x = o.xc;\"\n      }\n    }\n\n    if (vars.y2) {\n      if (vars.y) {\n        code += \"\\n  if (o.y > o.y2) { \"\n              + \"var t = o.y; o.y = o.y2; o.y2 = t; };\";\n        code += \"\\n  o.height = (o.y2 - o.y);\";\n      } else if (vars.height) {\n        code += \"\\n  o.y = (o.y2 - o.height);\";\n      } else {\n        code += \"\\n  o.y = o.y2;\"\n      }\n    }\n    if (vars.yc) {\n      if (vars.height) {\n        code += \"\\n  o.y = (o.yc - o.height/2);\";\n      } else {\n        code += \"\\n  o.y = o.yc;\"\n      }\n    }\n    \n    if (hasPath(mark, vars)) code += \"\\n  item.touch();\";\n    code += \"\\n  if (trans) trans.interpolate(item, o);\";\n\n    try {\n      return Function(\"item\", \"group\", \"trans\", code);\n    } catch (e) {\n      vg.error(e);\n      vg.log(code);\n    }\n  }\n  \n  function hasPath(mark, vars) {\n    return vars.path ||\n      ((mark===\"area\" || mark===\"line\") &&\n        (vars.x || vars.x2 || vars.width ||\n         vars.y || vars.y2 || vars.height ||\n         vars.tension || vars.interpolate));\n  }\n  \n  var GROUP_VARS = {\n    \"width\": 1,\n    \"height\": 1,\n    \"mark.group.width\": 1,\n    \"mark.group.height\": 1\n  };\n\n  function valueRef(name, ref) {\n    if (ref == null) return null;\n    var isColor = name===\"fill\" || name===\"stroke\";\n\n    if (isColor) {\n      if (ref.c) {\n        return colorRef(\"hcl\", ref.h, ref.c, ref.l);\n      } else if (ref.h || ref.s) {\n        return colorRef(\"hsl\", ref.h, ref.s, ref.l);\n      } else if (ref.l || ref.a) {\n        return colorRef(\"lab\", ref.l, ref.a, ref.b);\n      } else if (ref.r || ref.g || ref.b) {\n        return colorRef(\"rgb\", ref.r, ref.g, ref.b);\n      }\n    }\n\n    // initialize value\n    var val = \"item.datum.data\";\n    if (ref.value !== undefined) {\n      val = vg.str(ref.value);\n    }\n\n    // get field reference for enclosing group\n    if (ref.group != null) {\n      var grp = \"group.datum\";\n      if (vg.isString(ref.group)) {\n        grp = GROUP_VARS[ref.group]\n          ? \"group.\" + ref.group\n          : \"group.datum[\"+vg.field(ref.group).map(vg.str).join(\"][\")+\"]\";\n      }\n    }\n\n    // get data field value\n    if (ref.field != null) {\n      if (vg.isString(ref.field)) {\n        val = \"item.datum[\"+vg.field(ref.field).map(vg.str).join(\"][\")+\"]\";\n        if (ref.group != null) { val = \"this.accessor(\"+val+\")(\"+grp+\")\"; }\n      } else {\n        val = \"this.accessor(group.datum[\"\n            + vg.field(ref.field.group).map(vg.str).join(\"][\")\n            + \"])(item.datum.data)\";\n      }\n    } else if (ref.group != null) {\n      val = grp;\n    }\n\n    // run through scale function\n    if (ref.scale != null) {\n      var scale = vg.isString(ref.scale)\n        ? vg.str(ref.scale)\n        : (ref.scale.group ? \"group\" : \"item\")\n          + \".datum[\" + vg.str(ref.scale.group || ref.scale.field) + \"]\";\n      scale = \"group.scales[\" + scale + \"]\";\n      val = scale + (ref.band ? \".rangeBand()\" : \"(\"+val+\")\");\n    }\n    \n    // multiply, offset, return value\n    val = \"(\" + (ref.mult?(vg.number(ref.mult)+\" * \"):\"\") + val + \")\"\n      + (ref.offset ? \" + \" + vg.number(ref.offset) : \"\");\n    return val;\n  }\n  \n  function colorRef(type, x, y, z) {\n    var xx = x ? valueRef(\"\", x) : vg.config.color[type][0],\n        yy = y ? valueRef(\"\", y) : vg.config.color[type][1],\n        zz = z ? valueRef(\"\", z) : vg.config.color[type][2];\n    return \"(this.d3.\" + type + \"(\" + [xx,yy,zz].join(\",\") + ') + \"\")';\n  }\n  \n  return compile;\n})();vg.parse.scales = (function() {\n  var LINEAR = \"linear\",\n      ORDINAL = \"ordinal\",\n      LOG = \"log\",\n      POWER = \"pow\",\n      TIME = \"time\",\n      QUANTILE = \"quantile\",\n      GROUP_PROPERTY = {width: 1, height: 1};\n\n  function scales(spec, scales, db, group) {\n    return (spec || []).reduce(function(o, def) {\n      var name = def.name, prev = name + \":prev\";\n      o[name] = scale(def, o[name], db, group);\n      o[prev] = o[prev] || o[name];\n      return o;\n    }, scales || {});\n  }\n\n  function scale(def, scale, db, group) {\n    var s = instance(def, scale),\n        m = s.type===ORDINAL ? ordinal : quantitative,\n        rng = range(def, group),\n        data = vg.values(group.datum);\n\n    m(def, s, rng, db, data);\n    return s;\n  }\n\n  function instance(def, scale) {\n    var type = def.type || LINEAR;\n    if (!scale || type !== scale.type) {\n      var ctor = vg.config.scale[type] || d3.scale[type];\n      if (!ctor) vg.error(\"Unrecognized scale type: \" + type);\n      (scale = ctor()).type = scale.type || type;\n      scale.scaleName = def.name;\n    }\n    return scale;\n  }\n\n  function ordinal(def, scale, rng, db, data) {\n    var dataDrivenRange = false,\n        pad = def.padding || 0,\n        outer = def.outerPadding || 0,\n        domain, sort, str, refs;\n\n    // range pre-processing for data-driven ranges\n    if (vg.isObject(def.range) && !vg.isArray(def.range)) {\n      dataDrivenRange = true;\n      refs = def.range.fields || vg.array(def.range);\n      rng = extract(refs, db, data);\n    }\n\n    // domain\n    sort = def.sort && !dataDrivenRange;\n    domain = domainValues(def, db, data, sort);\n    if (domain) scale.domain(domain);\n\n    // width-defined range\n    if (def.bandWidth) {\n      var bw = def.bandWidth,\n          len = domain.length,\n          start = rng[0] || 0,\n          space = def.points ? (pad*bw) : (pad*bw*(len-1) + 2*outer);\n      rng = [start, start + (bw * len + space)];\n    }\n\n    // range\n    str = typeof rng[0] === 'string';\n    if (str || rng.length > 2 || rng.length===1 || dataDrivenRange) {\n      scale.range(rng); // color or shape values\n    } else if (def.points) {\n      scale.rangePoints(rng, pad);\n    } else if (def.round || def.round===undefined) {\n      scale.rangeRoundBands(rng, pad, outer);\n    } else {\n      scale.rangeBands(rng, pad, outer);\n    }\n  }\n\n  function quantitative(def, scale, rng, db, data) {\n    var domain, interval;\n\n    // domain\n    domain = (def.type === QUANTILE)\n      ? domainValues(def, db, data, false)\n      : domainMinMax(def, db, data);\n    scale.domain(domain);\n\n    // range\n    // vertical scales should flip by default, so use XOR here\n    if (def.range === \"height\") rng = rng.reverse();\n    scale[def.round && scale.rangeRound ? \"rangeRound\" : \"range\"](rng);\n\n    if (def.exponent && def.type===POWER) scale.exponent(def.exponent);\n    if (def.clamp) scale.clamp(true);\n    if (def.nice) {\n      if (def.type === TIME) {\n        interval = d3.time[def.nice];\n        if (!interval) vg.error(\"Unrecognized interval: \" + interval);\n        scale.nice(interval);\n      } else {\n        scale.nice();\n      }\n    }\n  }\n  \n  function extract(refs, db, data) {\n    return refs.reduce(function(values, r) {        \n      var dat = vg.values(db[r.data] || data),\n          get = vg.accessor(vg.isString(r.field)\n              ? r.field : \"data.\" + vg.accessor(r.field.group)(data));\n      return vg.unique(dat, get, values);\n    }, []);\n  }\n  \n  function domainValues(def, db, data, sort) {\n    var domain = def.domain, values, refs;\n    if (vg.isArray(domain)) {\n      values = sort ? domain.slice() : domain;\n    } else if (vg.isObject(domain)) {\n      refs = domain.fields || vg.array(domain);\n      values = extract(refs, db, data);\n    }\n    if (values && sort) values.sort(vg.cmp);\n    return values;\n  }\n  \n  function domainMinMax(def, db, data) {\n    var domain = [null, null], refs, z;\n    \n    function extract(ref, min, max, z) {\n      var dat = vg.values(db[ref.data] || data);\n      var fields = vg.array(ref.field).map(function(f) {\n        return vg.isString(f) ? f\n          : \"data.\" + vg.accessor(f.group)(data);\n      });\n      \n      fields.forEach(function(f,i) {\n        f = vg.accessor(f);\n        if (min) domain[0] = d3.min([domain[0], d3.min(dat, f)]);\n        if (max) domain[z] = d3.max([domain[z], d3.max(dat, f)]);\n      });\n    }\n\n    if (def.domain !== undefined) {\n      if (vg.isArray(def.domain)) {\n        domain = def.domain.slice();\n      } else if (vg.isObject(def.domain)) {\n        refs = def.domain.fields || vg.array(def.domain);\n        refs.forEach(function(r) { extract(r,1,1,1); });\n      } else {\n        domain = def.domain;\n      }\n    }\n    z = domain.length - 1;\n    if (def.domainMin !== undefined) {\n      if (vg.isObject(def.domainMin)) {\n        domain[0] = null;\n        refs = def.domainMin.fields || vg.array(def.domainMin);\n        refs.forEach(function(r) { extract(r,1,0,z); });\n      } else {\n        domain[0] = def.domainMin;\n      }\n    }\n    if (def.domainMax !== undefined) {\n      if (vg.isObject(def.domainMax)) {\n        domain[z] = null;\n        refs = def.domainMax.fields || vg.array(def.domainMax);\n        refs.forEach(function(r) { extract(r,0,1,z); });\n      } else {\n        domain[z] = def.domainMax;\n      }\n    }\n    if (def.type !== LOG && def.type !== TIME && (def.zero || def.zero===undefined)) {\n      domain[0] = Math.min(0, domain[0]);\n      domain[z] = Math.max(0, domain[z]);\n    }\n    return domain;\n  }\n\n  function range(def, group) {\n    var rng = [null, null];\n\n    if (def.range !== undefined) {\n      if (typeof def.range === 'string') {\n        if (GROUP_PROPERTY[def.range]) {\n          rng = [0, group[def.range]];\n        } else if (vg.config.range[def.range]) {\n          rng = vg.config.range[def.range];\n        } else {\n          vg.error(\"Unrecogized range: \"+def.range);\n          return rng;\n        }\n      } else if (vg.isArray(def.range)) {\n        rng = def.range;\n      } else if (vg.isObject(def.range)) {\n        return null; // early exit\n      } else {\n        rng = [0, def.range];\n      }\n    }\n    if (def.rangeMin !== undefined) {\n      rng[0] = def.rangeMin;\n    }\n    if (def.rangeMax !== undefined) {\n      rng[rng.length-1] = def.rangeMax;\n    }\n    \n    if (def.reverse !== undefined) {\n      var rev = def.reverse;\n      if (vg.isObject(rev)) {\n        rev = vg.accessor(rev.field)(group.datum);\n      }\n      if (rev) rng = rng.reverse();\n    }\n    \n    return rng;\n  }\n\n  return scales;\n})();\nvg.parse.spec = function(spec, callback, viewFactory) {\n  \n  viewFactory = viewFactory || vg.ViewFactory;\n  \n  function parse(spec) {\n    // protect against subsequent spec modification\n    spec = vg.duplicate(spec);\n    \n    var width = spec.width || 500,\n        height = spec.height || 500,\n        viewport = spec.viewport || null;\n    \n    var defs = {\n      width: width,\n      height: height,\n      viewport: viewport,\n      padding: vg.parse.padding(spec.padding),\n      marks: vg.parse.marks(spec, width, height),\n      data: vg.parse.data(spec.data, function() { callback(viewConstructor); })\n    };\n    \n    var viewConstructor = viewFactory(defs);\n  }\n  \n  vg.isObject(spec) ? parse(spec) :\n    d3.json(spec, function(error, json) {\n      error ? vg.error(error) : parse(json);\n    });\n};vg.parse.transform = function(def) {\n  var tx = vg.data[def.type]();\n      \n  vg.keys(def).forEach(function(k) {\n    if (k === 'type') return;\n    (tx[k])(def[k]);\n  });\n  \n  return tx;\n};vg.scene = {};\n\nvg.scene.GROUP  = \"group\",\nvg.scene.ENTER  = 0,\nvg.scene.UPDATE = 1,\nvg.scene.EXIT   = 2;\n\nvg.scene.DEFAULT_DATA = {\"sentinel\":1}\n\nvg.scene.data = function(data, parentData) {\n  var DEFAULT = vg.scene.DEFAULT_DATA;\n\n  // if data is undefined, inherit or use default\n  data = vg.values(data || parentData || [DEFAULT]);\n\n  // if inheriting default data, ensure its in an array\n  if (data === DEFAULT) data = [DEFAULT];\n  \n  return data;\n};\n\nvg.scene.fontString = function(o) {\n  return (o.fontStyle ? o.fontStyle + \" \" : \"\")\n    + (o.fontVariant ? o.fontVariant + \" \" : \"\")\n    + (o.fontWeight ? o.fontWeight + \" \" : \"\")\n    + (o.fontSize != null ? o.fontSize : vg.config.render.fontSize) + \"px \"\n    + (o.font || vg.config.render.font);\n};vg.scene.Item = (function() {\n  function item(mark) {\n    this.mark = mark;\n  }\n  \n  var prototype = item.prototype;\n\n  prototype.hasPropertySet = function(name) {\n    var props = this.mark.def.properties;\n    return props && props[name] != null;\n  };\n\n  prototype.cousin = function(offset, index) {\n    if (offset === 0) return this;\n    offset = offset || -1;\n    var mark = this.mark,\n        group = mark.group,\n        iidx = index==null ? mark.items.indexOf(this) : index,\n        midx = group.items.indexOf(mark) + offset;\n    return group.items[midx].items[iidx];\n  };\n  \n  prototype.sibling = function(offset) {\n    if (offset === 0) return this;\n    offset = offset || -1;\n    var mark = this.mark,\n        iidx = mark.items.indexOf(this) + offset;\n    return mark.items[iidx];\n  };\n  \n  prototype.remove = function() {\n    var item = this,\n        list = item.mark.items,\n        i = list.indexOf(item);\n    if (i >= 0) (i===list.length-1) ? list.pop() : list.splice(i, 1);\n    return item;\n  };\n  \n  prototype.touch = function() {\n    if (this.pathCache) this.pathCache = null;\n    if (this.mark.pathCache) this.mark.pathCache = null;\n  };\n  \n  return item;\n})();\n\nvg.scene.item = function(mark) {\n  return new vg.scene.Item(mark);\n};vg.scene.visit = function(node, func) {\n  var i, n, s, m, items;\n  if (func(node)) return true;\n\n  var sets = [\"items\", \"axisItems\", \"legendItems\"];\n  for (s=0, m=sets.length; s<m; ++s) {\n    if (items = node[sets[s]]) {\n      for (i=0, n=items.length; i<n; ++i) {\n        if (vg.scene.visit(items[i], func)) return true;\n      }\n    }\n  }\n};vg.scene.build = (function() {\n  var GROUP  = vg.scene.GROUP,\n      ENTER  = vg.scene.ENTER,\n      UPDATE = vg.scene.UPDATE,\n      EXIT   = vg.scene.EXIT,\n      DEFAULT= {\"sentinel\":1};\n  \n  function build(def, db, node, parentData, reentrant) {\n    var data = vg.scene.data(\n      def.from ? def.from(db, node, parentData) : null,\n      parentData);\n    \n    // build node and items\n    node = buildNode(def, node);\n    node.items = buildItems(def, data, node);\n    buildTrans(def, node);\n    \n    // recurse if group\n    if (def.type === GROUP) {\n      buildGroup(def, db, node, reentrant);\n    }\n    \n    return node;\n  };\n  \n  function buildNode(def, node) {\n    node = node || {};\n    node.def = def;\n    node.marktype = def.type;\n    node.interactive = !(def.interactive === false);\n    return node;\n  }\n  \n  function buildItems(def, data, node) {\n    var keyf = keyFunction(def.key),\n        prev = node.items || [],\n        next = [],\n        map = {},\n        i, key, len, item, datum, enter;\n\n    for (i=0, len=prev.length; i<len; ++i) {\n      item = prev[i];\n      item.status = EXIT;\n      if (keyf) map[item.key] = item;\n    }\n    \n    for (i=0, len=data.length; i<len; ++i) {\n      datum = data[i];\n      key = i;\n      item = keyf ? map[key = keyf(datum)] : prev[i];\n      enter = item ? false : (item = vg.scene.item(node), true);\n      item.status = enter ? ENTER : UPDATE;\n      item.datum = datum;\n      item.key = key;\n      next.push(item);\n    }\n\n    for (i=0, len=prev.length; i<len; ++i) {\n      item = prev[i];\n      if (item.status === EXIT) {\n        item.key = keyf ? item.key : next.length;\n        next.splice(item.index, 0, item);\n      }\n    }\n    \n    return next;\n  }\n  \n  function buildGroup(def, db, node, reentrant) {\n    var groups = node.items,\n        marks = def.marks,\n        i, len, m, mlen, name, group;\n\n    for (i=0, len=groups.length; i<len; ++i) {\n      group = groups[i];\n      \n      // update scales\n      if (!reentrant && group.scales) for (name in group.scales) {\n        if (name.indexOf(\":prev\") < 0) {\n          group.scales[name+\":prev\"] = group.scales[name].copy();\n        }\n      }\n\n      // build items\n      group.items = group.items || [];\n      for (m=0, mlen=marks.length; m<mlen; ++m) {\n        group.items[m] = build(marks[m], db, group.items[m], group.datum);\n        group.items[m].group = group;\n      }\n    }\n  }\n\n  function buildTrans(def, node) {\n    if (def.duration) node.duration = def.duration;\n    if (def.ease) node.ease = d3.ease(def.ease)\n    if (def.delay) {\n      var items = node.items, group = node.group, n = items.length, i;\n      for (i=0; i<n; ++i) def.delay.call(this, items[i], group);\n    }\n  }\n  \n  function keyFunction(key) {\n    if (key == null) return null;\n    var f = vg.array(key).map(vg.accessor);\n    return function(d) {\n      for (var s=\"\", i=0, n=f.length; i<n; ++i) {\n        if (i>0) s += \"|\";\n        s += String(f[i](d));\n      }\n      return s;\n    }\n  }\n  \n  return build;\n})();vg.scene.bounds = (function() {\n\n  var parse = vg.canvas.path.parse,\n      boundPath = vg.canvas.path.bounds,\n      areaPath = vg.canvas.path.area,\n      linePath = vg.canvas.path.line,\n      halfpi = Math.PI / 2,\n      sqrt3 = Math.sqrt(3),\n      tan30 = Math.tan(30 * Math.PI / 180),\n      gfx = null;\n\n  function context() {\n    return gfx || (gfx = (vg.config.isNode\n      ? new (require(\"canvas\"))(1,1)\n      : d3.select(\"body\").append(\"canvas\")\n          .attr(\"class\", \"vega_hidden\")\n          .attr(\"width\", 1)\n          .attr(\"height\", 1)\n          .style(\"display\", \"none\")\n          .node())\n      .getContext(\"2d\"));\n  }\n\n  function pathBounds(o, path, bounds) {\n    if (path == null) {\n      bounds.set(0, 0, 0, 0);\n    } else {\n      boundPath(path, bounds);\n      if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n        bounds.expand(o.strokeWidth);\n      }\n    }\n    return bounds;\n  }\n\n  function path(o, bounds) {\n    var p = o.path\n      ? o.pathCache || (o.pathCache = parse(o.path))\n      : null;\n    return pathBounds(o, p, bounds);\n  }\n  \n  function area(o, bounds) {\n    var items = o.mark.items, o = items[0];\n    var p = o.pathCache || (o.pathCache = parse(areaPath(items)));\n    return pathBounds(items[0], p, bounds);\n  }\n\n  function line(o, bounds) {\n    var items = o.mark.items, o = items[0];\n    var p = o.pathCache || (o.pathCache = parse(linePath(items)));\n    return pathBounds(items[0], p, bounds);\n  }\n\n  function rect(o, bounds) {\n    var x = o.x || 0,\n        y = o.y || 0,\n        w = (x + o.width) || 0,\n        h = (y + o.height) || 0;\n    bounds.set(x, y, w, h);\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n\n  function image(o, bounds) {\n    var w = o.width || 0,\n        h = o.height || 0,\n        x = (o.x||0) - (o.align === \"center\"\n            ? w/2 : (o.align === \"right\" ? w : 0)),\n        y = (o.y||0) - (o.baseline === \"middle\"\n            ? h/2 : (o.baseline === \"bottom\" ? h : 0));\n    return bounds.set(x, y, x+w, y+h);\n  }\n\n  function rule(o, bounds) {\n    var x1, y1;\n    bounds.set(\n      x1 = o.x || 0,\n      y1 = o.y || 0,\n      o.x2 != null ? o.x2 : x1,\n      o.y2 != null ? o.y2 : y1\n    );\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n  \n  function arc(o, bounds) {\n    var cx = o.x || 0,\n        cy = o.y || 0,\n        ir = o.innerRadius || 0,\n        or = o.outerRadius || 0,\n        sa = (o.startAngle || 0) - halfpi,\n        ea = (o.endAngle || 0) - halfpi,\n        xmin = Infinity, xmax = -Infinity,\n        ymin = Infinity, ymax = -Infinity,\n        a, i, n, x, y, ix, iy, ox, oy;\n\n    var angles = [sa, ea],\n        s = sa - (sa%halfpi);\n    for (i=0; i<4 && s<ea; ++i, s+=halfpi) {\n      angles.push(s);\n    }\n\n    for (i=0, n=angles.length; i<n; ++i) {\n      a = angles[i];\n      x = Math.cos(a); ix = ir*x; ox = or*x;\n      y = Math.sin(a); iy = ir*y; oy = or*y;\n      xmin = Math.min(xmin, ix, ox);\n      xmax = Math.max(xmax, ix, ox);\n      ymin = Math.min(ymin, iy, oy);\n      ymax = Math.max(ymax, iy, oy);\n    }\n\n    bounds.set(cx+xmin, cy+ymin, cx+xmax, cy+ymax);\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n\n  function symbol(o, bounds) {\n    var size = o.size != null ? o.size : 100,\n        x = o.x || 0,\n        y = o.y || 0,\n        r, t, rx, ry;\n\n    switch (o.shape) {\n      case \"cross\":\n        r = Math.sqrt(size / 5) / 2;\n        t = 3*r;\n        bounds.set(x-t, y-r, x+t, y+r);\n        break;\n\n      case \"diamond\":\n        ry = Math.sqrt(size / (2 * tan30));\n        rx = ry * tan30;\n        bounds.set(x-rx, y-ry, x+rx, y+ry);\n        break;\n\n      case \"square\":\n        t = Math.sqrt(size);\n        r = t / 2;\n        bounds.set(x-r, y-r, x+r, y+r);\n        break;\n\n      case \"triangle-down\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        bounds.set(x-rx, y-ry, x+rx, y+ry);\n        break;\n\n      case \"triangle-up\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        bounds.set(x-rx, y-ry, x+rx, y+ry);\n        break;\n\n      default:\n        r = Math.sqrt(size/Math.PI);\n        bounds.set(x-r, y-r, x+r, y+r);\n    }\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n\n  function text(o, bounds, noRotate) {\n    var x = (o.x || 0) + (o.dx || 0),\n        y = (o.y || 0) + (o.dy || 0),\n        h = o.fontSize || vg.config.render.fontSize,\n        a = o.align,\n        b = o.baseline,\n        r = o.radius || 0,\n        g = context(), w, t;\n\n    g.font = vg.scene.fontString(o);\n    g.textAlign = a || \"left\";\n    g.textBaseline = b || \"alphabetic\";\n    w = g.measureText(o.text || \"\").width;\n\n    if (r) {\n      t = (o.theta || 0) - Math.PI/2;\n      x += r * Math.cos(t);\n      y += r * Math.sin(t);\n    }\n\n    // horizontal\n    if (a === \"center\") {\n      x = x - (w / 2);\n    } else if (a === \"right\") {\n      x = x - w;\n    } else {\n      // left by default, do nothing\n    }\n\n    /// TODO find a robust solution for heights.\n    /// These offsets work for some but not all fonts.\n\n    // vertical\n    if (b === \"top\") {\n      y = y + (h/5);\n    } else if (b === \"bottom\") {\n      y = y - h;\n    } else if (b === \"middle\") {\n      y = y - (h/2) + (h/10);\n    } else {\n      y = y - 4*h/5; // alphabetic by default\n    }\n    \n    bounds.set(x, y, x+w, y+h);\n    if (o.angle && !noRotate) {\n      bounds.rotate(o.angle*Math.PI/180, o.x||0, o.y||0);\n    }\n    return bounds.expand(noRotate ? 0 : 1);\n  }\n\n  function group(g, bounds, includeLegends) {\n    var axes = g.axisItems || [],\n        legends = g.legendItems || [], j, m;\n\n    for (j=0, m=axes.length; j<m; ++j) {\n      bounds.union(axes[j].bounds);\n    }\n    for (j=0, m=g.items.length; j<m; ++j) {\n      bounds.union(g.items[j].bounds);\n    }\n    if (includeLegends) {\n      for (j=0, m=legends.length; j<m; ++j) {\n        bounds.union(legends[j].bounds);\n      }\n      if (g.width != null && g.height != null) {\n        bounds.add(g.width, g.height);\n      }\n      if (g.x != null && g.y != null) {\n        bounds.add(0, 0);\n      }\n    }\n    bounds.translate(g.x||0, g.y||0);\n    return bounds;\n  }\n\n  var methods = {\n    group:  group,\n    symbol: symbol,\n    image:  image,\n    rect:   rect,\n    rule:   rule,\n    arc:    arc,\n    text:   text,\n    path:   path,\n    area:   area,\n    line:   line\n  };\n\n  function itemBounds(item, func, opt) {\n    func = func || methods[item.mark.marktype];\n    if (!item.bounds_prev) item['bounds:prev'] = new vg.Bounds();\n    var b = item.bounds, pb = item['bounds:prev'];\n    if (b) pb.clear().union(b);\n    item.bounds = func(item, b ? b.clear() : new vg.Bounds(), opt);\n    if (!b) pb.clear().union(item.bounds);\n    return item.bounds;\n  }\n\n  function markBounds(mark, bounds, opt) {\n    bounds = bounds || mark.bounds && mark.bounds.clear() || new vg.Bounds();\n    var type  = mark.marktype,\n        func  = methods[type],\n        items = mark.items,\n        item, i, len;\n        \n    if (type===\"area\" || type===\"line\") {\n      if (items.length) {\n        items[0].bounds = func(items[0], bounds);\n      }\n    } else {\n      for (i=0, len=items.length; i<len; ++i) {\n        bounds.union(itemBounds(items[i], func, opt));\n      }\n    }\n    mark.bounds = bounds;\n  }\n  \n  return {\n    mark:  markBounds,\n    item:  itemBounds,\n    text:  text,\n    group: group\n  };\n\n})();vg.scene.encode = (function() {\n  var GROUP  = vg.scene.GROUP,\n      ENTER  = vg.scene.ENTER,\n      UPDATE = vg.scene.UPDATE,\n      EXIT   = vg.scene.EXIT,\n      EMPTY  = {};\n\n  function main(scene, def, trans, request, items) {\n    (request && items)\n      ? update.call(this, scene, def, trans, request, items)\n      : encode.call(this, scene, scene, def, trans, request);\n    return scene;\n  }\n  \n  function update(scene, def, trans, request, items) {\n    items = vg.array(items);\n    var i, len, item, group, props, prop;\n    for (i=0, len=items.length; i<len; ++i) {\n      item = items[i];\n      group = item.mark.group || null;\n      props = item.mark.def.properties;\n      prop = props && props[request];\n      if (prop) {\n        prop.call(vg, item, group, trans);\n        vg.scene.bounds.item(item);\n      }\n    }\n  }\n  \n  function encode(group, scene, def, trans, request) {\n    encodeItems.call(this, group, scene.items, def, trans, request);\n    if (scene.marktype === GROUP) {\n      encodeGroup.call(this, scene, def, group, trans, request);\n    } else {\n      vg.scene.bounds.mark(scene);\n    }\n  }\n  \n  function encodeLegend(group, scene, def, trans, request) {\n    encodeGroup.call(this, scene, def, group, trans, request);\n    encodeItems.call(this, group, scene.items, def, trans, request);\n    vg.scene.bounds.mark(scene, null, true);\n  }\n  \n  function encodeGroup(scene, def, parent, trans, request) {\n    var i, len, m, mlen, group, scales,\n        axes, axisItems, axisDef, leg, legItems, legDef;\n\n    for (i=0, len=scene.items.length; i<len; ++i) {\n      group = scene.items[i];\n\n      // cascade scales recursively\n      // use parent scales if there are no group-level scale defs\n      scales = group.scales || (group.scales =\n        def.scales ? vg.extend({}, parent.scales) : parent.scales);\n      \n      // update group-level scales\n      if (def.scales) {\n        vg.parse.scales(def.scales, scales, this._data, group);\n      }\n      \n      // update group-level axes\n      if (def.axes) {\n        axes = group.axes || (group.axes = []);\n        axisItems = group.axisItems || (group.axisItems = []);\n        vg.parse.axes(def.axes, axes, group.scales);\n        axes.forEach(function(a, i) {\n          axisDef = a.def();\n          axisItems[i] = vg.scene.build(axisDef, this._data, axisItems[i], null, 1);\n          axisItems[i].group = group;\n          encode.call(this, group, group.axisItems[i], axisDef, trans);\n        });\n      }\n      \n      // encode children marks\n      for (m=0, mlen=group.items.length; m<mlen; ++m) {\n        encode.call(this, group, group.items[m], def.marks[m], trans, request);\n      }\n    }\n    \n    // compute bounds (without legend)\n    vg.scene.bounds.mark(scene, null, !def.legends);\n    \n    // update legends\n    if (def.legends) {\n      for (i=0, len=scene.items.length; i<len; ++i) {\n        group = scene.items[i];\n        leg = group.legends || (group.legends = []);\n        legItems = group.legendItems || (group.legendItems = []);\n        vg.parse.legends(def.legends, leg, group.scales);\n        leg.forEach(function(l, i) {\n          legDef = l.def();\n          legItems[i] = vg.scene.build(legDef, this._data, legItems[i], null, 1);\n          legItems[i].group = group;\n          encodeLegend.call(this, group, group.legendItems[i], legDef, trans);\n        });\n      }\n      vg.scene.bounds.mark(scene, null, true);\n    }\n  }\n  \n  function encodeItems(group, items, def, trans, request) {    \n    var props  = def.properties || EMPTY,\n        enter  = props.enter,\n        update = props.update,\n        exit   = props.exit,\n        i, len, item, prop;\n\n    if (request) {\n      if (prop = props[request]) {\n        for (i=0, len=items.length; i<len; ++i) {\n          prop.call(vg, items[i], group, trans);\n        }\n      }\n      return; // exit early if given request\n    }\n\n    for (i=0; i<items.length; ++i) {\n      item = items[i];\n\n      // enter set\n      if (item.status === ENTER) {\n        if (enter) enter.call(vg, item, group);\n        item.status = UPDATE;\n      }\n\n      // update set      \n      if (item.status !== EXIT && update) {\n        update.call(vg, item, group, trans);\n      }\n      \n      // exit set\n      if (item.status === EXIT) {\n        if (exit) exit.call(vg, item, group, trans);\n        if (trans && !exit) trans.interpolate(item, EMPTY);\n        else if (!trans) items[i--].remove();\n      }\n    }\n  }\n  \n  return main;\n})();vg.scene.Transition = (function() {\n  function trans(duration, ease) {\n    this.duration = duration || 500;\n    this.ease = ease && d3.ease(ease) || d3.ease(\"cubic-in-out\");\n    this.updates = {next: null};\n  }\n  \n  var prototype = trans.prototype;\n  \n  var skip = {\n    \"text\": 1,\n    \"url\":  1\n  };\n  \n  prototype.interpolate = function(item, values) {\n    var key, curr, next, interp, list = null;\n\n    for (key in values) {\n      curr = item[key];\n      next = values[key];      \n      if (curr !== next) {\n        if (skip[key] || curr === undefined) {\n          // skip interpolation for specific keys or undefined start values\n          item[key] = next;\n        } else if (typeof curr === \"number\" && !isFinite(curr)) {\n          // for NaN or infinite numeric values, skip to final value\n          item[key] = next;\n        } else {\n          // otherwise lookup interpolator\n          interp = d3.interpolate(curr, next);\n          interp.property = key;\n          (list || (list=[])).push(interp);\n        }\n      }\n    }\n\n    if (list === null && item.status === vg.scene.EXIT) {\n      list = []; // ensure exiting items are included\n    }\n\n    if (list != null) {\n      list.item = item;\n      list.ease = item.mark.ease || this.ease;\n      list.next = this.updates.next;\n      this.updates.next = list;\n    }\n    return this;\n  };\n  \n  prototype.start = function(callback) {\n    var t = this, prev = t.updates, curr = prev.next;\n    for (; curr!=null; prev=curr, curr=prev.next) {\n      if (curr.item.status === vg.scene.EXIT) curr.remove = true;\n    }\n    t.callback = callback;\n    d3.timer(function(elapsed) { return step.call(t, elapsed); });\n  };\n\n  function step(elapsed) {\n    var list = this.updates, prev = list, curr = prev.next,\n        duration = this.duration,\n        item, delay, f, e, i, n, stop = true;\n\n    for (; curr!=null; prev=curr, curr=prev.next) {\n      item = curr.item;\n      delay = item.delay || 0;\n\n      f = (elapsed - delay) / duration;\n      if (f < 0) { stop = false; continue; }\n      if (f > 1) f = 1;\n      e = curr.ease(f);\n\n      for (i=0, n=curr.length; i<n; ++i) {\n        item[curr[i].property] = curr[i](e);\n      }\n      item.touch();\n      vg.scene.bounds.item(item);\n\n      if (f === 1) {\n        if (curr.remove) item.remove();\n        prev.next = curr.next;\n        curr = prev;\n      } else {\n        stop = false;\n      }\n    }\n\n    this.callback();\n    return stop;\n  };\n  \n  return trans;\n  \n})();\n\nvg.scene.transition = function(dur, ease) {\n  return new vg.scene.Transition(dur, ease);\n};vg.scene.axis = function() {\n  var scale,\n      orient = vg.config.axis.orient,\n      offset = 0,\n      titleOffset = vg.config.axis.titleOffset,\n      axisDef = null,\n      layer = \"front\",\n      grid = false,\n      title = null,\n      tickMajorSize = vg.config.axis.tickSize,\n      tickMinorSize = vg.config.axis.tickSize,\n      tickEndSize = vg.config.axis.tickSize,\n      tickPadding = vg.config.axis.padding,\n      tickValues = null,\n      tickFormatString = null,\n      tickFormat = null,\n      tickSubdivide = 0,\n      tickArguments = [vg.config.axis.ticks],\n      gridLineStyle = {},\n      tickLabelStyle = {},\n      majorTickStyle = {},\n      minorTickStyle = {},\n      titleStyle = {},\n      domainStyle = {};\n\n  var axis = {};\n\n  function reset() {\n    axisDef = null;\n  }\n\n  axis.def = function() {\n    var def = axisDef ? axisDef : (axisDef = axis_def(scale));\n\n    // tick format\n    tickFormat = !tickFormatString ? null : ((scale.type === 'time')\n      ? d3.time.format(tickFormatString)\n      : d3.format(tickFormatString));\n\n    // generate data\n    var major = tickValues == null\n      ? (scale.ticks ? scale.ticks.apply(scale, tickArguments) : scale.domain())\n      : tickValues;\n    var minor = vg_axisSubdivide(scale, major, tickSubdivide).map(vg.data.ingest);\n    major = major.map(vg.data.ingest);\n    var fmt = tickFormat==null ? (scale.tickFormat ? scale.tickFormat.apply(scale, tickArguments) : String) : tickFormat;\n    major.forEach(function(d) { d.label = fmt(d.data); });\n    var tdata = title ? [title].map(vg.data.ingest) : [];\n    \n    // update axis def\n    def.marks[0].from = function() { return grid ? major : []; };\n    def.marks[1].from = function() { return major; };\n    def.marks[2].from = function() { return minor; };\n    def.marks[3].from = def.marks[1].from;\n    def.marks[4].from = function() { return [1]; };\n    def.marks[5].from = function() { return tdata; };\n    def.offset = offset;\n    def.orient = orient;\n    def.layer = layer;\n    return def;\n  };\n\n  function axis_def(scale) {\n    // setup scale mapping\n    var newScale, oldScale, range;\n    if (scale.type === \"ordinal\") {\n      newScale = {scale: scale.scaleName, offset: 0.5 + scale.rangeBand()/2};\n      oldScale = newScale;\n    } else {\n      newScale = {scale: scale.scaleName, offset: 0.5};\n      oldScale = {scale: scale.scaleName+\":prev\", offset: 0.5};\n    }\n    range = vg_axisScaleRange(scale);\n\n    // setup axis marks\n    var gridLines = vg_axisTicks();\n    var majorTicks = vg_axisTicks();\n    var minorTicks = vg_axisTicks();\n    var tickLabels = vg_axisTickLabels();\n    var domain = vg_axisDomain();\n    var title = vg_axisTitle();\n    gridLines.properties.enter.stroke = {value: vg.config.axis.gridColor};\n\n    // extend axis marks based on axis orientation\n    vg_axisTicksExtend(orient, gridLines, oldScale, newScale, Infinity);\n    vg_axisTicksExtend(orient, majorTicks, oldScale, newScale, tickMajorSize);\n    vg_axisTicksExtend(orient, minorTicks, oldScale, newScale, tickMinorSize);\n    vg_axisLabelExtend(orient, tickLabels, oldScale, newScale, tickMajorSize, tickPadding);\n\n    vg_axisDomainExtend(orient, domain, range, tickEndSize);\n    vg_axisTitleExtend(orient, title, range, titleOffset); // TODO get offset\n    \n    // add / override custom style properties\n    vg.extend(gridLines.properties.update, gridLineStyle);\n    vg.extend(majorTicks.properties.update, majorTickStyle);\n    vg.extend(minorTicks.properties.update, minorTickStyle);\n    vg.extend(tickLabels.properties.update, tickLabelStyle);\n    vg.extend(domain.properties.update, domainStyle);\n    vg.extend(title.properties.update, titleStyle);\n\n    var marks = [gridLines, majorTicks, minorTicks, tickLabels, domain, title];\n    return {\n      type: \"group\",\n      interactive: false,\n      properties: { enter: vg_axisUpdate, update: vg_axisUpdate },\n      marks: marks.map(vg.parse.mark)\n    };\n  }\n\n  axis.scale = function(x) {\n    if (!arguments.length) return scale;\n    if (scale !== x) { scale = x; reset(); }\n    return axis;\n  };\n\n  axis.orient = function(x) {\n    if (!arguments.length) return orient;\n    if (orient !== x) {\n      orient = x in vg_axisOrients ? x + \"\" : vg.config.axis.orient;\n      reset();\n    }\n    return axis;\n  };\n\n  axis.title = function(x) {\n    if (!arguments.length) return title;\n    if (title !== x) { title = x; reset(); }\n    return axis;\n  };\n\n  axis.ticks = function() {\n    if (!arguments.length) return tickArguments;\n    tickArguments = arguments;\n    return axis;\n  };\n\n  axis.tickValues = function(x) {\n    if (!arguments.length) return tickValues;\n    tickValues = x;\n    return axis;\n  };\n\n  axis.tickFormat = function(x) {\n    if (!arguments.length) return tickFormatString;\n    if (tickFormatString !== x) {\n      tickFormatString = x;\n      reset();\n    }\n    return axis;\n  };\n  \n  axis.tickSize = function(x, y) {\n    if (!arguments.length) return tickMajorSize;\n    var n = arguments.length - 1,\n        major = +x,\n        minor = n > 1 ? +y : tickMajorSize,\n        end   = n > 0 ? +arguments[n] : tickMajorSize;\n\n    if (tickMajorSize !== major ||\n        tickMinorSize !== minor ||\n        tickEndSize !== end) {\n      reset();\n    }\n\n    tickMajorSize = major;\n    tickMinorSize = minor;\n    tickEndSize = end;\n    return axis;\n  };\n\n  axis.tickSubdivide = function(x) {\n    if (!arguments.length) return tickSubdivide;\n    tickSubdivide = +x;\n    return axis;\n  };\n  \n  axis.offset = function(x) {\n    if (!arguments.length) return offset;\n    offset = vg.isObject(x) ? x : +x;\n    return axis;\n  };\n\n  axis.tickPadding = function(x) {\n    if (!arguments.length) return tickPadding;\n    if (tickPadding !== +x) { tickPadding = +x; reset(); }\n    return axis;\n  };\n\n  axis.titleOffset = function(x) {\n    if (!arguments.length) return titleOffset;\n    if (titleOffset !== +x) { titleOffset = +x; reset(); }\n    return axis;\n  };\n\n  axis.layer = function(x) {\n    if (!arguments.length) return layer;\n    if (layer !== x) { layer = x; reset(); }\n    return axis;\n  };\n\n  axis.grid = function(x) {\n    if (!arguments.length) return grid;\n    if (grid !== x) { grid = x; reset(); }\n    return axis;\n  };\n\n  axis.gridLineProperties = function(x) {\n    if (!arguments.length) return gridLineStyle;\n    if (gridLineStyle !== x) { gridLineStyle = x; }\n    return axis;\n  };\n\n  axis.majorTickProperties = function(x) {\n    if (!arguments.length) return majorTickStyle;\n    if (majorTickStyle !== x) { majorTickStyle = x; }\n    return axis;\n  };\n\n  axis.minorTickProperties = function(x) {\n    if (!arguments.length) return minorTickStyle;\n    if (minorTickStyle !== x) { minorTickStyle = x; }\n    return axis;\n  };\n\n  axis.tickLabelProperties = function(x) {\n    if (!arguments.length) return tickLabelStyle;\n    if (tickLabelStyle !== x) { tickLabelStyle = x; }\n    return axis;\n  };\n\n  axis.titleProperties = function(x) {\n    if (!arguments.length) return titleStyle;\n    if (titleStyle !== x) { titleStyle = x; }\n    return axis;\n  };\n\n  axis.domainProperties = function(x) {\n    if (!arguments.length) return domainStyle;\n    if (domainStyle !== x) { domainStyle = x; }\n    return axis;\n  };\n  \n  axis.reset = function() { reset(); };\n\n  return axis;\n};\n\nvar vg_axisOrients = {top: 1, right: 1, bottom: 1, left: 1};\n\nfunction vg_axisSubdivide(scale, ticks, m) {\n  subticks = [];\n  if (m && ticks.length > 1) {\n    var extent = vg_axisScaleExtent(scale.domain()),\n        subticks,\n        i = -1,\n        n = ticks.length,\n        d = (ticks[1] - ticks[0]) / ++m,\n        j,\n        v;\n    while (++i < n) {\n      for (j = m; --j > 0;) {\n        if ((v = +ticks[i] - j * d) >= extent[0]) {\n          subticks.push(v);\n        }\n      }\n    }\n    for (--i, j = 0; ++j < m && (v = +ticks[i] + j * d) < extent[1];) {\n      subticks.push(v);\n    }\n  }\n  return subticks;\n}\n\nfunction vg_axisScaleExtent(domain) {\n  var start = domain[0], stop = domain[domain.length - 1];\n  return start < stop ? [start, stop] : [stop, start];\n}\n\nfunction vg_axisScaleRange(scale) {\n  return scale.rangeExtent\n    ? scale.rangeExtent()\n    : vg_axisScaleExtent(scale.range());\n}\n\nvar vg_axisAlign = {\n  bottom: \"center\",\n  top: \"center\",\n  left: \"right\",\n  right: \"left\"\n};\n\nvar vg_axisBaseline = {\n  bottom: \"top\",\n  top: \"bottom\",\n  left: \"middle\",\n  right: \"middle\"\n};\n\nfunction vg_axisLabelExtend(orient, labels, oldScale, newScale, size, pad) {\n  size = Math.max(size, 0) + pad;\n  if (orient === \"left\" || orient === \"top\") {\n    size *= -1;\n  }  \n  if (orient === \"top\" || orient === \"bottom\") {\n    vg.extend(labels.properties.enter, {\n      x: oldScale,\n      y: {value: size},\n    });\n    vg.extend(labels.properties.update, {\n      x: newScale,\n      y: {value: size},\n      align: {value: \"center\"},\n      baseline: {value: vg_axisBaseline[orient]}\n    });\n  } else {\n    vg.extend(labels.properties.enter, {\n      x: {value: size},\n      y: oldScale,\n    });\n    vg.extend(labels.properties.update, {\n      x: {value: size},\n      y: newScale,\n      align: {value: vg_axisAlign[orient]},\n      baseline: {value: \"middle\"}\n    });\n  }\n}\n\nfunction vg_axisTicksExtend(orient, ticks, oldScale, newScale, size) {\n  var sign = (orient === \"left\" || orient === \"top\") ? -1 : 1;\n  if (size === Infinity) {\n    size = (orient === \"top\" || orient === \"bottom\")\n      ? {group: \"mark.group.height\", mult: -sign}\n      : {group: \"mark.group.width\", mult: -sign};\n  } else {\n    size = {value: sign * size};\n  }\n  if (orient === \"top\" || orient === \"bottom\") {\n    vg.extend(ticks.properties.enter, {\n      x:  oldScale,\n      y:  {value: 0},\n      y2: size\n    });\n    vg.extend(ticks.properties.update, {\n      x:  newScale,\n      y:  {value: 0},\n      y2: size\n    });\n    vg.extend(ticks.properties.exit, {\n      x:  newScale,\n    });        \n  } else {\n    vg.extend(ticks.properties.enter, {\n      x:  {value: 0},\n      x2: size,\n      y:  oldScale\n    });\n    vg.extend(ticks.properties.update, {\n      x:  {value: 0},\n      x2: size,\n      y:  newScale\n    });\n    vg.extend(ticks.properties.exit, {\n      y:  newScale,\n    });\n  }\n}\n\nfunction vg_axisTitleExtend(orient, title, range, offset) {\n  var mid = ~~((range[0] + range[1]) / 2),\n      sign = (orient === \"top\" || orient === \"left\") ? -1 : 1;\n  \n  if (orient === \"bottom\" || orient === \"top\") {\n    vg.extend(title.properties.update, {\n      x: {value: mid},\n      y: {value: sign*offset},\n      angle: {value: 0}\n    });\n  } else {\n    vg.extend(title.properties.update, {\n      x: {value: sign*offset},\n      y: {value: mid},\n      angle: {value: -90}\n    });\n  }\n}\n\nfunction vg_axisDomainExtend(orient, domain, range, size) {\n  var path;\n  if (orient === \"top\" || orient === \"left\") {\n    size = -1 * size;\n  }\n  if (orient === \"bottom\" || orient === \"top\") {\n    path = \"M\" + range[0] + \",\" + size + \"V0H\" + range[1] + \"V\" + size;\n  } else {\n    path = \"M\" + size + \",\" + range[0] + \"H0V\" + range[1] + \"H\" + size;\n  }\n  domain.properties.update.path = {value: path};\n}\n\nfunction vg_axisUpdate(item, group, trans) {\n  var o = trans ? {} : item,\n      offset = item.mark.def.offset,\n      orient = item.mark.def.orient,\n      width  = group.width,\n      height = group.height; // TODO fallback to global w,h?\n\n    if (vg.isArray(offset)) {\n      var ofx = offset[0],\n          ofy = offset[1];\n\n      switch (orient) {\n        case \"left\":   { o.x = -ofx; o.y = ofy; break; }\n        case \"right\":  { o.x = width + ofx; o.y = ofy; break; }\n        case \"bottom\": { o.x = ofx; o.y = height + ofy; break; }\n        case \"top\":    { o.x = ofx; o.y = -ofy; break; }\n        default:       { o.x = ofx; o.y = ofy; }\n      }\n    } else {\n      if (vg.isObject(offset)) {\n        offset = -group.scales[offset.scale](offset.value);\n      }\n\n      switch (orient) {\n        case \"left\":   { o.x = -offset; o.y = 0; break; }\n        case \"right\":  { o.x = width + offset; o.y = 0; break; }\n        case \"bottom\": { o.x = 0; o.y = height + offset; break; }\n        case \"top\":    { o.x = 0; o.y = -offset; break; }\n        default:       { o.x = 0; o.y = 0; }\n      }\n    }\n\n  if (trans) trans.interpolate(item, o);\n}\n\nfunction vg_axisTicks() {\n  return {\n    type: \"rule\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        stroke: {value: vg.config.axis.tickColor},\n        strokeWidth: {value: vg.config.axis.tickWidth},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: { opacity: {value: 1} }\n    }\n  };\n}\n\nfunction vg_axisTickLabels() {\n  return {\n    type: \"text\",\n    interactive: true,\n    key: \"data\",\n    properties: {\n      enter: {\n        fill: {value: vg.config.axis.tickLabelColor},\n        font: {value: vg.config.axis.tickLabelFont},\n        fontSize: {value: vg.config.axis.tickLabelFontSize},\n        opacity: {value: 1e-6},\n        text: {field: \"label\"}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: { opacity: {value: 1} }\n    }\n  };\n}\n\nfunction vg_axisTitle() {\n  return {\n    type: \"text\",\n    interactive: true,\n    properties: {\n      enter: {\n        font: {value: vg.config.axis.titleFont},\n        fontSize: {value: vg.config.axis.titleFontSize},\n        fontWeight: {value: vg.config.axis.titleFontWeight},\n        fill: {value: vg.config.axis.titleColor},\n        align: {value: \"center\"},\n        baseline: {value: \"middle\"},\n        text: {field: \"data\"}\n      },\n      update: {}\n    }\n  };\n}\n\nfunction vg_axisDomain() {\n  return {\n    type: \"path\",\n    interactive: false,\n    properties: {\n      enter: {\n        x: {value: 0.5},\n        y: {value: 0.5},\n        stroke: {value: vg.config.axis.axisColor},\n        strokeWidth: {value: vg.config.axis.axisWidth}\n      },\n      update: {}\n    }\n  };\n}\nvg.scene.legend = function() {\n  var size = null,\n      shape = null,\n      fill = null,\n      stroke = null,\n      spacing = null,\n      values = null,\n      format = null,\n      formatString = null,\n      title = undefined,\n      orient = \"right\",\n      offset = vg.config.legend.offset,\n      padding = vg.config.legend.padding,\n      legendDef,\n      tickArguments = [5],\n      legendStyle = {},\n      symbolStyle = {},\n      gradientStyle = {},\n      titleStyle = {},\n      labelStyle = {};\n\n  var legend = {},\n      legendDef = null;\n\n  function reset() { legendDef = null; }\n\n  legend.def = function() {\n    var scale = size || shape || fill || stroke;\n    \n    format = !formatString ? null : ((scale.type === 'time')\n      ? d3.time.format(formatString)\n      : d3.format(formatString));\n    \n    if (!legendDef) {\n      legendDef = (scale===fill || scale===stroke) && !discrete(scale.type)\n        ? quantDef(scale)\n        : ordinalDef(scale);\n    }\n    legendDef.orient = orient;\n    legendDef.offset = offset;\n    legendDef.padding = padding;\n    return legendDef;\n  };\n\n  function discrete(type) {\n    return type===\"ordinal\" || type===\"quantize\"\n      || type===\"quantile\" || type===\"threshold\";\n  }\n\n  function ordinalDef(scale) {\n    var def = o_legend_def(size, shape, fill, stroke);\n\n    // generate data\n    var data = (values == null\n      ? (scale.ticks ? scale.ticks.apply(scale, tickArguments) : scale.domain())\n      : values).map(vg.data.ingest);\n    var fmt = format==null ? (scale.tickFormat ? scale.tickFormat.apply(scale, tickArguments) : String) : format;\n    \n    // determine spacing between legend entries\n    var fs, range, offset, pad=5, domain = d3.range(data.length);\n    if (size) {\n      range = data.map(function(x) { return Math.sqrt(size(x.data)); });\n      offset = d3.max(range);\n      range = range.reduce(function(a,b,i,z) {\n          if (i > 0) a[i] = a[i-1] + z[i-1]/2 + pad;\n          return (a[i] += b/2, a); }, [0]).map(Math.round);\n    } else {\n      offset = Math.round(Math.sqrt(vg.config.legend.symbolSize));\n      range = spacing\n        || (fs = labelStyle.fontSize) && (fs.value + pad)\n        || (vg.config.legend.labelFontSize + pad);\n      range = domain.map(function(d,i) {\n        return Math.round(offset/2 + i*range);\n      });\n    }\n\n    // account for padding and title size\n    var sz = padding, ts;\n    if (title) {\n      ts = titleStyle.fontSize;\n      sz += 5 + ((ts && ts.value) || vg.config.legend.titleFontSize);\n    }\n    for (var i=0, n=range.length; i<n; ++i) range[i] += sz;\n    \n    // build scale for label layout\n    var scale = {\n      name: \"legend\",\n      type: \"ordinal\",\n      points: true,\n      domain: domain,\n      range: range\n    };\n    \n    // update legend def\n    var tdata = (title ? [title] : []).map(vg.data.ingest);\n    data.forEach(function(d) {\n      d.label = fmt(d.data);\n      d.offset = offset;\n    });\n    def.scales = [ scale ];\n    def.marks[0].from = function() { return tdata; };\n    def.marks[1].from = function() { return data; };\n    def.marks[2].from = def.marks[1].from;\n    return def;\n  }\n\n  function o_legend_def(size, shape, fill, stroke) {\n    // setup legend marks\n    var titles = vg_legendTitle(),\n        symbols = vg_legendSymbols(),\n        labels = vg_vLegendLabels();\n\n    // extend legend marks\n    vg_legendSymbolExtend(symbols, size, shape, fill, stroke);\n    \n    // add / override custom style properties\n    vg.extend(titles.properties.update, titleStyle);\n    vg.extend(symbols.properties.update, symbolStyle);\n    vg.extend(labels.properties.update, labelStyle);\n\n    // padding from legend border\n    titles.properties.enter.x.value += padding;\n    titles.properties.enter.y.value += padding;\n    labels.properties.enter.x.offset += padding + 1;\n    symbols.properties.enter.x.offset = padding + 1;\n    labels.properties.update.x.offset += padding + 1;\n    symbols.properties.update.x.offset = padding + 1;\n\n    return {\n      type: \"group\",\n      interactive: false,\n      properties: {\n        enter: vg.parse.properties(\"group\", legendStyle),\n        update: vg_legendUpdate\n      },\n      marks: [titles, symbols, labels].map(vg.parse.mark)\n    };\n  }\n\n  function quantDef(scale) {\n    var def = q_legend_def(scale),\n        dom = scale.domain(),\n        data = dom.map(vg.data.ingest),\n        width = (gradientStyle.width && gradientStyle.width.value) || vg.config.legend.gradientWidth,\n        fmt = format==null ? (scale.tickFormat ? scale.tickFormat.apply(scale, tickArguments) : String) : format;\n\n    // build scale for label layout\n    var layout = {\n      name: \"legend\",\n      type: scale.type,\n      round: true,\n      zero: false,\n      domain: [dom[0], dom[dom.length-1]],\n      range: [padding, width+padding]\n    };\n    if (scale.type===\"pow\") layout.exponent = scale.exponent();\n    \n    // update legend def\n    var tdata = (title ? [title] : []).map(vg.data.ingest);\n    data.forEach(function(d,i) {\n      d.label = fmt(d.data);\n      d.align = i==(data.length-1) ? \"right\" : i==0 ? \"left\" : \"center\";\n    });\n    def.scales = [ layout ];\n    def.marks[0].from = function() { return tdata; };\n    def.marks[1].from = function() { return [1]; };\n    def.marks[2].from = function() { return data; };\n    return def;\n  }\n  \n  function q_legend_def(scale) {\n    // setup legend marks\n    var titles = vg_legendTitle(),\n        gradient = vg_legendGradient(),\n        labels = vg_hLegendLabels(),\n        grad = new vg.Gradient();\n\n    // setup color gradient\n    var dom = scale.domain(),\n        min = dom[0],\n        max = dom[dom.length-1],\n        f = scale.copy().domain([min, max]).range([0,1]);\n        \n    var stops = (scale.type !== \"linear\" && scale.ticks)\n      ? scale.ticks.call(scale, 15) : dom;\n    if (min !== stops[0]) stops.unshift(min);\n    if (max !== stops[stops.length-1]) stops.push(max);\n\n    for (var i=0, n=stops.length; i<n; ++i) {\n      grad.stop(f(stops[i]), scale(stops[i]));\n    }\n    gradient.properties.enter.fill = {value: grad};\n\n    // add / override custom style properties\n    vg.extend(titles.properties.update, titleStyle);\n    vg.extend(gradient.properties.update, gradientStyle);\n    vg.extend(labels.properties.update, labelStyle);\n\n    // account for gradient size\n    var gp = gradient.properties, gh = gradientStyle.height,\n        hh = (gh && gh.value) || gp.enter.height.value;\n    labels.properties.enter.y.value = hh;\n    labels.properties.update.y.value = hh;\n\n    // account for title size as needed\n    if (title) {\n      var tp = titles.properties, fs = titleStyle.fontSize,\n          sz = 4 + ((fs && fs.value) || tp.enter.fontSize.value);\n      gradient.properties.enter.y.value += sz;\n      labels.properties.enter.y.value += sz;\n      gradient.properties.update.y.value += sz;\n      labels.properties.update.y.value += sz;\n    }\n    \n    // padding from legend border\n    titles.properties.enter.x.value += padding;\n    titles.properties.enter.y.value += padding;\n    gradient.properties.enter.x.value += padding;\n    gradient.properties.enter.y.value += padding;\n    labels.properties.enter.y.value += padding;\n    gradient.properties.update.x.value += padding;\n    gradient.properties.update.y.value += padding;\n    labels.properties.update.y.value += padding;\n\n    return {\n      type: \"group\",\n      interactive: false,\n      properties: {\n        enter: vg.parse.properties(\"group\", legendStyle),\n        update: vg_legendUpdate\n      },\n      marks: [titles, gradient, labels].map(vg.parse.mark)\n    };\n  }\n\n  legend.size = function(x) {\n    if (!arguments.length) return size;\n    if (size !== x) { size = x; reset(); }\n    return legend;\n  };\n\n  legend.shape = function(x) {\n    if (!arguments.length) return shape;\n    if (shape !== x) { shape = x; reset(); }\n    return legend;\n  };\n\n  legend.fill = function(x) {\n    if (!arguments.length) return fill;\n    if (fill !== x) { fill = x; reset(); }\n    return legend;\n  };\n  \n  legend.stroke = function(x) {\n    if (!arguments.length) return stroke;\n    if (stroke !== x) { stroke = x; reset(); }\n    return legend;\n  };\n\n  legend.title = function(x) {\n    if (!arguments.length) return title;\n    if (title !== x) { title = x; reset(); }\n    return legend;\n  };\n\n  legend.format = function(x) {\n    if (!arguments.length) return formatString;\n    if (formatString !== x) {\n      formatString = x;\n      reset();\n    }\n    return legend;\n  };\n\n  legend.spacing = function(x) {\n    if (!arguments.length) return spacing;\n    if (spacing !== +x) { spacing = +x; reset(); }\n    return legend;\n  };\n\n  legend.orient = function(x) {\n    if (!arguments.length) return orient;\n    orient = x in vg_legendOrients ? x + \"\" : vg.config.legend.orient;\n    return legend;\n  };\n\n  legend.offset = function(x) {\n    if (!arguments.length) return offset;\n    offset = +x;\n    return legend;\n  };\n\n  legend.values = function(x) {\n    if (!arguments.length) return values;\n    values = x;\n    return legend;\n  };\n\n  legend.legendProperties = function(x) {\n    if (!arguments.length) return legendStyle;\n    legendStyle = x;\n    return legend;\n  };\n\n  legend.symbolProperties = function(x) {\n    if (!arguments.length) return symbolStyle;\n    symbolStyle = x;\n    return legend;\n  };\n\n  legend.gradientProperties = function(x) {\n    if (!arguments.length) return gradientStyle;\n    gradientStyle = x;\n    return legend;\n  };\n\n  legend.labelProperties = function(x) {\n    if (!arguments.length) return labelStyle;\n    labelStyle = x;\n    return legend;\n  };\n  \n  legend.titleProperties = function(x) {\n    if (!arguments.length) return titleStyle;\n    titleStyle = x;\n    return legend;\n  };\n\n  legend.reset = function() { reset(); };\n\n  return legend;\n};\n\nvar vg_legendOrients = {right: 1, left: 1};\n\nfunction vg_legendUpdate(item, group, trans) {\n  var o = trans ? {} : item, gx,\n      offset = item.mark.def.offset,\n      orient = item.mark.def.orient,\n      pad    = item.mark.def.padding * 2,\n      lw     = ~~item.bounds.width() + (item.width ? 0 : pad),\n      lh     = ~~item.bounds.height() + (item.height ? 0 : pad);\n\n  o.x = 0.5;\n  o.y = 0.5;\n  o.width = lw;\n  o.height = lh;\n\n  // HACK: use to estimate group bounds during animated transition\n  if (!trans && group.bounds) {\n    group.bounds.delta = group.bounds.x2 - group.width;\n  }\n\n  switch (orient) {\n    case \"left\":  {\n      gx = group.bounds ? group.bounds.x1 : 0;\n      o.x += gx - offset - lw;\n      break;\n    };\n    case \"right\": {\n      gx = group.width;\n      if (group.bounds) gx = trans\n        ? group.width + group.bounds.delta\n        : group.bounds.x2;\n      o.x += gx + offset;\n      break;\n    };\n  }\n  \n  if (trans) trans.interpolate(item, o);\n  item.mark.def.properties.enter(item, group, trans);\n}\n\nfunction vg_legendSymbolExtend(mark, size, shape, fill, stroke) {\n  var e = mark.properties.enter,\n      u = mark.properties.update;\n  if (size)   e.size   = u.size   = {scale: size.scaleName,   field: \"data\"};\n  if (shape)  e.shape  = u.shape  = {scale: shape.scaleName,  field: \"data\"};\n  if (fill)   e.fill   = u.fill   = {scale: fill.scaleName,   field: \"data\"};\n  if (stroke) e.stroke = u.stroke = {scale: stroke.scaleName, field: \"data\"};\n}\n\nfunction vg_legendTitle() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"text\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {value: 0},\n        y: {value: 0},\n        fill: {value: cfg.titleColor},\n        font: {value: cfg.titleFont},\n        fontSize: {value: cfg.titleFontSize},\n        fontWeight: {value: cfg.titleFontWeight},\n        baseline: {value: \"top\"},\n        text: {field: \"data\"},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: { opacity: {value: 1} }\n    }\n  };\n}\n\nfunction vg_legendSymbols() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"symbol\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {field: \"offset\", mult: 0.5},\n        y: {scale: \"legend\", field: \"index\"},\n        shape: {value: cfg.symbolShape},\n        size: {value: cfg.symbolSize},\n        stroke: {value: cfg.symbolColor},\n        strokeWidth: {value: cfg.symbolStrokeWidth},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        x: {field: \"offset\", mult: 0.5},\n        y: {scale: \"legend\", field: \"index\"},\n        opacity: {value: 1}\n      }\n    }\n  };\n}\n\nfunction vg_vLegendLabels() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"text\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {field: \"offset\", offset: 5},\n        y: {scale: \"legend\", field: \"index\"},\n        fill: {value: cfg.labelColor},\n        font: {value: cfg.labelFont},\n        fontSize: {value: cfg.labelFontSize},\n        align: {value: cfg.labelAlign},\n        baseline: {value: cfg.labelBaseline},\n        text: {field: \"label\"},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        opacity: {value: 1},\n        x: {field: \"offset\", offset: 5},\n        y: {scale: \"legend\", field: \"index\"},\n      }\n    }\n  };\n}\n\nfunction vg_legendGradient() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"rect\",\n    interactive: false,\n    properties: {\n      enter: {\n        x: {value: 0},\n        y: {value: 0},\n        width: {value: cfg.gradientWidth},\n        height: {value: cfg.gradientHeight},\n        stroke: {value: cfg.gradientStrokeColor},\n        strokeWidth: {value: cfg.gradientStrokeWidth},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        x: {value: 0},\n        y: {value: 0},\n        opacity: {value: 1}\n      }\n    }\n  };\n}\n\nfunction vg_hLegendLabels() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"text\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {scale: \"legend\", field: \"data\"},\n        y: {value: 20},\n        dy: {value: 2},\n        fill: {value: cfg.labelColor},\n        font: {value: cfg.labelFont},\n        fontSize: {value: cfg.labelFontSize},\n        align: {field: \"align\"},\n        baseline: {value: \"top\"},\n        text: {field: \"label\"},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        x: {scale: \"legend\", field: \"data\"},\n        y: {value: 20},\n        opacity: {value: 1}\n      }\n    }\n  };\n}vg.Model = (function() {\n  function model() {\n    this._defs = null;\n    this._data = {};\n    this._scene = null;\n    this._reset = {axes: false, legends: false};\n  }\n\n  var prototype = model.prototype;\n\n  prototype.defs = function(defs) {\n    if (!arguments.length) return this._defs;\n    this._defs = defs;\n    return this;\n  };\n\n  prototype.data = function(data) {\n    if (!arguments.length) return this._data;\n\n    var deps = {},\n        defs = this._defs,\n        src  = defs.data.source,\n        tx   = defs.data.flow || {},\n        keys = defs.data.sorted,\n        len  = keys.length, i, k, x;\n\n    // collect source data set dependencies\n    function sources(k) {\n      (src[k] || []).forEach(function(s) { deps[s] = k; sources(s); });\n    }\n    vg.keys(data).forEach(sources);\n    \n    // update data sets in dependency-aware order\n    for (i=0; i<len; ++i) {\n      if (data[k=keys[i]]) {\n        x = data[k];\n      } else if (deps[k]) {\n        x = vg_data_duplicate(this._data[deps[k]]);\n        if (vg.isTree(data)) vg_make_tree(x);\n      } else continue;\n      this._data[k] = tx[k] ? tx[k](x, this._data, defs.marks) : x;\n    }\n\n    this._reset.legends = true;\n    return this;\n  };\n\n  prototype.width = function(width) {\n    if (this._defs) this._defs.width = width;\n    if (this._defs && this._defs.marks) this._defs.marks.width = width;\n    if (this._scene) this._scene.items[0].width = width;\n    this._reset.axes = true;\n    return this;\n  };\n\n  prototype.height = function(height) {\n    if (this._defs) this._defs.height = height;\n    if (this._defs && this._defs.marks) this._defs.marks.height = height;\n    if (this._scene) this._scene.items[0].height = height;\n    this._reset.axes = true;\n    return this;\n  };\n\n  prototype.scene = function(node) {\n    if (!arguments.length) return this._scene;\n    this._scene = node;\n    return this;\n  };\n\n  prototype.build = function() {\n    var m = this, data = m._data, marks = m._defs.marks;\n    m._scene = vg.scene.build.call(m, marks, data, m._scene);\n    m._scene.items[0].width = marks.width;\n    m._scene.items[0].height = marks.height;\n    m._scene.interactive = false;\n    return this;\n  };\n\n  prototype.encode = function(trans, request, item) {\n    this.reset();\n    var m = this, scene = m._scene, defs = m._defs;\n    vg.scene.encode.call(m, scene, defs.marks, trans, request, item);\n    return this;\n  };\n\n  prototype.reset = function() {\n    if (this._scene && this._reset.axes) {\n      vg.scene.visit(this._scene, function(item) {\n        if (item.axes) item.axes.forEach(function(axis) { axis.reset(); });\n      });\n      this._reset.axes = false;\n    }\n    if (this._scene && this._reset.legends) {\n      vg.scene.visit(this._scene, function(item) {\n        if (item.legends) item.legends.forEach(function(l) { l.reset(); });\n      });\n      this._reset.legends = false;\n    }\n    return this;\n  };\n\n  return model;\n})();vg.View = (function() {\n  var view = function(el, width, height) {\n    this._el = null;\n    this._build = false;\n    this._model = new vg.Model();\n    this._width = this.__width = width || 500;\n    this._height = this.__height = height || 500;\n    this._autopad = 1;\n    this._padding = {top:0, left:0, bottom:0, right:0};\n    this._viewport = null;\n    this._renderer = null;\n    this._handler = null;\n    this._io = vg.canvas;\n    if (el) this.initialize(el);\n  };\n  \n  var prototype = view.prototype;\n  \n  prototype.width = function(width) {\n    if (!arguments.length) return this.__width;\n    if (this.__width !== width) {\n      this._width = this.__width = width;\n      if (this._el) this.initialize(this._el.parentNode);\n      this._model.width(width);\n      if (this._strict) this._autopad = 1;\n    }\n    return this;\n  };\n\n  prototype.height = function(height) {\n    if (!arguments.length) return this.__height;\n    if (this.__height !== height) {\n      this._height = this.__height = height;\n      if (this._el) this.initialize(this._el.parentNode);\n      this._model.height(this._height);\n      if (this._strict) this._autopad = 1;\n    }\n    return this;\n  };\n\n  prototype.padding = function(pad) {\n    if (!arguments.length) return this._padding;\n    if (this._padding !== pad) {\n      if (vg.isString(pad)) {\n        this._autopad = 1;\n        this._padding = {top:0, left:0, bottom:0, right:0};\n        this._strict = (pad === \"strict\");\n      } else {\n        this._autopad = 0;\n        this._padding = pad;\n        this._strict = false;\n      }\n      if (this._el) {\n        this._renderer.resize(this._width, this._height, pad);\n        this._handler.padding(pad);\n      }\n    }\n    return this;\n  };\n  \n  prototype.autopad = function(opt) {\n    if (this._autopad < 1) return this;\n    else this._autopad = 0;\n\n    var pad = this._padding,\n        b = this.model().scene().bounds,\n        inset = vg.config.autopadInset,\n        l = b.x1 < 0 ? Math.ceil(-b.x1) + inset : 0,\n        t = b.y1 < 0 ? Math.ceil(-b.y1) + inset : 0,\n        r = b.x2 > this._width  ? Math.ceil(+b.x2 - this._width) + inset : 0,\n        b = b.y2 > this._height ? Math.ceil(+b.y2 - this._height) + inset : 0;\n    pad = {left:l, top:t, right:r, bottom:b};\n\n    if (this._strict) {\n      this._autopad = 0;\n      this._padding = pad;\n      this._width = Math.max(0, this.__width - (l+r));\n      this._height = Math.max(0, this.__height - (t+b));\n      this._model.width(this._width);\n      this._model.height(this._height);\n      if (this._el) this.initialize(this._el.parentNode);\n      this.update({props:\"enter\"}).update({props:\"update\"});\n    } else {\n      this.padding(pad).update(opt);\n    }\n    return this;\n  };\n\n  prototype.viewport = function(size) {\n    if (!arguments.length) return this._viewport;\n    if (this._viewport !== size) {\n      this._viewport = size;\n      if (this._el) this.initialize(this._el.parentNode);\n    }\n    return this;\n  };\n  \n  prototype.renderer = function(type) {\n    if (!arguments.length) return this._io;\n    if (type === \"canvas\") type = vg.canvas;\n    if (type === \"svg\") type = vg.svg;\n    if (this._io !== type) {\n      this._io = type;\n      this._renderer = null;\n      if (this._el) this.initialize(this._el.parentNode);\n      if (this._build) this.render();\n    }\n    return this;\n  };\n\n  prototype.defs = function(defs) {\n    if (!arguments.length) return this._model.defs();\n    this._model.defs(defs);\n    return this;\n  };\n\n  prototype.data = function(data) {\n    if (!arguments.length) return this._model.data();\n    var ingest = vg.keys(data).reduce(function(d, k) {\n      return (d[k] = vg.data.ingestAll(data[k]), d);\n    }, {});\n    this._model.data(ingest);\n    this._build = false;\n    return this;\n  };\n\n  prototype.model = function(model) {\n    if (!arguments.length) return this._model;\n    if (this._model !== model) {\n      this._model = model;\n      if (this._handler) this._handler.model(model);\n    }\n    return this;\n  };\n\n  prototype.initialize = function(el) {\n    var v = this, prevHandler,\n        w = v._width, h = v._height, pad = v._padding;\n    \n    // clear pre-existing container\n    d3.select(el).select(\"div.vega\").remove();\n    \n    // add div container\n    this._el = el = d3.select(el)\n      .append(\"div\")\n      .attr(\"class\", \"vega\")\n      .style(\"position\", \"relative\")\n      .node();\n    if (v._viewport) {\n      d3.select(el)\n        .style(\"width\",  (v._viewport[0] || w)+\"px\")\n        .style(\"height\", (v._viewport[1] || h)+\"px\")\n        .style(\"overflow\", \"auto\");\n    }\n    \n    // renderer\n    v._renderer = (v._renderer || new this._io.Renderer())\n      .initialize(el, w, h, pad);\n    \n    // input handler\n    prevHandler = v._handler;\n    v._handler = new this._io.Handler()\n      .initialize(el, pad, v)\n      .model(v._model);\n\n    if (prevHandler) {\n      prevHandler.handlers().forEach(function(h) {\n        v._handler.on(h.type, h.handler);\n      });\n    }\n    \n    return this;\n  };\n  \n  prototype.render = function(items) {\n    this._renderer.render(this._model.scene(), items);\n    return this;\n  };\n  \n  prototype.on = function() {\n    this._handler.on.apply(this._handler, arguments);\n    return this;\n  };\n  \n  prototype.off = function() {\n    this._handler.off.apply(this._handler, arguments);\n    return this;\n  };\n  \n  prototype.update = function(opt) {    \n    opt = opt || {};\n    var view = this,\n        trans = opt.duration\n          ? vg.scene.transition(opt.duration, opt.ease)\n          : null;\n\n    view._build = view._build || (view._model.build(), true);\n    view._model.encode(trans, opt.props, opt.items);\n    \n    if (trans) {\n      trans.start(function(items) {\n        view._renderer.render(view._model.scene(), items);\n      });\n    }\n    else view.render(opt.items);\n\n    return view.autopad(opt);\n  };\n      \n  return view;\n})();\n\n// view constructor factory\n// takes definitions from parsed specification as input\n// returns a view constructor\nvg.ViewFactory = function(defs) {\n  return function(opt) {\n    opt = opt || {};\n    var v = new vg.View()\n      .width(defs.width)\n      .height(defs.height)\n      .padding(defs.padding)\n      .viewport(defs.viewport)\n      .renderer(opt.renderer || \"canvas\")\n      .defs(defs);\n\n    if (defs.data.load) v.data(defs.data.load);\n    if (opt.data) v.data(opt.data);\n    if (opt.el) v.initialize(opt.el);\n\n    if (opt.hover !== false) {\n      v.on(\"mouseover\", function(evt, item) {\n        if (item.hasPropertySet(\"hover\")) {\n          this.update({props:\"hover\", items:item});\n        }\n      })\n      .on(\"mouseout\", function(evt, item) {\n        if (item.hasPropertySet(\"hover\")) {\n          this.update({props:\"update\", items:item});\n        }\n      });\n    }\n  \n    return v;\n  };\n};\nvg.Spec = (function() {\n  var spec = function(s) {\n    this.spec = {\n      width: 500,\n      height: 500,\n      padding: 0,\n      data: [],\n      scales: [],\n      axes: [],\n      marks: []\n    };\n    if (s) vg.extend(this.spec, s);\n  };\n  \n  var prototype = spec.prototype;\n\n  prototype.width = function(w) {\n    this.spec.width = w;\n    return this;\n  };\n  \n  prototype.height = function(h) {\n    this.spec.height = h;\n    return this;\n  };\n  \n  prototype.padding = function(p) {\n    this.spec.padding = p;\n    return this;\n  };\n  \n  prototype.viewport = function(v) {\n    this.spec.viewport = v;\n    return this;\n  };\n\n  prototype.data = function(name, params) {\n    if (!params) params = vg.isString(name) ? {name: name} : name;\n    else params.name = name;\n    this.spec.data.push(params);\n    return this;\n  };\n  \n  prototype.scale = function(name, params) {\n    if (!params) params = vg.isString(name) ? {name: name} : name;\n    else params.name = name;\n    this.spec.scales.push(params);\n    return this;\n  };\n  \n  prototype.axis = function(params) {\n    this.spec.axes.push(params);\n    return this;\n  };\n  \n  prototype.mark = function(type, mark) {\n    if (!mark) mark = {type: type};\n    else mark.type = type;\n    mark.properties = {};\n    this.spec.marks.push(mark);\n    \n    var that = this;\n    return {\n      from: function(name, obj) {\n              mark.from = obj\n                ? (obj.data = name, obj)\n                : vg.isString(name) ? {data: name} : name;\n              return this;\n            },\n      prop: function(name, obj) {\n              mark.properties[name] = vg.keys(obj).reduce(function(o,k) {\n                var v = obj[k];\n                return (o[k] = vg.isObject(v) ? v : {value: v}, o);\n              }, {});\n              return this;\n            },\n      done: function() { return that; }\n    };\n  };\n\n  prototype.parse = function(callback) {\n    vg.parse.spec(this.spec, callback);\n  };\n\n  prototype.json = function() {\n    return this.spec;\n  };\n\n  return spec;\n})();\n\nvg.spec = function(s) {\n  return new vg.Spec(s);\n};\nvg.headless = {};vg.headless.View = (function() {\n  \n  var view = function(width, height, pad, type, vp) {\n    this._canvas = null;\n    this._type = type;\n    this._el = \"body\";\n    this._build = false;\n    this._model = new vg.Model();\n    this._width = this.__width = width || 500;\n    this._height = this.__height = height || 500;\n    this._padding = pad || {top:0, left:0, bottom:0, right:0};\n    this._autopad = vg.isString(this._padding) ? 1 : 0;\n    this._renderer = new vg[type].Renderer();\n    this._viewport = vp || null;\n    this.initialize();\n  };\n  \n  var prototype = view.prototype;\n\n  prototype.el = function(el) {\n    if (!arguments.length) return this._el;\n    if (this._el !== el) {\n      this._el = el;\n      this.initialize();\n    }\n    return this;\n  };\n\n  prototype.width = function(width) {\n    if (!arguments.length) return this._width;\n    if (this._width !== width) {\n      this._width = width;\n      this.initialize();\n      this._model.width(width);\n    }\n    return this;\n  };\n\n  prototype.height = function(height) {\n    if (!arguments.length) return this._height;\n    if (this._height !== height) {\n      this._height = height;\n      this.initialize();\n      this._model.height(this._height);\n    }\n    return this;\n  };\n\n  prototype.padding = function(pad) {\n    if (!arguments.length) return this._padding;\n    if (this._padding !== pad) {\n      if (vg.isString(pad)) {\n        this._autopad = 1;\n        this._padding = {top:0, left:0, bottom:0, right:0};\n        this._strict = (pad === \"strict\");\n      } else {\n        this._autopad = 0;\n        this._padding = pad;\n        this._strict = false;\n      }\n      this.initialize();\n    }\n    return this;\n  };\n\n  prototype.autopad = function(opt) {\n    if (this._autopad < 1) return this;\n    else this._autopad = 0;\n\n    var pad = this._padding,\n        b = this._model.scene().bounds,\n        inset = vg.config.autopadInset,\n        l = b.x1 < 0 ? Math.ceil(-b.x1) + inset : 0,\n        t = b.y1 < 0 ? Math.ceil(-b.y1) + inset : 0,\n        r = b.x2 > this._width  ? Math.ceil(+b.x2 - this._width) + inset : 0,\n        b = b.y2 > this._height ? Math.ceil(+b.y2 - this._height) + inset : 0;\n    pad = {left:l, top:t, right:r, bottom:b};\n\n    if (this._strict) {\n      this._autopad = 0;\n      this._padding = pad;\n      this._width = Math.max(0, this.__width - (l+r));\n      this._height = Math.max(0, this.__height - (t+b));\n      this._model.width(this._width);\n      this._model.height(this._height);\n      if (this._el) this.initialize();\n      this.update({props:\"enter\"}).update({props:\"update\"});\n    } else {\n      this.padding(pad).update(opt);\n    }\n    return this;\n  };\n\n  prototype.viewport = function(vp) {\n    if (!arguments.length) return _viewport;\n    this._viewport = vp;\n    this.initialize();\n    return this;\n  };\n\n  prototype.defs = function(defs) {\n    if (!arguments.length) return this._model.defs();\n    this._model.defs(defs);\n    return this;\n  };\n\n  prototype.data = function(data) {\n    if (!arguments.length) return this._model.data();\n    var ingest = vg.keys(data).reduce(function(d, k) {\n      return (d[k] = vg.data.ingestAll(data[k]), d);\n    }, {});\n    this._model.data(ingest);\n    this._build = false;\n    return this;\n  };\n\n  prototype.renderer = function() {\n    return this._renderer;\n  };\n\n  prototype.canvas = function() {\n    return this._canvas;\n  };\n  \n  prototype.canvasAsync = function(callback) {\n    var r = this._renderer, view = this;\n    \n    function wait() {\n      if (r.pendingImages() === 0) {\n        view.render(); // re-render with all images\n        callback(view._canvas);\n      } else {\n        setTimeout(wait, 10);\n      }\n    }\n\n    // if images loading, poll until ready\n    (r.pendingImages() > 0) ? wait() : callback(this._canvas);\n  };\n  \n  prototype.svg = function() {\n    if (this._type !== \"svg\") return null;\n\n    var p = this._padding,\n        w = this._width  + (p ? p.left + p.right : 0),\n        h = this._height + (p ? p.top + p.bottom : 0);\n\n    if (this._viewport) {\n      w = this._viewport[0] - (p ? p.left + p.right : 0);\n      h = this._viewport[1] - (p ? p.top + p.bottom : 0);\n    }\n\n      // build svg text\n    var svg = d3.select(this._el)\n      .select(\"svg\").node().innerHTML\n      .replace(/ href=/g, \" xlink:href=\"); // ns hack. sigh.\n\n    return '<svg '\n      + 'width=\"' + w + '\" '\n      + 'height=\"' + h + '\" '\n      + vg.config.svgNamespace + '>' + svg + '</svg>'\n  };\n\n  prototype.initialize = function() {    \n    var w = this._width,\n        h = this._height,\n        pad = this._padding;\n\n    if (this._viewport) {\n      w = this._viewport[0] - (pad ? pad.left + pad.right : 0);\n      h = this._viewport[1] - (pad ? pad.top + pad.bottom : 0);\n    }\n    \n    if (this._type === \"svg\") {\n      this.initSVG(w, h, pad);\n    } else {\n      this.initCanvas(w, h, pad);\n    }\n    \n    return this;\n  };\n  \n  prototype.initCanvas = function(w, h, pad) {\n    var Canvas = require(\"canvas\"),\n        tw = w + pad.left + pad.right,\n        th = h + pad.top + pad.bottom,\n        canvas = this._canvas = new Canvas(tw, th),\n        ctx = canvas.getContext(\"2d\");\n    \n    // setup canvas context\n    ctx.setTransform(1, 0, 0, 1, pad.left, pad.top);\n\n    // configure renderer\n    this._renderer.context(ctx);\n    this._renderer.resize(w, h, pad);\n  };\n  \n  prototype.initSVG = function(w, h, pad) {\n    var tw = w + pad.left + pad.right,\n        th = h + pad.top + pad.bottom;\n\n    // configure renderer\n    this._renderer.initialize(this._el, w, h, pad);\n  }\n  \n  prototype.render = function(items) {\n    this._renderer.render(this._model.scene(), items);\n    return this;\n  };\n  \n  prototype.update = function(opt) {\n    opt = opt || {};\n    var view = this;\n    view._build = view._build || (view._model.build(), true);\n    view._model.encode(null, opt.props, opt.items);\n    view.render(opt.items);\n    return view.autopad(opt);\n  };\n    \n  return view;\n})();\n\n// headless view constructor factory\n// takes definitions from parsed specification as input\n// returns a view constructor\nvg.headless.View.Factory = function(defs) {\n  return function(opt) {\n    opt = opt || {};\n    var w = defs.width,\n        h = defs.height,\n        p = defs.padding,\n        vp = defs.viewport,\n        r = opt.renderer || \"canvas\",\n        v = new vg.headless.View(w, h, p, r, vp).defs(defs);\n    if (defs.data.load) v.data(defs.data.load);\n    if (opt.data) v.data(opt.data);\n    return v;\n  };\n};vg.headless.render = function(opt, callback) {\n  function draw(chart) {\n    try {\n      // create and render view\n      var view = chart({\n        data: opt.data,\n        renderer: opt.renderer\n      }).update();\n\n      if (opt.renderer === \"svg\") {\n        // extract rendered svg\n        callback(null, {svg: view.svg()});\n      } else {\n        // extract rendered canvas, waiting for any images to load\n        view.canvasAsync(function(canvas) {\n          callback(null, {canvas: canvas});\n        });\n      }\n    } catch (err) {\n      callback(err, null);\n    }\n  }\n\n  vg.parse.spec(opt.spec, draw, vg.headless.View.Factory);\n};  // return module\n  return vg;\n\n//---------------------------------------------------\n// END code for this module\n//---------------------------------------------------\n}));","/**\n * Cedar\n *\n * Generic charting / visualization library for the ArcGIS Platform\n * that leverages vega + d3 internally.\n */\n\n(function (factory) {\n  'use strict';\n  //define an AMD module that relies on 'vega'\n  if (typeof define === 'function' && define.amd) {\n    define(['vega', 'd3'], function (vg, d3) {\n      return factory(vg, d3);\n    });\n  //define a common js module that relies on 'vega'\n  } else if (typeof module === 'object' && typeof module.exports === 'object') {\n    module.exports = factory(require('vega'), require('d3'));\n  }\n\n  if (typeof window !== 'undefined' && window.vg && window.d3) {\n    window.Cedar = factory(window.vg, window.d3);\n  }\n} (function (vg, d3) {\n  'use strict';\n\n/**\n * Constructor\n * @param {object} options Cedar options\n */\nvar Cedar = function Cedar(options){\n  //close over this for use in callbacks\n  var self = this;\n\n  //ensure an opts object\n  var opts = options || {};\n\n  /**\n   * Internals for holding state\n   */\n  \n\n  // Array to hold event handlers\n  this._events = [];\n\n  //initialize the internal definition hash\n  this._definition = Cedar._defaultDefinition();\n\n  //the vega view aka the chart\n  this._view = undefined;\n\n  //queue to hold methods called while\n  //xhrs are in progress\n  this._methodQueue=[];\n\n  /**\n   * Flag used to determine if the library is\n   * waiting for an xhr to return. \n   */\n  this._pendingXhr = false;\n\n  //defintion \n  if(opts.definition){\n    //is it an object or string(assumed to be url)\n    if(typeof opts.definition === 'object'){\n      //hold onto the definition\n      this._definition = opts.definition;\n    }else if(typeof opts.definition === 'string' ){ \n      //assume it's a url (relative or abs) and fetch the definition object\n      this._pendingXhr = true;\n      Cedar.getJson(opts.definition, function(err,data){\n        self._pendingXhr = false;\n        self._definition = data; \n        self._purgeMethodQueue();\n      });\n    }else{\n      throw new Error('parameter definition must be an object or string (url)');\n    }\n  }\n\n  if(opts.override) {\n    this._definition.override = opts.override;\n  }\n\n  //template\n  if(opts.specification){\n    //is it an object or string(assumed to be url)\n    if(typeof opts.specification === 'object'){\n      //hold onto the template\n      this._definition.specification = opts.specification;\n\n    }else if(typeof opts.specification === 'string' ){ \n      //assume it's a url (relative or abs) and fetch the template object\n      this._pendingXhr = true;\n      Cedar.getJson(opts.specification, function(err,data){\n        self._pendingXhr = false;\n        self._definition.specification = data; \n        self._purgeMethodQueue();\n      });\n    }else{\n      throw new Error('parameter template must be an object or string (url)');\n    }\n  }\n\n  //allow a dataset to be passed in...\n  if(opts.dataset && typeof opts.dataset === 'object'){\n    opts.dataset.query = Cedar._mixin({}, Cedar._defaultQuery(), opts.dataset.query);\n    //assign it\n    this._definition.dataset = opts.dataset;\n  }\n\n  /**\n   * Properties\n   *\n   * ES 5.1 syntax, so IE 8 & lower won't work\n   * \n   * If the val is a url, should we expect\n   * cedar to fetch the object? \n   * \n   * I'd say no... as that violates the principal \n   * of least suprise. Also - cedar has a .getJSON\n   * helper method the dev should use.\n   * \n   */\n      \n  Object.defineProperty(this, 'dataset', {\n    get: function() {\n        return this._definition.dataset;\n    },\n    set: function(val) {\n       this._definition.dataset = val;\n    }\n  });\n\n  Object.defineProperty(this, 'specification', {\n    get: function() {\n        return this._definition.specification;\n    },\n    set: function(val) {\n      this._definition.specification = val;\n    }\n  });\n\n  Object.defineProperty(this, 'override', {\n    get: function() {\n        return this._definition.override;\n    },\n    set: function(val) {\n      this._definition.override = val;\n    }\n  });  \n\n};\n\n\n/**\n * Inspect the current state of the object\n * and determine if we have sufficient information\n * to render the chart\n * @return {object} Hash of the draw state + any missing requirements\n */\nCedar.prototype.canDraw = function(){\n\n  //dataset?\n  //dataset.url || dataset.data?\n  //dataset.mappings?\n  //specification?\n  //specification.template?\n  //specification.inputs?\n  //specification.inputs ~ dataset.mappings?\n  \n  return {drawable:true, errs:[]};\n\n};\n\n/**\n * Render a chart in the specified element\n * @param  {object} options \n * \n * options.elementId [required] Id of the Dom element into which the chart will be rendered\n * options.token     [optional] Token to be used if the data or spec are on a secured server\n */\nCedar.prototype.show = function(options){\n  if(this._pendingXhr){\n    \n    this._addToMethodQueue('show', [options]);\n\n  }else{\n\n    var err;\n    //ensure we got an elementId\n    if( !options.elementId ){\n      err= \"Cedar.show requires options.elementId\";\n    }\n    //check if element exists in the page\n    if(d3.select(options.elementId)[0][0] === null){\n      err = \"Element \" + options.elementId + \" is not present in the DOM\";\n     }\n  \n    //hold onto the id\n    this._elementId = options.elementId;\n    this._renderer = options.renderer || \"canvas\"; //default to canvas\n\n    //hold onto the token\n    if(options.token){\n      this._token = options.token;\n    }\n\n    if( err ){\n      throw new Error( err );\n    }\n    var chk = this.canDraw();\n    if(chk.drawable){\n      //update centralizes the spec compilation & drawing\n      this.update();  \n    }else{\n      //report the issues\n      var errs = chk.issues.join(',');\n      throw new Error('Chart can not be drawn because: ' + errs);  \n    }\n    \n  }\n};\n\n/**\n * Render the chart using the internal state\n * Should be called after a user modifies the \n * of the dataset, query, mappings or template\n */\nCedar.prototype.update = function(){\n  var self = this;\n  \n  if ( this._view ) { \n    this.emit('update-start');\n  }\n\n  if(this._pendingXhr){\n    \n    this._addToMethodQueue('update');\n\n  }else{\n\n    if(this._view){\n      //remove handlers\n      //TODO Remove existing handlers\n      this._remove(this._view);\n    }\n    try{\n      //ensure we have required inputs or defaults \n      var compiledMappings = Cedar._applyDefaultsToMappings(this._definition.dataset.mappings, this._definition.specification.inputs); //Cedar._compileMappings(this._definition.dataset, this._definition.specification.inputs);\n\n      var queryFromSpec = Cedar._mixin({}, this._definition.specification.query, this._definition.dataset.query);\n      queryFromSpec = JSON.parse(Cedar._supplant(JSON.stringify(queryFromSpec), compiledMappings));\n\n      //allow binding to query properties\n      compiledMappings.query = queryFromSpec;\n\n      //compile the template + mappings --> vega spec\n      var spec = JSON.parse(Cedar._supplant(JSON.stringify(this._definition.specification.template), compiledMappings)); \n\n      // merge in user specified style overrides\n      spec = Cedar._mergeRecursive(spec, this._definition.override);\n\n      //if the spec has a url in the data node, delete it\n      if(spec.data[0].url){\n        delete spec.data[0].url;\n      }\n\n      if(this._definition.dataset.data){\n\n        //create the data node using the passed in data\n        spec.data[0].values = this._definition.dataset.data;\n        \n        //send to vega\n        this._renderSpec(spec);\n      \n      }else{\n      \n        //we need to fetch the data so\n        var url = Cedar._createFeatureServiceRequest(this._definition.dataset, queryFromSpec);\n      \n        //create a callback closure to carry the spec\n        var cb = function(err,data){\n      \n          //todo add error handlers for xhr and ags errors\n          spec.data[0].values = data;\n          console.dir(spec);\n          //send to vega\n          self._renderSpec(spec);\n\n        };\n\n        //fetch the data from the service\n        Cedar.getJson(url, cb);\n      }\n    }\n    catch(ex){\n      throw(ex);\n    }\n  }\n};\n\n/**\n * Render a fully cooked spec\n */\nCedar.prototype._renderSpec = function(spec){\n  var self = this;\n  try{\n    //use vega to parse the spec \n    //it will handle the spec as an object or url\n    vg.parse.spec(spec, function(chartCtor) { \n\n      //create the view\n      self._view = chartCtor({\n        el: self._elementId,\n        renderer: self._renderer\n      });\n\n      \n      //render into the element\n      self._view.update(); \n\n      //attach event proxies\n      self._attach(self._view);\n\n      if ( self._view ) { \n        self.emit('update-end');\n      }\n\n    });\n  }\n  catch(ex){\n    throw(ex);\n  }\n};\n\n/**\n * highlight marker based on attribute value\n */\nCedar.prototype.select = function( opt ) {\n  var self = this;\n  var view = this._view;\n  var items = view.model().scene().items[0].items[0].items;\n\n  items.forEach(function(item) {\n    if ( item.datum.data.attributes[opt.key] === opt.value ) {\n      if ( item.hasPropertySet(\"hover\") ) {\n        self._view.update({props:\"hover\", items:item});\n      }\n    }\n  });\n\n};\n\n\n/**\n * highlight marker based on attribute value\n */\nCedar.prototype.clearSelection = function( opt ) {\n  var self = this;\n  var view = this._view;\n  var items = view.model().scene().items[0].items[0].items;\n\n  if ( opt && opt.key ) {\n    items.forEach(function(item) {\n      if ( item.datum.data.attributes[opt.key] === opt.value ) {\n        self._view.update({props:\"update\", items:item});\n      }\n    });\n  } else {\n    //clear all \n    self._view.update();\n  }\n\n};\n\n\n// trigger callback \nCedar.prototype.emit = function(eventName) {\n  if (this._view._handler._handlers[ eventName ]){\n    this._view._handler._handlers[ eventName ][0].handler();\n  }\n};\n\n/**\n * Attach the generic proxy handlers to the chart view\n */\nCedar.prototype._attach = function(view){\n  \n  view.on('mouseover', this._handler('mouseover'));\n  view.on('mouseout', this._handler('mouseout'));\n  view.on('click', this._handler(\"click\"));\n  view.on('update-start', this._handler('update-start'));\n  view.on('update-end', this._handler('update-end'));\n  \n};\n\n/**\n * Remove all event handlers from the view\n */\nCedar.prototype._remove = function(view){\n\n  view.off('mouseover');\n  view.off('mouseout');\n  view.off('click');\n  view.off('update-start');\n  view.off('update-end');\n  \n};\n\n/**\n * Helper function that validates that the \n * mappings hash contains values for all\n * the inputs\n * @param  {array} inputs   Array of inputs\n * @param  {object} mappings Hash of mappings\n * @return {array}          Missing mappings\n */\nCedar._validateMappings = function(inputs, mappings){\n  var missingInputs = [], input;\n  for(var i=0;i<inputs.length;i++){\n    input = inputs[i];\n    if(input.required){\n      if(!mappings[input.name]){\n        missingInputs.push(input.name);\n      }\n    }\n  }\n  return missingInputs;\n};\n\n/**\n * Validate that the incoming data has the fields expected\n * in the mappings\n */\nCedar._validateData = function(data, mappings){\n  var missingInputs = [];\n  if(!data.features || !Array.isArray(data.features)){\n    throw new Error('Data is expected to have features array!');\n  }\n  var firstRow = data.features[0].attributes;\n  for(var key in mappings){\n    var fld = Cedar._getMappingFieldName(key, mappings[key].field);\n    if(!firstRow.hasOwnProperty(fld)){\n      missingInputs.push(fld);\n    }\n  }\n  return missingInputs;\n};\n\n/**\n * Centralize and abstract the computation of\n * expected field names, based on the mapping name\n */\nCedar._getMappingFieldName = function(mappingName, fieldName){\n  var name = fieldName;\n  //if(mappingName.toLowerCase() === 'count'){\n  //  name = fieldName + '_SUM';\n  //}\n  return name;\n};\n\n/**\n * Return a default definition object\n */\nCedar._defaultDefinition = function(){\n  var defn = {\n    \"dataset\": {\n      \"query\": this._defaultQuery()\n    },\n    \"template\":{}\n  };\n\n  defn.dataset.query = Cedar._defaultQuery();\n\n  return defn;\n};\n\n/**\n * Default Query Object\n */\nCedar._defaultQuery = function(){\n  var defaultQuery = {\n    \"where\": \"1=1\",\n    \"returnGeometry\": false,\n    \"returnDistinctValues\": false,\n    \"returnIdsOnly\": false,\n    \"returnCountOnly\": false,\n    \"outFields\": \"*\",\n    \"f\": \"json\"\n  };\n  return defaultQuery;\n};\n\n\n\n/**\n * Generic event handler proxy\n */\nCedar.prototype._handler = function(evtName) {\n  var self = this;\n  \n  //return a handler function w/ the events hash closed over\n  var handler = function(evt, item){\n    self._events.forEach( function(registeredHandler){\n      if(registeredHandler.type === evtName){\n        //invoke the callback with the data\n        if ( item ) {\n          registeredHandler.callback(item.datum.data.attributes);\n        } else {\n          registeredHandler.callback();\n        }\n      }\n    });\n  };\n  return handler;\n};\n\n/**\n * Add a handler for the named event\n */\nCedar.prototype.on = function(evtName, callback){\n  this._events.push({\"type\":evtName, \"callback\":callback});\n};\n\n/**\n * Remove a handler for the named event\n */\nCedar.prototype.off = function(evtName /*, callback */){\n  console.log('Handler for ' + evtName +' removed...');\n};\n\n\n/**\n * Creates an entry in the method queue, excuted \n * once a pending xhr is completed \n */\nCedar.prototype._addToMethodQueue = function(name, args){\n  this._methodQueue.push({ method: name, args: args });\n};\n\n/**\n * empties the method queue by calling the queued methods\n * This helps build a more syncronous api, while still\n * doing async things in the code\n */\nCedar.prototype._purgeMethodQueue = function(){\n  var self = this;\n  if(self._methodQueue.length > 0){\n\n    for(var i=0;i<self._methodQueue.length;i++){\n      var action = self._methodQueue[i];\n      self[action.method].apply(self, action.args);  \n    }\n  }\n};\n\n/**\n * fetch json from a url\n * @param  {string}   url      Url to json file\n * @param  {Function} callback node-style callback function (err, data)\n */\nCedar.getJson = function( url, callback ){\n  d3.json(url, function(err,data) {\n    if(err){\n      callback('Error loading ' + url + ' ' + err.message);\n    }\n    callback(null, data);\n  });\n};\n\n\nCedar._mixin = function(source) {\n    for (var i = 1; i < arguments.length; i++) {\n        d3.entries(arguments[i]).forEach(function(p) {\n            source[p.key] = p.value;\n        });\n    }\n    return source;\n};\n\n/**\n * Given a dataset hash, create the feature service\n * query string\n */\nCedar._createFeatureServiceRequest = function( dataset, queryFromSpec ) {\n  var mergedQuery = Cedar._mixin({}, Cedar._defaultQuery(), queryFromSpec);\n\n  //Handle bbox\n  if(mergedQuery.bbox){\n    //make sure a geometry was not also passed in\n    if(mergedQuery.geometry){\n      throw new Error('Dataset.query can not have both a geometry and a bbox specified');\n    }\n    //get the bbox (W,S,E,N)\n    var bboxArr = mergedQuery.bbox.split(',');\n\n    //remove it so it's not serialized as-is\n    delete mergedQuery.bbox;\n\n    //cook it into a json string \n    mergedQuery.geometry = JSON.stringify({\"xmin\": bboxArr[0], \"ymin\": bboxArr[2],\"xmax\": bboxArr[1], \"ymax\": bboxArr[3] });\n    //set the spatial ref as geographic\n    mergedQuery.inSR = '4326';\n  }\n  if(!mergedQuery.groupByFieldsForStatistics && dataset.mappings.group) {\n      mergedQuery.groupByFieldsForStatistics = dataset.mappings.group.field;\n  }\n  if(!mergedQuery.outStatistics && dataset.mappings.count) {\n    mergedQuery.orderByFields = dataset.mappings.count.field + \"_SUM\";\n    mergedQuery.outStatistics = JSON.stringify([{\"statisticType\": \"sum\", \"onStatisticField\": dataset.mappings.count.field, \"outStatisticFieldName\": dataset.mappings.count.field + \"_SUM\"}]);\n  }\n\n\n\n  //iterate the mappings keys to check for sort\n  //-----------------------------------------------------------------\n  //This approach would seem 'clean' but if there are multiple fields\n  //to sort by, the order would be determined by how javascript decides to\n  //iterate the mappings property hash.\n  //Thus, using mappings.sort gives the developer explicit control\n  //-----------------------------------------------------------------\n  // var sort = [];\n  // for (var property in dataset.mappings) {\n  //   if (dataset.mappings.hasOwnProperty(property)) {\n  //     if(dataset.mappings[property].sort){\n  //       //ok - build up the sort\n  //       sort.push(dataset.mappings[property].field + ' ' + dataset.mappings[property].sort);\n  //     }\n  //   }\n  // }\n  // if(sort.length > 0){\n  //   mergedQuery.orderByFields = sort.join(',');\n  // }\n  //-----------------------------------------------------------------\n  //check for a sort passed directly in\n  if(dataset.mappings.sort){\n    mergedQuery.orderByFields = dataset.mappings.sort;\n  }\n\n  var url = dataset.url + \"/query?\" + this._serializeQueryParams(mergedQuery);\n  \n  if(dataset.token){\n    url = url + '&token=' + dataset.token;\n  }\n  \n  return url;\n};\n\nCedar._applyDefaultsToMappings = function(mappings, inputs){\n  var errs = [];\n  //loop over the inputs\n  for(var i =0; i < inputs.length; i++){\n    //get the input\n    var input = inputs[i];\n\n    //if it's required and not in the mappings, add an exception\n    if(input.required && !mappings[input.name] ){\n      errs.push(input.name);\n    }\n    \n    //if it's not required, has a default and not in the mappings\n    if(!input.required && !mappings[input.name] && input.default){\n      //add the default\n      mappings[input.name] = input.default;\n    }\n  }\n\n  if(errs.length > 0){\n    throw new Error('Required Mappings Missing: ' + errs.join(','));\n  }else{\n    return mappings;\n  }\n};\n\n\n/**\n * Token Replacement on a string\n * @param  {string} template string template\n * @param  {object} params   object hash that maps to the tokens to be replaced\n * @return {string}          string with values replaced\n */\nCedar._supplant = function( tmpl, params ){\n  return tmpl.replace(/{([^{}]*)}/g,\n    function (a, b) {\n      var r = Cedar._getTokenValue(params, b);\n      return typeof r === 'string' || typeof r === 'number' ? r : a;\n    }\n  );\n};\n\n/*\n* Recursively merge properties of two objects \n*/\nCedar._mergeRecursive = function(obj1, obj2) {\n  for (var p in obj2) {\n    try {\n      // Property in destination object set; update its value.\n      if ( obj2[p].constructor===Object || obj2[p].constructor===Array) {\n        obj1[p] = Cedar._mergeRecursive(obj1[p], obj2[p]);\n\n      } else {\n        obj1[p] = obj2[p];\n\n      }\n\n    } catch(e) {\n      // Property in destination object not set; create it and set its value.\n      obj1[p] = obj2[p];\n\n    }\n  }\n\n  return obj1;\n};\n\n/**\n * Get the value of a token from a hash\n * @param  {[type]} tokens    [description]\n * @param  {[type]} tokenName [description]\n * @return {[type]}           [description]\n * Pulled from gulp-token-replace (MIT license)\n * https://github.com/Pictela/gulp-token-replace/blob/master/index.js\n * \n */\nCedar._getTokenValue = function(tokens, tokenName) {\n  var tmpTokens = tokens;\n  var tokenNameParts = tokenName.split('.');\n  for (var i = 0; i < tokenNameParts.length; i++) {\n    if (tmpTokens.hasOwnProperty(tokenNameParts[i])) {\n      tmpTokens = tmpTokens[tokenNameParts[i]];\n    } else {\n      return null;\n    }\n  }\n  return tmpTokens;\n};\n\n/**\n * Serilize an object into a query string\n * @param  {object} params Params for the query string\n * @return {string}        query string\n */\nCedar._serializeQueryParams = function(params) {\n  var str = [];\n  for(var p in params){\n    if (params.hasOwnProperty(p)) {\n      var val = params[p];\n      if (typeof val !== \"string\") {\n          val = JSON.stringify(val);\n      }\n      str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(val));\n    }\n  }\n  var queryString = str.join(\"&\");\n  return queryString;\n};\n\n  return Cedar;\n}));\n"]}